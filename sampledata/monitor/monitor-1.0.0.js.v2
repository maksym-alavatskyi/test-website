!function(){!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var e;e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,e.ClickTaleMonitor=t()}}(function(){return function t(e,i,n){function r(s,c){if(!i[s]){if(!e[s]){var a="function"==typeof require&&require;if(!c&&a)return a(s,!0);if(o)return o(s,!0);var u=new Error("Cannot find module '"+s+"'");throw u.code="MODULE_NOT_FOUND",u}var p=i[s]={exports:{}};e[s][0].call(p.exports,function(t){var i=e[s][1][t];return r(i?i:t)},p,p.exports,t,e,i,n)}return i[s].exports}for(var o="function"==typeof require&&require,s=0;s<n.length;s++)r(n[s]);return r}({1:[function(t,e,i){"use strict";var n=t("../eventHubs/Hub"),r=t("../ioc/Container"),o=t("../metrics/IdMetric"),s=t("../config/Configuration"),c=t("../services/disposer/Disposer"),a=t("../metrics/MetricsReader"),u=t("../metrics/VersionMetric"),p=t("../metrics/LocationMetric"),f=t("../metrics/MetricsPromise"),h=t("../messaging/JSONSerializer"),l=t("../metrics/ProjectIdMetric"),v=t("../metrics/TimeOnPageMetric"),d=t("../metrics/MetricAggregator"),y=t("../metrics/ScrollReachMetric"),g=t("../services/idGenerator/IdGenerator"),m=t("../metrics/JSErrorCountMetric"),b=t("../services/cookies/CookiesService"),M=t("../transport/XhrTransportChannel"),T=t("../distribution/DistributionService"),w=t("../services/userAgent/UserAgentService"),I=t("../messaging/QueryStringSerializer"),E=t("../transport/ImageTransportChannel"),S=t("../metrics/DocumentReferrerMetric"),C=t("../metrics/PeriodicalNotifierRule"),A=t("../transport/BeaconTransportChannel"),O=t("../metrics/VisitIdentificationMetric"),R=t("../metrics/ReturningOrNewVisitorMetric"),x=t("../metrics/DOMLContentLoadedTimeMetric"),D=t("../metrics/VisitorIdentificationMetric"),P=t("../metrics/PageViewIdentificationMetric"),N=t("../services/identification/IdentificationService"),V=t("../metrics/EngagementTimeAggregatorMetric"),k=function(){function t(t){var e=this;this.projectId=t,this.bootstrap(function(){e.tryRegisterComponents()&&e.start()})}return t.prototype.bootstrap=function(e){t.isMonitoring||(/complete|interactive/.test(document.readyState)&&e(),document.addEventListener("DOMContentLoaded",e,!1))},t.prototype.start=function(){var e,i=t.container.resolve("Disposer");t.container.resolve("Hub"),t.container.resolve("MetricsReader"),e=t.container.resolve("MetricAggregator"),i.metricAggregator=e,t.container.resolve("DistributionService"),t.isMonitoring=!0},t.prototype.tryRegisterComponents=function(){var e=this,i=new w.UserAgentService;return i.isBrowserSupported?(t.container=new r.Container,t.container.register("Hub",function(t){return new n.Hub(i)}),t.container.registerInstance(i),t.registerTransportChannels(i.userAgent,s.Configuration),t.container.register("IdGenerator",function(t){return new g.IdGenerator}),t.container.register("VersionMetric",function(t){return new u.VersionMetric}),t.container.register("LocationMetric",function(t){return new p.LocationMetric}),t.container.register("CookiesService",function(t){return new b.CookiesService}),t.container.register("ProjectIdMetric",function(t){return new l.ProjectIdMetric(e.projectId)}),t.container.register("DocumentReferrerMetric",function(t){return new S.DocumentReferrerMetric}),t.container.register("IdMetric",function(t,e){return new o.IdMetric(e)}).asTransient(),t.container.register("ScrollReachMetric",function(t){return new y.ScrollReachMetric(t.resolve("Hub"))}),t.container.register("JSErrorCountMetric",function(t){return new m.JSErrorCountMetric(t.resolve("Hub"))}),t.container.register("PeriodicalNotifierRule",function(t){return new C.PeriodicalNotifierRule(s.Configuration)}),t.container.registerNamed(s.Configuration.transport.mainChannel,"serializer",function(t){return new h.JSONSerializer}),t.container.register("DOMLContentLoadedTimeMetric",function(t){return new x.DOMLContentLoadedTimeMetric(performance.timing)}),t.container.register("TimeOnPageMetric",function(t){return new v.TimeOnPageMetric(t.resolve("Hub"),performance.timing)}),t.container.registerNamed(s.Configuration.transport.terminalChannel,"serializer",function(t){return new I.QueryStringSerializer}),t.container.register("Disposer",function(t){return new c.Disposer(t.resolve("Hub"),t,s.Configuration,e)}).ownedExternally(),t.container.register("MetricsPromise",function(t){return new f.MetricsPromise(t.resolve("MetricAggregator"))}),t.container.register("VisitIdentificationMetric",function(t){return new O.VisitIdentificationMetric(t.resolve("IdentificationService"))}),t.container.register("ReturningOrNewVisitorMetric",function(t){return new R.ReturningOrNewVisitorMetric(t.resolve("IdentificationService"))}),t.container.register("VisitorIdentificationMetric",function(t){return new D.VisitorIdentificationMetric(t.resolve("IdentificationService"))}),t.container.register("PageViewIdentificationMetric",function(t){return new P.PageViewIdentificationMetric(t.resolve("IdentificationService"))}),t.container.register("EngagementTimeAggregatorMetric",function(t){return new V.EngagementTimeAggregatorMetric(t.resolve("Hub"),s.Configuration,performance.timing)}),t.container.register("DistributionService",function(t){return new T.DistributionService(e,s.Configuration,t.resolve("Hub"),t,t.resolve("Disposer"))}),t.container.register("IdentificationService",function(t){return new N.IdentificationService(t.resolve("IdGenerator"),t.resolve("CookiesService"),s.Configuration)}),t.container.register("MetricAggregator",function(t){var e=s.Configuration.metrics.providers.map(function(e){return t.resolve(e)});return e=e.concat([t.resolve("VersionMetric"),t.resolve("LocationMetric"),t.resolve("ProjectIdMetric"),t.resolve("DocumentReferrerMetric"),t.resolve("VisitIdentificationMetric"),t.resolve("DOMLContentLoadedTimeMetric"),t.resolve("VisitorIdentificationMetric"),t.resolve("PageViewIdentificationMetric")]),new d.MetricAggregator(e,t.resolve("Hub"),s.Configuration,t.resolveFactory("IdMetric"),t.resolve("Disposer"))}),t.container.register("MetricsReader",function(t){var e=t.resolve("MetricsPromise");return new a.MetricsReader([e,t.resolve("PeriodicalNotifierRule")],t.resolve("Hub"),t.resolve("MetricAggregator"),t.resolve("DistributionService"),e,t.resolve("IdentificationService"))}),!0):!1},t.prototype.shutdown=function(){this.dispose(!0)},t.prototype.dispose=function(e){var i=t.container.resolve("Disposer");i.dispose(e)},t.prototype.stop=function(){t.isMonitoring=!1},t.prototype.isMonitoring=function(){return t.isMonitoring},t.registerTransportChannels=function(e,i){var n=i.transport,r=(e.browser.type,e.supports.sendBeacon?A.BeaconTransportChannel:E.ImageTransportChannel);t.container.registerNamed(n.terminalChannel,"channel",function(t,e){return new r(e)}).ownedExternally(),t.container.registerNamed(n.mainChannel,"channel",function(t,e){return new M.TransportChannelXhr(e)}).asTransient().ownedExternally()},t.isMonitoring=!1,t}();i.App=k},{"../config/Configuration":4,"../distribution/DistributionService":5,"../eventHubs/Hub":7,"../ioc/Container":8,"../messaging/JSONSerializer":13,"../messaging/QueryStringSerializer":14,"../metrics/DOMLContentLoadedTimeMetric":18,"../metrics/DocumentReferrerMetric":19,"../metrics/EngagementTimeAggregatorMetric":20,"../metrics/IdMetric":21,"../metrics/JSErrorCountMetric":22,"../metrics/LocationMetric":23,"../metrics/MetricAggregator":24,"../metrics/MetricsPromise":26,"../metrics/MetricsReader":27,"../metrics/PageViewIdentificationMetric":28,"../metrics/PeriodicalNotifierRule":29,"../metrics/ProjectIdMetric":30,"../metrics/ReturningOrNewVisitorMetric":31,"../metrics/ScrollReachMetric":32,"../metrics/TimeOnPageMetric":33,"../metrics/VersionMetric":34,"../metrics/VisitIdentificationMetric":35,"../metrics/VisitorIdentificationMetric":36,"../services/cookies/CookiesService":37,"../services/disposer/Disposer":38,"../services/idGenerator/IdGenerator":39,"../services/identification/IdentificationService":40,"../services/userAgent/UserAgentService":42,"../transport/BeaconTransportChannel":44,"../transport/ImageTransportChannel":45,"../transport/XhrTransportChannel":46}],2:[function(t,e,i){"use strict";var n=t("./App");i.App=n.App},{"./App":1}],3:[function(t,e,i){"use strict";var n=function(){function t(){}return t.prototype.add=function(t,e){this[t.toString()]=e},t.prototype.remove=function(t){delete this[t.toString()]},t.prototype.containsKey=function(t){return!!this[t.toString()]},t.prototype.tryGetValue=function(t,e){var i=this[t.toString()];return i?(e.out=i,!0):!1},t.prototype.clear=function(){var t=this;Object.keys(this).forEach(function(e){delete t[e]})},t.prototype.values=function(){var t=this;return Object.keys(this).map(function(e){return t[e]})},t}();i.Dictionary=n},{}],4:[function(t,e,i){"use strict";var n=t("../services/objectExtender/ObjectExtender"),r=window.ClickTaleMonitorSettings,o={metrics:{inactivityTime:2e4,maxFetchInterval:5e3,providers:["EngagementTimeAggregatorMetric","TimeOnPageMetric","JSErrorCountMetric","ScrollReachMetric"]},identification:{expirationDays:365,visitTimeSpan:18e5},transport:{url:"https://",mainChannel:"main",terminalChannel:"terminal"},distribution:{relaibleMessages:{retries:2,waitInterval:1e3}}};i.Configuration=o,o=n.ObjectExtender.extend(o,r)},{"../services/objectExtender/ObjectExtender":41}],5:[function(t,e,i){"use strict";var n=t("../eventHubs/EventType"),r=t("../collections/Dictionary"),o=function(){function t(t,e,i,o,s){var c=this;this.app=t,this.config=e,this.hub=i,this.container=o,this.channelFactory=s,this.isBrowserOnline=!1,this.envelopeMap=new r.Dictionary,this.transportUrl=e.transport.url,this.channelSettings={sendPromise:{reject:this.onTransportFailure,resolve:this.onTransportSuccess},waitInterval:e.distribution.relaibleMessages.waitInterval},this.isBrowserOnline=navigator.onLine,this.hub.bind([n.EventType.online,n.EventType.offline],function(){return c.isBrowserOnline=navigator.onLine})}return t.prototype.process=function(t,e){var i,n={data:t},r={};if(e.reliable&&this.envelopeMap.tryGetValue(e.id,r)){if(i=r.out,--i.retries<0)return this.app.shutdown()}else i={message:n,metrics:e,retries:this.config.distribution.relaibleMessages.retries},this.envelopeMap.add(e.id,i);this.distributeEnvelope(i)},t.prototype.distributeEnvelope=function(t){if(this.isBrowserOnline){var e=this.transportUrl+"?t="+t.metrics.type,i=this.channelFactory.getChannel(this.channelSettings);i.send(e,t)}},t.prototype.onTransportSuccess=function(t){t.metrics.promise.resolve(t.metrics)},t.prototype.onTransportFailure=function(t){t.metrics.promise.reject(t.metrics)},t}();i.DistributionService=o},{"../collections/Dictionary":3,"../eventHubs/EventType":6}],6:[function(t,e,i){"use strict";var n;!function(t){t[t.error=0]="error",t[t.keyup=1]="keyup",t[t.scroll=2]="scroll",t[t.resize=3]="resize",t[t.unload=4]="unload",t[t.online=5]="online",t[t.mouseup=6]="mouseup",t[t.offline=7]="offline",t[t.mouseover=8]="mouseover",t[t.touchstart=9]="touchstart",t[t.beforeunload=10]="beforeunload",t[t.visibilitychange=11]="visibilitychange"}(n||(n={})),i.EventType=n},{}],7:[function(t,e,i){"use strict";var n=t("../eventHubs/EventType"),r=t("../collections/Dictionary"),o=function(){function t(t){this.userAgentService=t,this.bindedPublish=this.publish.bind(this),this.subscribers=new r.Dictionary,this.documentEvents=[n.EventType.mouseover,n.EventType.mouseup,n.EventType.keyup,n.EventType.visibilitychange],this.userEvents=[n.EventType.mouseover,n.EventType.mouseup,n.EventType.keyup,n.EventType.scroll,n.EventType.resize],this.windowEvents=[n.EventType.scroll,n.EventType.resize,n.EventType.online,n.EventType.offline,n.EventType.error,n.EventType.beforeunload,n.EventType.unload],this.init()}return t.prototype.init=function(){var t=this;this.userAgentService.userAgent.is.mobile&&(this.userEvents.push(n.EventType.touchstart),this.documentEvents.push(n.EventType.touchstart)),this.documentEvents.concat(this.windowEvents).forEach(function(e){t.subscribers[e]=new Array}),this.bindBrowserEvents()},t.prototype.bind=function(t,e){this.bindInternal(t,e)},t.prototype.unbind=function(t,e){var i=this;t.forEach(function(t){if(i.subscribers){var n=i.subscribers[t],r=n.indexOf(e);r>-1&&n.splice(r,1)}})},t.prototype.bindTop=function(t,e){this.bindInternal(t,e,!0)},t.prototype.bindInternal=function(t,e,i){var n=this;void 0===i&&(i=!1);var r=i?function(t){return t.splice(0,0,e)}:function(t){return t.push(e)};t.forEach(function(t){return r(n.subscribers[t])})},t.prototype.unbindAll=function(){this.subscribers=null},t.prototype.publish=function(t){var e=n.EventType[t.type];this.subscribers[e].forEach(function(e){return e(t)})},t.prototype.dispose=function(t){this.unbindAll(),this.unbindBrowserEvents()},t.prototype.bindBrowserEvents=function(){var t=function(t){return t.addEventListener};this.bindUnbindBrowserEvent(t,window,this.windowEvents,this.bindedPublish),this.bindUnbindBrowserEvent(t,document,this.documentEvents,this.bindedPublish)},t.prototype.unbindBrowserEvents=function(){var t=function(t){return t.removeEventListener};this.bindUnbindBrowserEvent(t,window,this.windowEvents,this.bindedPublish),this.bindUnbindBrowserEvent(t,document,this.documentEvents,this.bindedPublish)},t.prototype.bindUnbindBrowserEvent=function(t,e,i,r){i.forEach(function(i){var o=n.EventType[i],s=t(e);s.apply(e,[o,r,!1])})},t}();i.Hub=o},{"../collections/Dictionary":3,"../eventHubs/EventType":6}],8:[function(t,e,i){"use strict";var n=t("./ServiceKey"),r=t("../collections/Dictionary"),o=t("./GenericServiceEntry"),s=function(){function t(){this.defaultOwner=0,this.defaultReuse=0,this.disposables=new Array,this.services=new r.Dictionary;var e=o.GenericServiceEntry.build({instance:this,factory:function(t){return t},container:this,owner:1,reuse:0});this.services.add(new n.ServiceKey(t),e)}return t.prototype.dispose=function(t){for(;this.disposables.length>0;){var e=this.disposables.shift();e.dispose(t)}},t.prototype.register=function(t,e){return this.registerNamed(t,null,e)},t.prototype.registerInstance=function(t){this.registerNamedInstance(null,t)},t.prototype.registerNamedInstance=function(t,e){var i=Object.getPrototypeOf(e),n=i.constructor,r=this.registerImpl(n,t,null);r.asSingleton().ownedExternally(),r.initializeInstance(e)},t.prototype.registerNamed=function(t,e,i){return this.registerImpl(t,e,i)},t.prototype.registerImpl=function(t,e,i){var r=new n.ServiceKey(t,e),s=o.GenericServiceEntry.build({container:this,factory:i,reuse:this.defaultReuse,owner:this.defaultOwner});return this.services.add(r,s),s},t.prototype.resolve=function(t,e,i,n,r){var o=[t,null,e,i,n,r];return this.resolveNamed.apply(this,o)},t.prototype.resolveNamed=function(t,e,i,n,r,o){var s=Array.prototype.slice.call(arguments,2);return this.resolveImpl(t,e,s)},t.prototype.resolveFactory=function(t){return this.resolveNamedFactory(t,null)},t.prototype.resolveNamedFactory=function(t,e){var i,n=this.getEntry(t,e);return n?function(t,e,r,o){var s=[n.container,t,e,r,o];return i=n.instance,i||(i=n.factory.apply(null,s),n.initializeInstance(i)),i}:function(){return null}},t.prototype.resolveImpl=function(t,e,i){var n,r=this.getEntry(t,e);return r?(n=r.instance,n||(i=i||[],i.splice(0,0,r.container),n=r.factory.apply(null,i),r.initializeInstance(n)),n):null},t.prototype.getEntry=function(t,e){var i,r=new n.ServiceKey(t,e),o={};return this.services.tryGetValue(r,o)&&(i=o.out),i},t.prototype.trackDisposable=function(t){this.disposables.push(t)},t}();i.Container=s},{"../collections/Dictionary":3,"./GenericServiceEntry":9,"./ServiceKey":12}],9:[function(t,e,i){"use strict";var n=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},r=t("./ServiceEntry"),o=function(t){function e(e){t.call(this),this.factory=e}return n(e,t),e.prototype.initializeInstance=function(t){var e=t;1!==this.reuse&&(this.instance=t),0===this.owner&&e.dispose&&this.container.trackDisposable(e),this.initializer&&this.initializer(this.container,t)},e.prototype.initializedBy=function(t){return this.initializer=t,this},e.prototype.cloneFor=function(t){return e.build({reuse:this.reuse,owner:this.owner,factory:this.factory,container:t,initializer:this.initializer})},e.build=function(t){var i=new e(t.factory);return i.owner=t.owner,i.reuse=t.reuse,i.instance=t.instance,i.container=t.container,i.initializer=t.initializer,i},e}(r.ServiceEntry);i.GenericServiceEntry=o},{"./ServiceEntry":11}],10:[function(t,e,i){"use strict";var n=function(){function t(){}return t.resolve=function(e){return"string"==typeof e?e:e.name||t.resolveByCode(e)},t.resolveByCode=function(e){var i=e.toString().match(t.nameRegex);return i&&i.length>0&&i[1]||t.resolveByPrototype(e)},t.resolveByPrototype=function(t){var e=new Array,i=t.prototype;for(var n in i)e.push(n);return e.join("")},t.nameRegex=/function ([^\(]+)/,t}();i.NameResolver=n},{}],11:[function(t,e,i){"use strict";var n=function(){function t(){}return t.prototype.ownedByContainer=function(){this.owner=0},t.prototype.ownedExternally=function(){return this.owner=1,this},t.prototype.asSingleton=function(){return this.reuse=0,this},t.prototype.asTransient=function(){return this.reuse=1,this},t}();i.ServiceEntry=n},{}],12:[function(t,e,i){"use strict";var n=t("./NameResolver"),r=function(){function t(t,e){this.ctor=t,this.serviceName=e,this.key=n.NameResolver.resolve(t),e&&(this.key+=e)}return t.prototype.toString=function(){return this.key},t}();i.ServiceKey=r},{"./NameResolver":10}],13:[function(t,e,i){"use strict";var n=t("../metrics/MetricType"),r=function(){function t(){}return t.prototype.serialize=function(t){var e={};return t.forEach(function(t){return e[n.MetricType[t.type]]=t.value}),JSON.stringify(e)},t}();i.JSONSerializer=r},{"../metrics/MetricType":25}],14:[function(t,e,i){"use strict";var n=function(){function t(){}return t.prototype.serialize=function(t){var e=[];return t.forEach(function(t){e.push(t.type+"="+encodeURIComponent(t.value))}),e.join("&")},t}();i.QueryStringSerializer=n},{}],15:[function(t,e,i){"use strict";var n=function(){function t(t){this.isLast=!1,this.oneTime=!1,this.inactivityDetectedTime=0,this.inactivityDetected=!1,this.inactivityAggregatedTime=0,this.navigationStart=t.navigationStart}return t.prototype.tryAccumulateInactivityTime=function(){var t=Date.now();this.inactivityDetected&&(this.inactivityAggregatedTime+=t-this.inactivityDetectedTime,this.inactivityDetectedTime=t)},t.prototype.markActivity=function(){this.tryAccumulateInactivityTime(),this.inactivityDetected=!1},t.prototype.markInactivity=function(){this.inactivityDetected=!0,this.inactivityDetectedTime=Date.now()},t.prototype.getMetric=function(){return this.tryAccumulateInactivityTime(),{type:this.getMetricType(),value:Date.now()-this.navigationStart-this.inactivityAggregatedTime}},t}();i.AbstractActivityMetric=n},{}],16:[function(t,e,i){"use strict";var n=function(){function t(){}return t.prototype.registerNotification=function(t){return this.callback=t,this},t.prototype.notify=function(){this.callback()},t}();i.AbstractEventRule=n},{}],17:[function(t,e,i){"use strict";var n=function(){function t(t){this.identificationService=t,this.isLast=!0,this.oneTime=!1}return t.prototype.getMetric=function(){return{type:this.type,value:this.getMetricValue(this.identificationService.getIdentification())}},t}();i.AbstractIdentificationMetric=n},{}],18:[function(t,e,i){"use strict";var n=t("./MetricType"),r=function(){function t(t){this.timing=t,this.isLast=!1,this.oneTime=!0}return t.prototype.getMetric=function(){return{type:n.MetricType.domContentLoaded,value:this.timing.domContentLoadedEventEnd-this.timing.navigationStart}},t}();i.DOMLContentLoadedTimeMetric=r},{"./MetricType":25}],19:[function(t,e,i){"use strict";var n=t("./MetricType"),r=function(){function t(){this.isLast=!1,this.oneTime=!0}return t.prototype.getMetric=function(){return{value:document.referrer,type:n.MetricType.documentReferrer}},t}();i.DocumentReferrerMetric=r},{"./MetricType":25}],20:[function(t,e,i){"use strict";var n=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},r=t("./MetricType"),o=t("./AbstractActivityMetric"),s=function(t){function e(e,i,n){t.call(this,n),this.hub=e,this.config=i,this.intervalId=0,this.hub.bind(e.userEvents,this.onEventRaised.bind(this)),this.guardInactivityTime()}return n(e,t),e.prototype.getMetricType=function(){return r.MetricType.engagementTime},e.prototype.guardInactivityTime=function(){var t=this;clearTimeout(this.intervalId),this.intervalId=setTimeout(function(){t.markInactivity()},this.config.metrics.inactivityTime)},e.prototype.onEventRaised=function(t){this.markActivity(),this.guardInactivityTime()},e.prototype.dispose=function(t){clearTimeout(this.intervalId)},e}(o.AbstractActivityMetric);i.EngagementTimeAggregatorMetric=s},{"./AbstractActivityMetric":15,"./MetricType":25}],21:[function(t,e,i){"use strict";var n=t("./MetricType"),r=function(){function t(t){this.id=t,this.isLast=!0,this.oneTime=!1}return t.prototype.getMetric=function(){return{value:this.id,type:n.MetricType.messageId}},t}();i.IdMetric=r},{"./MetricType":25}],22:[function(t,e,i){"use strict";var n=t("./MetricType"),r=t("../eventHubs/EventType"),o=function(){function t(t){this.hub=t,this.isLast=!1,this.oneTime=!1,this.jsErrorCounter=0,this.hub.bind([r.EventType.error],this.onEventRaised.bind(this))}return t.prototype.onEventRaised=function(t){this.jsErrorCounter++},t.prototype.getMetric=function(){return{value:this.jsErrorCounter,type:n.MetricType.jsErrorCount}},t}();i.JSErrorCountMetric=o},{"../eventHubs/EventType":6,"./MetricType":25}],23:[function(t,e,i){"use strict";var n=t("./MetricType"),r=function(){function t(){this.oneTime=!0,this.isLast=!1}return t.prototype.getMetric=function(){return{value:location.href,type:n.MetricType.location}},t}();i.LocationMetric=r},{"./MetricType":25}],24:[function(t,e,i){"use strict";var n=t("../eventHubs/EventType"),r=function(){function t(t,e,i,r,o){var s=this;this.metrics=t,this.config=i,this.idMetricFactory=r,this.serializableFactory=o,this.reliable=!0,this.metricCounter=0,this.messageType=0,this.serilaizer=o.getSerializer(),e.bindTop([n.EventType.beforeunload,n.EventType.unload],function(){s.terminate()})}return t.prototype.terminate=function(){this.messageType=2,this.serilaizer=this.serializableFactory.getSerializer(),this.metrics=this.metrics.filter(function(t){return t.isLast})},t.prototype.getMetrics=function(){var t,e=this.getMetricId(),i=this.idMetricFactory(e);return t=this.metrics.concat([i]),{id:e,type:this.messageType,reliable:this.reliable,metrics:this.serilaizer.serialize(t.map(function(t){return t.getMetric()}))}},t.prototype.resolveMetrics=function(t){t.reliable&&(this.reliable=!1,this.messageType=1,this.metrics=this.metrics.filter(function(t){return!t.oneTime}))},t.prototype.getMetricId=function(){return this.reliable?this.metricCounter:++this.metricCounter},t}();i.MetricAggregator=r},{"../eventHubs/EventType":6}],25:[function(t,e,i){"use strict";var n;!function(t){t[t.visitId=3]="visitId",t[t.version=6]="version",t[t.screenX=16]="screenX",t[t.screenY=17]="screenY",t[t.browser=18]="browser",t[t.location=7]="location",t[t.visitorId=2]="visitorId",t[t.projectId=1]="projectId",t[t.messageId=5]="messageId",t[t.eventIds=20]="eventIds",t[t.pageviewId=4]="pageviewId",t[t.timestamp=31]="timestamp",t[t.attention=32]="attention",t[t.timeOnPage=12]="timeOnPage",t[t.numOfClicks=14]="numOfClicks",t[t.scrollReach=13]="scrollReach",t[t.jsErrorCount=11]="jsErrorCount",t[t.engagementTime=9]="engagementTime",t[t.lackOfInterest=30]="lackOfInterest",t[t.documentReferrer=8]="documentReferrer",t[t.domContentLoaded=10]="domContentLoaded",t[t.browserWithVersion=19]="browserWithVersion",t[t.returningOrNewVisitor=21]="returningOrNewVisitor",t[t.durationSinceLastVisit=15]="durationSinceLastVisit"}(n||(n={})),i.MetricType=n},{}],26:[function(t,e,i){"use strict";var n=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},r=t("./AbstractEventRule"),o=function(t){function e(e){t.call(this),this.metricsAggregator=e,this.started=!1}return n(e,t),e.prototype.resolve=function(t){this.metricsAggregator.resolveMetrics(t)},e.prototype.reject=function(t){t.reliable&&this.started&&this.notify()},e.prototype.start=function(){this.started=!0},e.prototype.stop=function(){this.started=!1},e}(r.AbstractEventRule);i.MetricsPromise=o},{"./AbstractEventRule":16}],27:[function(t,e,i){"use strict";var n=t("../eventHubs/EventType"),r=function(){function t(t,e,i,r,o,s){var c=this;this.notificationRules=t,this.hub=e,this.metricsAggregator=i,this.processor=r,this.promise=o,this.identificationService=s,t.forEach(function(t){return t.registerNotification(c.read.bind(c)).start()}),this.hub.bind([n.EventType.online,n.EventType.offline],function(){c.applyOnNotificationRules(function(t){return navigator.onLine?t.start():t.stop()})})}return t.prototype.read=function(){var t=this.metricsAggregator.getMetrics();t.isEmpty||(this.identificationService.modifyIdentification(),this.processor.process(t.metrics,{id:t.id,promise:this.promise,type:t.type,reliable:t.reliable}))},t.prototype.dispose=function(t){t||this.read(),this.applyOnNotificationRules(function(t){return t.stop()})},t.prototype.applyOnNotificationRules=function(t){this.notificationRules.forEach(function(e){return t(e)})},t}();i.MetricsReader=r},{"../eventHubs/EventType":6}],28:[function(t,e,i){"use strict";var n=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},r=t("./MetricType"),o=t("./AbstractIdentificationMetric"),s=function(t){function e(e){t.call(this,e),this.type=r.MetricType.pageviewId}return n(e,t),e.prototype.getMetricValue=function(t){return t.PageView},e}(o.AbstractIdentificationMetric);i.PageViewIdentificationMetric=s},{"./AbstractIdentificationMetric":17,"./MetricType":25}],29:[function(t,e,i){"use strict";var n=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},r=t("./AbstractEventRule"),o=function(t){function e(e){t.call(this),this.config=e,this.firstFibNumber=0,this.secondFibNumber=1,this.maxIntervalReached=!1,this.maxFetchInterval=this.config.metrics.maxFetchInterval}return n(e,t),e.prototype.start=function(){var t=this,e=this.maxIntervalReached?this.maxFetchInterval:this.getFetchInterval();this.timeoutId=setTimeout(function(){t.notify(),t.start()},e)},e.prototype.stop=function(){clearInterval(this.timeoutId)},e.prototype.dispose=function(t){this.stop()},e.prototype.getFetchInterval=function(){var t=this.firstFibNumber+this.secondFibNumber,e=1e3*t;return e>this.maxFetchInterval?(this.maxIntervalReached=!0,this.maxFetchInterval):(this.firstFibNumber=this.secondFibNumber,this.secondFibNumber=t,e)},e}(r.AbstractEventRule);i.PeriodicalNotifierRule=o},{"./AbstractEventRule":16}],30:[function(t,e,i){"use strict";var n=t("./MetricType"),r=function(){function t(t){this.projectId=t,this.isLast=!0,this.oneTime=!1}return t.prototype.getMetric=function(){return{value:this.projectId,type:n.MetricType.projectId}},t}();i.ProjectIdMetric=r},{"./MetricType":25}],31:[function(t,e,i){"use strict";var n=t("./MetricType"),r=function(){function t(t){this.identificationService=t,this.isLast=!0,this.oneTime=!1}return t.prototype.getMetric=function(){return{type:n.MetricType.returningOrNewVisitor,value:this.identificationService.isNewIdentification}},t}();i.ReturningOrNewVisitorMetric=r},{"./MetricType":25}],32:[function(t,e,i){"use strict";var n=t("./MetricType"),r=t("../eventHubs/EventType"),o=function(){function t(t){this.hub=t,this.isLast=!0,this.oneTime=!1,this.maxScrollReach=0,this.hub.bind([r.EventType.scroll],this.onEventRaised.bind(this))}return t.prototype.onEventRaised=function(t){var e=document.documentElement.clientHeight,i=document.documentElement.scrollTop||document.body.scrollTop,n=document.documentElement.scrollHeight||document.body.scrollHeight,r=i/(n-e)*100;this.maxScrollReach=Math.max(r,this.maxScrollReach)},t.prototype.getMetric=function(){return{value:this.maxScrollReach,type:n.MetricType.scrollReach}},t}();i.ScrollReachMetric=o},{"../eventHubs/EventType":6,"./MetricType":25}],33:[function(t,e,i){"use strict";var n=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},r=t("./MetricType"),o=t("../eventHubs/EventType"),s=t("./AbstractActivityMetric"),c=function(t){function e(e,i){t.call(this,i),this.hub=e,this.hub.bind([o.EventType.visibilitychange],this.onEventRaised.bind(this))}return n(e,t),e.prototype.getMetricType=function(){return r.MetricType.timeOnPage},e.prototype.onEventRaised=function(t){document.hidden?this.markInactivity():this.markActivity()},e}(s.AbstractActivityMetric);i.TimeOnPageMetric=c},{"../eventHubs/EventType":6,"./AbstractActivityMetric":15,"./MetricType":25}],34:[function(t,e,i){"use strict";var n=t("./MetricType"),r=function(){function t(){this.isLast=!1,this.oneTime=!0}return t.prototype.getMetric=function(){return{value:1,type:n.MetricType.version}},t}();i.VersionMetric=r},{"./MetricType":25}],35:[function(t,e,i){"use strict";var n=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},r=t("./MetricType"),o=t("./AbstractIdentificationMetric"),s=function(t){function e(e){t.call(this,e),this.type=r.MetricType.visitId}return n(e,t),e.prototype.getMetricValue=function(t){return t.Visit},e}(o.AbstractIdentificationMetric);i.VisitIdentificationMetric=s},{"./AbstractIdentificationMetric":17,"./MetricType":25}],36:[function(t,e,i){"use strict";var n=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},r=t("./MetricType"),o=t("./AbstractIdentificationMetric"),s=function(t){function e(e){t.call(this,e),this.type=r.MetricType.visitorId}return n(e,t),e.prototype.getMetricValue=function(t){return t.Visitor},e}(o.AbstractIdentificationMetric);i.VisitorIdentificationMetric=s},{"./AbstractIdentificationMetric":17,"./MetricType":25}],37:[function(t,e,i){"use strict";var n=function(){function t(){}return t.prototype["delete"]=function(t){this.write(t,"",-1)},t.prototype.read=function(t){var e=0,i=0,n=document.cookie.split(";");t+="=";for(var r=0,o=n;r<o.length;r++){var s=o[r];if(0===s.trim().indexOf(t))return e=i+s.length,i=i+s.split("=")[0].length+1,document.cookie.substring(i,e);i+=s.length+1}return null},t.prototype.write=function(t,e,i){var n="";if(i){var r=new Date;r.setTime(r.getTime()+864e5*i),n="; expires="+r.toUTCString()}document.cookie=t+"="+e+n+"; path=/;"},t}();i.CookiesService=n},{}],38:[function(t,e,i){"use strict";var n=t("../../eventHubs/EventType"),r=function(){function t(t,e,i,r){var o=this;this.container=e,this.config=i,this.app=r;var s=this.dispose.bind(this);this.transportChannel=i.transport.mainChannel,setTimeout(s,i.identification.visitTimeSpan),t.bind([n.EventType.unload,n.EventType.beforeunload],function(){return o.dispose()}),this.channelFactory=this.resolveChannel(this.transportChannel)}return t.prototype.resolveChannel=function(t){return this.container.resolveNamedFactory(t,"channel")},t.prototype.getSerializer=function(){return this.container.resolveNamed(this.transportChannel,"serializer");
},t.prototype.getChannel=function(t){return this.channelFactory(t)},t.prototype.dispose=function(t){this.transportChannel=this.config.transport.terminalChannel,this.metricAggregator.terminate(),this.channelFactory=this.resolveChannel(this.transportChannel),this.container.dispose(t),this.app.stop()},t.prototype.shutdown=function(){this.dispose(!0)},t}();i.Disposer=r},{"../../eventHubs/EventType":6}],39:[function(t,e,i){"use strict";var n=function(){function t(){}return t.prototype.generate=function(){return Math.floor(Math.random()*t.maxNumber)},t.maxNumber=Math.pow(2,53)-1,t}();i.IdGenerator=n},{}],40:[function(t,e,i){"use strict";var n=function(){function t(t,e,i){this.idGenerator=t,this.cookiesService=e,this.config=i,this.cookie="ctm",this.isNewIdentification=!1,this.setOrAddIdentification(),this.setIdentification()}return t.prototype.setIdentification=function(){this.identification={Visit:this.storedIdentification.vst,Visitor:this.storedIdentification.vstr,PageView:this.storedIdentification.pgv,LastModified:this.storedIdentification.intr}},t.prototype.getIdentification=function(){return this.identification},t.prototype.setOrAddIdentification=function(){var t=this.cookiesService.read("ctm");if(t)try{var e=JSON.parse(t);if(this.validate(e))return this.isInVisitRange(e)||(e.vst=this.idGenerator.generate()),e.pgv=this.idGenerator.generate(),e.intr=Date.parse((new Date).toUTCString()),this.updateCookie(e),void(this.storedIdentification=e)}catch(i){}this.createIdentification()},t.prototype.isInVisitRange=function(t){return Date.parse((new Date).toUTCString())-t.intr<this.config.identification.visitTimeSpan},t.prototype.createIdentification=function(){this.updateCookie(this.storedIdentification={pgv:this.idGenerator.generate(),vst:this.idGenerator.generate(),vstr:this.idGenerator.generate(),intr:Date.parse((new Date).toUTCString())}),this.isNewIdentification=!0},t.prototype.validate=function(t){return["vst","pgv","vstr","intr"].every(function(e){var i;return(i=t[e])?!isNaN(i):!1})},t.prototype.modifyIdentification=function(){var t=Date.parse((new Date).toUTCString());this.storedIdentification.intr=this.identification.LastModified=t,this.updateCookie(this.storedIdentification)},t.prototype.updateCookie=function(t){var e=JSON.stringify(t);this.cookiesService.write(this.cookie,e,this.config.identification.expirationDays)},t}();i.IdentificationService=n},{}],41:[function(t,e,i){"use strict";var n=function(){function t(){}return t.extend=function(e){for(var i,n,r,o,s,c,a=arguments.length,u=1;a>u;u++)if(i=arguments[u])for(n in i)r=e[n],o=i[n],e!==o&&(o&&(t.isPlainObject(o)||(s=Array.isArray(o)))?(s?(s=!1,c=r&&Array.isArray(r)?r:[]):c=r&&t.isPlainObject(r)?r:{},e[n]=t.extend(c,o)):void 0!==o&&(e[n]=o));return e},t.isPlainObject=function(e){return"object"!==t.type(e)||e.nodeType||e===window?!1:!e.constructor||t.hasOwn.call(e.constructor.prototype,"isPrototypeOf")},t.type=function(e){return null==e?e+"":"object"==typeof e||"function"==typeof e?t.class2type[t.toString.call(e)]||"object":typeof e},t.class2type={},t.toString=t.class2type.toString,t.hasOwn=t.class2type.hasOwnProperty,t}();i.ObjectExtender=n},{}],42:[function(t,e,i){"use strict";var n=function(){function t(t){this.tokenizer=/ (\w+)(?:\/([\w\.]+))? (?:(\([^\)]+\)) )?/gim,this.userAgent=this.detect(" "+(t||navigator.userAgent)+" "),this.isBrowserSupported=this.checkBrowserSupport(this.userAgent.browser,this.userAgent.is)}return t.prototype.detect=function(t){var e=window.XMLHttpRequest,i=this.tokenize(t),n={is:{mobile:!1},browser:{version:6}},r=n.browser,o=i.Mozilla&&i.Mozilla.extra?i.Mozilla.extra:null;n.supports={sendBeacon:!!navigator.sendBeacon,binaryTransport:e&&"withCredentials"in new XMLHttpRequest};if(i.Opera)return r.version=0,r.type=1,n;if(i.Edge)return r.type=0,r.version=parseInt(i.Edge.value),n.is.mobile=-1!==t.indexOf("Windows Phone; "),n;if(o){var s=void 0,c=o.indexOf("MSIE "),a=o.indexOf("; Trident/"),u=c+a>-1;if(u&&(s=-1!==c?c:o.indexOf("; rv:"),-1!==s))return r.type=7,r.version=parseFloat(o.substr(s+5,3)),n.is.mobile=-1!==o.indexOf("; Touch")||-1!==o.indexOf("; IEMobile/"),n}if(i.Firefox&&i.Firefox.value)return r.type=5,r.version=parseFloat(i.Firefox.value),n.is.mobile=o&&-1!==o.indexOf("Android; "),n;if((i.Chrome&&i.Chrome.value||i.CriOS&&i.CriOS.value)&&!i.Version)return r.type=3,r.version=parseFloat(i.Chrome?i.Chrome.value:i.CriOS.value),n.is.mobile=i.CriOS||o&&-1!==o.indexOf("; Android "),n;if(i.Safari){if(o&&-1!==o.indexOf("; Android ")&&i.AppleWebKit&&i.AppleWebKit.value)return r.type=2,r.version=parseFloat(i.AppleWebKit.value),n.is.mobile=!0,n;o&&-1===o.indexOf("Windows")&&i.Version&&i.Version.value&&(r.type=4,r.version=parseFloat(i.Version.value),n.is.mobile=!!i.Mobile)}return n},t.prototype.checkBrowserSupport=function(t,e){return 0===t.type&&!e.mobile||3===t.type&&t.version>=9||2===t.type&&t.version>=534||5===t.type&&t.version>=25&&!e.mobile||4===t.type&&t.version>=5.1&&t.version<=10||7===t.type&&t.version>9&&!e.mobile},t.prototype.tokenize=function(t){for(var e,i={};e=this.tokenizer.exec(t);)i[e[1]]={value:e[2],extra:e[3]},this.tokenizer.lastIndex--;return i},t}();i.UserAgentService=n},{}],43:[function(t,e,i){"use strict";var n=function(){function t(t){this.settings=t}return t.prototype.onRequestSuccess=function(t){this.reset(),this.settings.sendPromise.resolve(t)},t.prototype.onRequestFailure=function(t){var e=this;this.reset(),setTimeout(function(){e.settings.sendPromise.reject(t)},this.settings.waitInterval)},t}();i.AbstractTransportChannel=n},{}],44:[function(t,e,i){"use strict";var n=function(){function t(t){this.settings=t}return t.prototype.send=function(t,e){var i=e.message.data;navigator.sendBeacon(t+"&"+i)?this.settings.sendPromise.resolve(e):this.settings.sendPromise.reject(e)},t}();i.BeaconTransportChannel=n},{}],45:[function(t,e,i){"use strict";var n=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},r=t("./AbstractTransportChannel"),o=function(t){function e(e){t.call(this,e),this.image=new Image}return n(e,t),e.prototype.send=function(t,e){var i=this,n=e.message.data;this.image.onload=function(){i.onRequestSuccess(e)},this.image.onerror=function(){i.onRequestFailure(e)},this.image.src+=t+"&"+n+"&r="+Date.now()},e.prototype.reset=function(){this.image=this.image.onerror=this.image.onload=null},e}(r.AbstractTransportChannel);i.ImageTransportChannel=o},{"./AbstractTransportChannel":43}],46:[function(t,e,i){"use strict";var n=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},r=t("./AbstractTransportChannel"),o=function(t){function e(e){t.call(this,e),this.xhr=new XMLHttpRequest}return n(e,t),e.prototype.send=function(t,e){var i=this,n=this.xhr,r=e.message.data;try{n.open("POST",t),n.timeout=3e4,n.setRequestHeader("Content-Type","text/plain"),this.xhr.onreadystatechange=function(){4===n.readyState&&(200===n.status?i.onRequestSuccess(e):i.onRequestFailure(e))},n.onload=function(){i.onRequestSuccess(e)},n.onerror=n.ontimeout=n.onabort=function(){i.onRequestFailure(e)},n.send(r)}catch(o){this.onRequestFailure(e)}},e.prototype.reset=function(){this.xhr=this.xhr.onabort=this.xhr.ontimeout=this.xhr.onerror=this.xhr.onload=this.xhr.onreadystatechange=null},e}(r.AbstractTransportChannel);i.TransportChannelXhr=o},{"./AbstractTransportChannel":43}]},{},[2])(2)}),"function"==typeof window.ClickTaleMonitorOnReady&&ClickTaleMonitorOnReady()}();