!function() {(function(f){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=f()}else if(typeof define==="function"&&define.amd){define([],f)}else{var g;if(typeof window!=="undefined"){g=window}else if(typeof global!=="undefined"){g=global}else if(typeof self!=="undefined"){g=self}else{g=this}g.ClickTaleMonitor = f()}})(function(){var define,module,exports;return (function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
"use strict";
var Hub_1 = require("../eventHubs/Hub");
var Container_1 = require("../ioc/Container");
var IdMetric_1 = require("../metrics/IdMetric");
var Configuration_1 = require("../config/Configuration");
var Disposer_1 = require("../services/disposer/Disposer");
var MetricsReader_1 = require("../metrics/MetricsReader");
var VersionMetric_1 = require("../metrics/VersionMetric");
var BrowserMetric_1 = require("../metrics/BrowserMetric");
var EventIdsMetric_1 = require("../metrics/EventIdsMetric");
var LocationMetric_1 = require("../metrics/LocationMetric");
var MetricsPromise_1 = require("../metrics/MetricsPromise");
var JSONSerializer_1 = require("../messaging/JSONSerializer");
var AttentionMetric_1 = require("../metrics/AttentionMetric");
var ProjectIdMetric_1 = require("../metrics/ProjectIdMetric");
var TimeOnPageMetric_1 = require("../metrics/TimeOnPageMetric");
var MetricAggregator_1 = require("../metrics/MetricAggregator");
var ScrollReachMetric_1 = require("../metrics/ScrollReachMetric");
var IdGenerator_1 = require("../services/idGenerator/IdGenerator");
var IsNewVisitorMetric_1 = require("../metrics/IsNewVisitorMetric");
var JSErrorCountMetric_1 = require("../metrics/JSErrorCountMetric");
var CookiesService_1 = require("../services/cookies/CookiesService");
var CompositeInactivity_1 = require("../metrics/CompositeInactivity");
var BrowserVersionMetric_1 = require("../metrics/BrowserVersionMetric");
var LackOfInterestMetric_1 = require("../metrics/LackOfInterestMetric");
var NumberOfClicksMetric_1 = require("../metrics/NumberOfClicksMetric");
var XhrTransportChannel_1 = require("../transport/XhrTransportChannel");
var ResolutionWidthMetric_1 = require("../metrics/ResolutionWidthMetric");
var DistributionService_1 = require("../distribution/DistributionService");
var UserAgentService_1 = require("../services/userAgent/UserAgentService");
var QueryStringSerializer_1 = require("../messaging/QueryStringSerializer");
var ImageTransportChannel_1 = require("../transport/ImageTransportChannel");
var DocumentReferrerMetric_1 = require("../metrics/DocumentReferrerMetric");
var PeriodicalNotifierRule_1 = require("../metrics/PeriodicalNotifierRule");
var ResolutionHeightMetric_1 = require("../metrics/ResolutionHeightMetric");
var BeaconTransportChannel_1 = require("../transport/BeaconTransportChannel");
var VisitIdentificationMetric_1 = require("../metrics/VisitIdentificationMetric");
var DOMLContentLoadedTimeMetric_1 = require("../metrics/DOMLContentLoadedTimeMetric");
var VisitorIdentificationMetric_1 = require("../metrics/VisitorIdentificationMetric");
var PageViewIdentificationMetric_1 = require("../metrics/PageViewIdentificationMetric");
var IdentificationService_1 = require("../services/identification/IdentificationService");
var EngagementTimeAggregatorMetric_1 = require("../metrics/EngagementTimeAggregatorMetric");
var App = (function () {
    function App(projectId) {
        var _this = this;
        this.projectId = projectId;
        this.bootstrap(function () {
            if (_this.tryRegisterComponents()) {
                _this.start();
            }
        });
    }
    App.prototype.bootstrap = function (callback) {
        if (!App.isMonitoring) {
            if (/complete|interactive/.test(document.readyState)) {
                return callback();
            }
            document.addEventListener("DOMContentLoaded", callback, false);
        }
    };
    App.prototype.start = function () {
        var disposer = App.container.resolve("Disposer");
        App.isMonitoring = true;
        App.container.resolve("Hub");
        App.container.resolve("CompositeInactivity");
        App.container.resolve("MetricsReader");
        App.container.resolve("DistributionService");
        disposer.metricAggregator = App.container.resolve("MetricAggregator");
    };
    App.prototype.tryRegisterComponents = function () {
        var _this = this;
        var userAgentService = new UserAgentService_1.UserAgentService();
        if (userAgentService.isBrowserSupported) {
            App.container = new Container_1.Container();
            this.eventRepository = new EventIdsMetric_1.EventIdsMetric();
            App.container.register("Hub", function (c) { return new Hub_1.Hub(userAgentService); });
            App.container.registerInstance(userAgentService);
            App.registerTransportChannels(userAgentService.userAgent, Configuration_1.Configuration);
            App.container.register("IdGenerator", function (c) { return new IdGenerator_1.IdGenerator(); });
            App.container.register("VersionMetric", function (c) { return new VersionMetric_1.VersionMetric(); });
            App.container.register("LocationMetric", function (c) { return new LocationMetric_1.LocationMetric(); });
            App.container.register("CookiesService", function (c) { return new CookiesService_1.CookiesService(); });
            App.container.register("BrowserMetric", function (c) { return new BrowserMetric_1.BrowserMetric(userAgentService); });
            App.container.register("ResolutionWidthMetric", function (c) { return new ResolutionWidthMetric_1.ResolutionWidthMetric(); });
            App.container.registerNamedInstance("EventIdsMetric", this.eventRepository);
            App.container.register("ProjectIdMetric", function (c) { return new ProjectIdMetric_1.ProjectIdMetric(_this.projectId); });
            App.container.register("DocumentReferrerMetric", function (c) { return new DocumentReferrerMetric_1.DocumentReferrerMetric(); });
            App.container.register("ResolutionHeightMetric", function (c) { return new ResolutionHeightMetric_1.ResolutionHeightMetric(); });
            App.container.register("IdMetric", function (c, id) { return new IdMetric_1.IdMetric(id); }).asTransient();
            App.container.register("AttentionMetric", function (c) { return new AttentionMetric_1.AttentionMetric(performance.timing); });
            App.container.register("BrowserVersionMetric", function (c) { return new BrowserVersionMetric_1.BrowserVersionMetric(userAgentService); });
            App.container.register("ScrollReachMetric", function (c) { return new ScrollReachMetric_1.ScrollReachMetric(c.resolve("Hub")); });
            App.container.register("JSErrorCountMetric", function (c) { return new JSErrorCountMetric_1.JSErrorCountMetric(c.resolve("Hub")); });
            App.container.register("LackOfInterestMetric", function (c) { return new LackOfInterestMetric_1.LackOfInterestMetric(performance.timing); });
            App.container.register(Configuration_1.Configuration.transport.mainChannel + " serializer", function (c) { return new JSONSerializer_1.JSONSerializer(); });
            App.container.register("NumberOfClicksMetric", function (c) { return new NumberOfClicksMetric_1.NumberOfClicksMetric(c.resolve("Hub")); });
            App.container.register("PeriodicalNotifierRule", function (c) { return new PeriodicalNotifierRule_1.PeriodicalNotifierRule(Configuration_1.Configuration); });
            App.container.register(Configuration_1.Configuration.transport.terminalChannel + " serializer", function (c) { return new QueryStringSerializer_1.QueryStringSerializer(); });
            App.container.register("DOMLContentLoadedTimeMetric", function (c) { return new DOMLContentLoadedTimeMetric_1.DOMLContentLoadedTimeMetric(performance.timing); });
            App.container.register("TimeOnPageMetric", function (c) { return new TimeOnPageMetric_1.TimeOnPageMetric(c.resolve("Hub"), performance.timing); });
            App.container.register("Disposer", function (c) { return new Disposer_1.Disposer(c.resolve("Hub"), c, Configuration_1.Configuration, _this); }).ownedExternally();
            App.container.register("MetricsPromise", function (c) { return new MetricsPromise_1.MetricsPromise(c.resolve("MetricAggregator")); });
            App.container.register("IsNewVisitorMetric", function (c) { return new IsNewVisitorMetric_1.IsNewVisitorMetric(c.resolve("IdentificationService")); });
            App.container.register("VisitIdentificationMetric", function (c) { return new VisitIdentificationMetric_1.VisitIdentificationMetric(c.resolve("IdentificationService")); });
            App.container.register("VisitorIdentificationMetric", function (c) { return new VisitorIdentificationMetric_1.VisitorIdentificationMetric(c.resolve("IdentificationService")); });
            App.container.register("PageViewIdentificationMetric", function (c) { return new PageViewIdentificationMetric_1.PageViewIdentificationMetric(c.resolve("IdentificationService")); });
            App.container.register("EngagementTimeAggregatorMetric", function (c) { return new EngagementTimeAggregatorMetric_1.EngagementTimeAggregatorMetric(c.resolve("Hub"), Configuration_1.Configuration, performance.timing); });
            App.container.register("DistributionService", function (c) { return new DistributionService_1.DistributionService(_this, Configuration_1.Configuration, c.resolve("Hub"), c, c.resolve("Disposer")); });
            App.container.register("CompositeInactivity", function (c) { return new CompositeInactivity_1.CompositeInactivity(c.resolve("Hub"), c.resolve("LackOfInterestMetric"), c.resolve("AttentionMetric")); });
            App.container.register("IdentificationService", function (c) { return new IdentificationService_1.IdentificationService(c.resolve("IdGenerator"), c.resolve("CookiesService"), Configuration_1.Configuration); });
            App.container.register("MetricAggregator", function (c) {
                var metricArray = Configuration_1.Configuration.metrics.providers.map(function (metric) { return c.resolve(metric); });
                metricArray = metricArray.concat([
                    c.resolve("VersionMetric"),
                    c.resolve("LocationMetric"),
                    c.resolve("ProjectIdMetric"),
                    c.resolve("DocumentReferrerMetric"),
                    c.resolve("VisitIdentificationMetric"),
                    c.resolve("DOMLContentLoadedTimeMetric"),
                    c.resolve("VisitorIdentificationMetric"),
                    c.resolve("PageViewIdentificationMetric")
                ]);
                return new MetricAggregator_1.MetricAggregator(metricArray, c.resolve("Hub"), Configuration_1.Configuration, c.resolveFactory("IdMetric"), c.resolve("Disposer"));
            });
            App.container.register("MetricsReader", function (c) {
                var promise = c.resolve("MetricsPromise");
                return new MetricsReader_1.MetricsReader([
                    promise,
                    c.resolve("PeriodicalNotifierRule")], c.resolve("Hub"), c.resolve("MetricAggregator"), c.resolve("DistributionService"), promise, c.resolve("IdentificationService"));
            });
            return true;
        }
        return false;
    };
    App.prototype.shutdown = function () {
        this.dispose(true);
    };
    App.prototype.dispose = function (shutdown) {
        var disposer = App.container.resolve("Disposer");
        disposer.dispose(shutdown);
    };
    App.prototype.stop = function () {
        App.isMonitoring = false;
    };
    App.prototype.isMonitoring = function () {
        return App.isMonitoring;
    };
    App.prototype.setIdentification = function (identification) {
        var identificationService = App.container.resolve("IdentificationService");
        identificationService.setIdentification(identification);
    };
    App.registerTransportChannels = function (userAgent, config) {
        var transportConfig = config.transport;
        var browserType = userAgent.browser.type;
        var transportChannelTerminal = userAgent.supports.sendBeacon ? BeaconTransportChannel_1.BeaconTransportChannel : ImageTransportChannel_1.ImageTransportChannel;
        App.container.register(transportConfig.terminalChannel + " channel", function (c, settings) { return new transportChannelTerminal(settings); }).ownedExternally();
        App.container.register(transportConfig.mainChannel + " channel", function (c, settings) { return new XhrTransportChannel_1.TransportChannelXhr(settings); }).asTransient().ownedExternally();
    };
    App.prototype.addEvent = function (eventId) {
        this.eventRepository.addEvent(eventId);
    };
    App.isMonitoring = false;
    return App;
}());
exports.App = App;

},{"../config/Configuration":5,"../distribution/DistributionService":6,"../eventHubs/Hub":8,"../ioc/Container":9,"../messaging/JSONSerializer":14,"../messaging/QueryStringSerializer":15,"../metrics/AttentionMetric":21,"../metrics/BrowserMetric":22,"../metrics/BrowserVersionMetric":23,"../metrics/CompositeInactivity":24,"../metrics/DOMLContentLoadedTimeMetric":25,"../metrics/DocumentReferrerMetric":26,"../metrics/EngagementTimeAggregatorMetric":27,"../metrics/EventIdsMetric":28,"../metrics/IdMetric":29,"../metrics/IsNewVisitorMetric":30,"../metrics/JSErrorCountMetric":31,"../metrics/LackOfInterestMetric":32,"../metrics/LocationMetric":33,"../metrics/MetricAggregator":34,"../metrics/MetricsPromise":36,"../metrics/MetricsReader":37,"../metrics/NumberOfClicksMetric":38,"../metrics/PageViewIdentificationMetric":39,"../metrics/PeriodicalNotifierRule":40,"../metrics/ProjectIdMetric":41,"../metrics/ResolutionHeightMetric":42,"../metrics/ResolutionWidthMetric":43,"../metrics/ScrollReachMetric":44,"../metrics/TimeOnPageMetric":45,"../metrics/VersionMetric":46,"../metrics/VisitIdentificationMetric":47,"../metrics/VisitorIdentificationMetric":48,"../services/cookies/CookiesService":49,"../services/disposer/Disposer":50,"../services/idGenerator/IdGenerator":51,"../services/identification/IdentificationService":52,"../services/userAgent/UserAgentService":54,"../transport/BeaconTransportChannel":56,"../transport/ImageTransportChannel":57,"../transport/XhrTransportChannel":58}],2:[function(require,module,exports){
"use strict";
var App_1 = require("./App");
exports.App = App_1.App;

},{"./App":1}],3:[function(require,module,exports){
"use strict";
var EventType;
(function (EventType) {
    EventType[EventType["error"] = 0] = "error";
    EventType[EventType["keyup"] = 1] = "keyup";
    EventType[EventType["scroll"] = 2] = "scroll";
    EventType[EventType["resize"] = 3] = "resize";
    EventType[EventType["unload"] = 4] = "unload";
    EventType[EventType["online"] = 5] = "online";
    EventType[EventType["mouseup"] = 6] = "mouseup";
    EventType[EventType["offline"] = 7] = "offline";
    EventType[EventType["mousedown"] = 8] = "mousedown";
    EventType[EventType["mouseover"] = 9] = "mouseover";
    EventType[EventType["touchstart"] = 10] = "touchstart";
    EventType[EventType["beforeunload"] = 11] = "beforeunload";
    EventType[EventType["visibilitychange"] = 12] = "visibilitychange";
})(EventType || (EventType = {}));
exports.EventType = EventType;

},{}],4:[function(require,module,exports){
"use strict";
var Dictionary = (function () {
    function Dictionary() {
    }
    Dictionary.prototype.add = function (key, value) {
        this[key.toString()] = value;
    };
    Dictionary.prototype.remove = function (key) {
        delete this[key.toString()];
    };
    Dictionary.prototype.containsKey = function (key) {
        return !!this[key.toString()];
    };
    Dictionary.prototype.tryGetValue = function (key, entry) {
        var value = this[key.toString()];
        if (value) {
            entry.out = value;
            return true;
        }
        return false;
    };
    Dictionary.prototype.clear = function () {
        var _this = this;
        Object.keys(this).forEach(function (key) {
            delete _this[key];
        });
    };
    Dictionary.prototype.values = function () {
        var _this = this;
        return Object.keys(this).map(function (key) {
            return _this[key];
        });
    };
    return Dictionary;
}());
exports.Dictionary = Dictionary;

},{}],5:[function(require,module,exports){
"use strict";
var ObjectExtender_1 = require("../services/objectExtender/ObjectExtender");
var userConfig = window.ClickTaleMonitorSettings;
var Configuration = {
    metrics: {
        inactivityTime: 20000,
        maxFetchInterval: 10000,
        providers: [
            "BrowserMetric",
            "EventIdsMetric",
            "TimeOnPageMetric",
            "ScrollReachMetric",
            "IsNewVisitorMetric",
            "JSErrorCountMetric",
            "NumberOfClicksMetric",
            "BrowserVersionMetric",
            "ResolutionWidthMetric",
            "ResolutionHeightMetric",
            "EngagementTimeAggregatorMetric"
        ]
    },
    identification: {
        expirationDays: 365,
        visitTimeSpan: 1800000
    },
    transport: {
        url: "https://",
        mainChannel: "main",
        terminalChannel: "terminal"
    },
    distribution: {
        relaibleMessages: {
            retries: 2,
            waitInterval: 1000
        }
    }
};
exports.Configuration = Configuration;
Configuration = ObjectExtender_1.ObjectExtender.extend(Configuration, userConfig);

},{"../services/objectExtender/ObjectExtender":53}],6:[function(require,module,exports){
"use strict";
var EventType_1 = require("../eventHubs/EventType");
var Dictionary_1 = require("../collections/Dictionary");
var DistributionService = (function () {
    function DistributionService(app, config, hub, container, channelFactory) {
        var _this = this;
        this.app = app;
        this.config = config;
        this.hub = hub;
        this.container = container;
        this.channelFactory = channelFactory;
        this.isBrowserOnline = false;
        this.envelopeMap = new Dictionary_1.Dictionary();
        this.transportUrl = config.transport.url;
        this.channelSettings = {
            sendPromise: {
                reject: this.onTransportFailure,
                resolve: this.onTransportSuccess,
            },
            waitInterval: config.distribution.relaibleMessages.waitInterval
        };
        this.isBrowserOnline = navigator.onLine;
        this.hub.bind([EventType_1.EventType.online, EventType_1.EventType.offline], function () { return _this.isBrowserOnline = navigator.onLine; });
    }
    DistributionService.prototype.process = function (data, metrics) {
        var envelope;
        var message = { data: data };
        var outResult = {};
        if (!metrics.reliable || !this.envelopeMap.tryGetValue(metrics.id, outResult)) {
            envelope = {
                message: message,
                metrics: metrics,
                retries: this.config.distribution.relaibleMessages.retries
            };
            this.envelopeMap.add(metrics.id, envelope);
        }
        else {
            envelope = outResult.out;
            if (--envelope.retries < 0) {
                return this.app.shutdown();
            }
        }
        this.distributeEnvelope(envelope);
    };
    DistributionService.prototype.distributeEnvelope = function (envelope) {
        if (this.isBrowserOnline) {
            var url = this.transportUrl + "?t=" + envelope.metrics.type;
            var channel = this.channelFactory.getChannel(this.channelSettings);
            channel.send(url, envelope);
        }
    };
    DistributionService.prototype.onTransportSuccess = function (envelope) {
        envelope.metrics.promise.resolve(envelope.metrics);
    };
    DistributionService.prototype.onTransportFailure = function (envelope) {
        envelope.metrics.promise.reject(envelope.metrics);
    };
    return DistributionService;
}());
exports.DistributionService = DistributionService;

},{"../collections/Dictionary":4,"../eventHubs/EventType":7}],7:[function(require,module,exports){
arguments[4][3][0].apply(exports,arguments)
},{"dup":3}],8:[function(require,module,exports){
"use strict";
var EventType_1 = require("../eventHubs/EventType");
var Dictionary_1 = require("../collections/Dictionary");
var Hub = (function () {
    function Hub(userAgentService) {
        this.userAgentService = userAgentService;
        this.bindedPublish = this.publish.bind(this);
        this.subscribers = new Dictionary_1.Dictionary();
        this.documentEvents = [EventType_1.EventType.mousedown, EventType_1.EventType.mouseover, EventType_1.EventType.mouseup, EventType_1.EventType.keyup, EventType_1.EventType.visibilitychange];
        this.userEvents = [EventType_1.EventType.mouseover, EventType_1.EventType.mouseup, EventType_1.EventType.keyup, EventType_1.EventType.scroll, EventType_1.EventType.resize];
        this.windowEvents = [EventType_1.EventType.scroll, EventType_1.EventType.resize, EventType_1.EventType.online, EventType_1.EventType.offline, EventType_1.EventType.error, EventType_1.EventType.beforeunload, EventType_1.EventType.unload];
        this.init();
    }
    Hub.prototype.init = function () {
        var _this = this;
        if (this.userAgentService.userAgent.is.mobile) {
            this.userEvents.push(EventType_1.EventType.touchstart);
            this.documentEvents.push(EventType_1.EventType.touchstart);
        }
        this.documentEvents.concat(this.windowEvents).forEach(function (eventType) {
            _this.subscribers[eventType] = new Array();
        });
        this.bindBrowserEvents();
    };
    Hub.prototype.bind = function (eventTypes, callback) {
        this.bindInternal(eventTypes, callback);
    };
    Hub.prototype.unbind = function (eventTypes, callback) {
        var _this = this;
        eventTypes.forEach(function (eventType) {
            if (_this.subscribers) {
                var listeners = _this.subscribers[eventType];
                var index = listeners.indexOf(callback);
                if (index > -1) {
                    listeners.splice(index, 1);
                }
            }
        });
    };
    Hub.prototype.bindTop = function (eventTypes, callback) {
        this.bindInternal(eventTypes, callback, true);
    };
    Hub.prototype.bindInternal = function (eventTypes, callback, top) {
        var _this = this;
        if (top === void 0) { top = false; }
        var insertFn = top ? function (subs) { return subs.splice(0, 0, callback); } : function (subs) { return subs.push(callback); };
        eventTypes.forEach(function (eventType) { return insertFn(_this.subscribers[eventType]); });
    };
    Hub.prototype.unbindAll = function () {
        this.subscribers = null;
    };
    Hub.prototype.publish = function (event) {
        var eventType = EventType_1.EventType[event.type];
        this.subscribers[eventType].forEach(function (callback) { return callback(event); });
    };
    Hub.prototype.dispose = function (shutdown) {
        this.unbindAll();
        this.unbindBrowserEvents();
    };
    Hub.prototype.bindBrowserEvents = function () {
        var addEventListenerFactory = function (eventListenerRegistrator) {
            return eventListenerRegistrator.addEventListener;
        };
        this.bindUnbindBrowserEvent(addEventListenerFactory, window, this.windowEvents, this.bindedPublish);
        this.bindUnbindBrowserEvent(addEventListenerFactory, document, this.documentEvents, this.bindedPublish);
    };
    Hub.prototype.unbindBrowserEvents = function () {
        var removeEventListenerFactory = function (eventListenerRegistrator) {
            return eventListenerRegistrator.removeEventListener;
        };
        this.bindUnbindBrowserEvent(removeEventListenerFactory, window, this.windowEvents, this.bindedPublish);
        this.bindUnbindBrowserEvent(removeEventListenerFactory, document, this.documentEvents, this.bindedPublish);
    };
    Hub.prototype.bindUnbindBrowserEvent = function (factory, registrator, eventTypes, eventListener) {
        eventTypes.forEach(function (eventType) {
            var event = EventType_1.EventType[eventType];
            var eventListenerDefinition = factory(registrator);
            eventListenerDefinition.apply(registrator, [event, eventListener, false]);
        });
    };
    return Hub;
}());
exports.Hub = Hub;

},{"../collections/Dictionary":4,"../eventHubs/EventType":7}],9:[function(require,module,exports){
"use strict";
var ServiceKey_1 = require("./ServiceKey");
var Dictionary_1 = require("../collections/Dictionary");
var GenericServiceEntry_1 = require("./GenericServiceEntry");
var Container = (function () {
    function Container() {
        this.defaultOwner = 0 /* container */;
        this.defaultReuse = 0 /* container */;
        this.disposables = new Array();
        this.services = new Dictionary_1.Dictionary();
        var serviceEntry = GenericServiceEntry_1.GenericServiceEntry.build({
            instance: this,
            factory: function (c) { return c; },
            container: this,
            owner: 1 /* external */,
            reuse: 0 /* container */
        });
        this.services.add(new ServiceKey_1.ServiceKey(Container), serviceEntry);
    }
    Container.prototype.dispose = function (shutdown) {
        while (this.disposables.length > 0) {
            var disposable = this.disposables.shift();
            disposable.dispose(shutdown);
        }
    };
    Container.prototype.register = function (ctor, factory) {
        return this.registerNamed(ctor, null, factory);
    };
    Container.prototype.registerInstance = function (instance) {
        this.registerNamedInstance(null, instance);
    };
    Container.prototype.registerNamedInstance = function (name, instance) {
        var proto = Object.getPrototypeOf(instance);
        var ctor = proto.constructor;
        var entry = this.registerImpl(ctor, name, null);
        entry.asSingleton()
            .ownedExternally();
        entry.initializeInstance(instance);
    };
    Container.prototype.registerNamed = function (ctor, name, factory) {
        return this.registerImpl(ctor, name, factory);
    };
    Container.prototype.registerImpl = function (ctor, name, factory) {
        var key = new ServiceKey_1.ServiceKey(ctor, name);
        var entry = GenericServiceEntry_1.GenericServiceEntry.build({
            container: this,
            factory: factory,
            reuse: this.defaultReuse,
            owner: this.defaultOwner
        });
        this.services.add(key, entry);
        return entry;
    };
    Container.prototype.resolve = function (ctor, arg1, arg2, arg3, arg4) {
        var args = [ctor, null, arg1, arg2, arg3, arg4];
        return this.resolveNamed.apply(this, args);
    };
    Container.prototype.resolveNamed = function (ctor, name, arg1, arg, arg3, arg4) {
        var args = Array.prototype.slice.call(arguments, 2);
        return this.resolveImpl(ctor, name, args);
    };
    Container.prototype.resolveFactory = function (ctor) {
        return this.resolveNamedFactory(ctor, null);
    };
    Container.prototype.resolveNamedFactory = function (ctor, name) {
        var instance;
        var entry = this.getEntry(ctor, name);
        if (!entry) {
            return function () { return null; };
        }
        return function (arg1, arg2, arg3, arg4) {
            var args = [entry.container, arg1, arg2, arg3, arg4];
            instance = entry.instance;
            if (!instance) {
                instance = entry.factory.apply(null, args);
                entry.initializeInstance(instance);
            }
            return instance;
        };
    };
    Container.prototype.resolveImpl = function (ctor, name, args) {
        var instance;
        var entry = this.getEntry(ctor, name);
        if (!entry) {
            return null;
        }
        instance = entry.instance;
        if (!instance) {
            args = args || [];
            args.splice(0, 0, entry.container);
            instance = entry.factory.apply(null, args);
            entry.initializeInstance(instance);
        }
        return instance;
    };
    Container.prototype.getEntry = function (ctor, serviceName) {
        var container = this;
        var entry;
        var key = new ServiceKey_1.ServiceKey(ctor, serviceName);
        var outResult = {};
        if (this.services.tryGetValue(key, outResult)) {
            entry = outResult.out;
        }
        return entry;
    };
    Container.prototype.trackDisposable = function (instance) {
        this.disposables.push(instance);
    };
    return Container;
}());
exports.Container = Container;

},{"../collections/Dictionary":4,"./GenericServiceEntry":10,"./ServiceKey":13}],10:[function(require,module,exports){
"use strict";
var __extends = (this && this.__extends) || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
};
var ServiceEntry_1 = require("./ServiceEntry");
var GenericServiceEntry = (function (_super) {
    __extends(GenericServiceEntry, _super);
    function GenericServiceEntry(factory) {
        _super.call(this);
        this.factory = factory;
    }
    GenericServiceEntry.prototype.initializeInstance = function (instance) {
        var dynamicInstance = instance;
        if (this.reuse !== 1 /* none */) {
            this.instance = instance;
        }
        if (this.owner === 0 /* container */ && dynamicInstance.dispose) {
            this.container.trackDisposable(dynamicInstance);
        }
        if (this.initializer) {
            this.initializer(this.container, instance);
        }
    };
    GenericServiceEntry.prototype.initializedBy = function (initializer) {
        this.initializer = initializer;
        return this;
    };
    GenericServiceEntry.prototype.cloneFor = function (newContainer) {
        return GenericServiceEntry.build({
            reuse: this.reuse,
            owner: this.owner,
            factory: this.factory,
            container: newContainer,
            initializer: this.initializer
        });
    };
    GenericServiceEntry.build = function (bag) {
        var serviceEntry = new GenericServiceEntry(bag.factory);
        serviceEntry.owner = bag.owner;
        serviceEntry.reuse = bag.reuse;
        serviceEntry.instance = bag.instance;
        serviceEntry.container = bag.container;
        serviceEntry.initializer = bag.initializer;
        return serviceEntry;
    };
    return GenericServiceEntry;
}(ServiceEntry_1.ServiceEntry));
exports.GenericServiceEntry = GenericServiceEntry;

},{"./ServiceEntry":12}],11:[function(require,module,exports){
"use strict";
var NameResolver = (function () {
    function NameResolver() {
    }
    NameResolver.resolve = function (ctor) {
        var func = ctor;
        if (typeof ctor === "string") {
            return ctor;
        }
        return func.name || NameResolver.resolveByCode(func);
    };
    NameResolver.resolveByCode = function (ctor) {
        var match = ctor.toString().match(NameResolver.nameRegex);
        return (match && match.length > 0 && match[1]) || NameResolver.resolveByPrototype(ctor);
    };
    NameResolver.resolveByPrototype = function (ctor) {
        var buffer = new Array();
        var prototype = ctor.prototype;
        for (var item in prototype) {
            buffer.push(item);
        }
        return buffer.join("");
    };
    NameResolver.nameRegex = /function ([^\(]+)/;
    return NameResolver;
}());
exports.NameResolver = NameResolver;

},{}],12:[function(require,module,exports){
"use strict";
var ServiceEntry = (function () {
    function ServiceEntry() {
    }
    ServiceEntry.prototype.ownedByContainer = function () {
        this.owner = 0 /* container */;
    };
    ServiceEntry.prototype.ownedExternally = function () {
        this.owner = 1 /* external */;
        return this;
    };
    ServiceEntry.prototype.asSingleton = function () {
        this.reuse = 0 /* container */;
        return this;
    };
    ServiceEntry.prototype.asTransient = function () {
        this.reuse = 1 /* none */;
        return this;
    };
    return ServiceEntry;
}());
exports.ServiceEntry = ServiceEntry;

},{}],13:[function(require,module,exports){
"use strict";
var NameResolver_1 = require("./NameResolver");
var ServiceKey = (function () {
    function ServiceKey(ctor, serviceName) {
        this.ctor = ctor;
        this.serviceName = serviceName;
        this.key = serviceName || NameResolver_1.NameResolver.resolve(ctor);
    }
    ServiceKey.prototype.toString = function () {
        return this.key;
    };
    return ServiceKey;
}());
exports.ServiceKey = ServiceKey;

},{"./NameResolver":11}],14:[function(require,module,exports){
"use strict";
var MetricType_1 = require("../metrics/MetricType");
var JSONSerializer = (function () {
    function JSONSerializer() {
    }
    JSONSerializer.prototype.serialize = function (value) {
        var result = {};
        value.forEach(function (metric) { return result[MetricType_1.MetricType[metric.type]] = metric.value; });
        return JSON.stringify(result);
    };
    return JSONSerializer;
}());
exports.JSONSerializer = JSONSerializer;

},{"../metrics/MetricType":35}],15:[function(require,module,exports){
"use strict";
var QueryStringSerializer = (function () {
    function QueryStringSerializer() {
    }
    QueryStringSerializer.prototype.serialize = function (value) {
        var builder = [];
        value.forEach(function (item) {
            builder.push(item.type + "=" + encodeURIComponent(item.value));
        });
        return builder.join("&");
    };
    return QueryStringSerializer;
}());
exports.QueryStringSerializer = QueryStringSerializer;

},{}],16:[function(require,module,exports){
"use strict";
var AbstractActivityMetric = (function () {
    function AbstractActivityMetric(timing) {
        this.isLast = false;
        this.oneTime = false;
        this.inactivityDetectedTime = 0;
        this.inactivityDetected = false;
        this.inactivityAggregatedTime = 0;
        this.navigationStart = timing.navigationStart;
    }
    /**
    *  In case there are preceding calls to getMetric() during the inactivity period,
    *  this function will be called and the inactivityDetected flag will remain true.
    *  In order to avoid overlapping time accumulations we have to take the time difference
    *  between the current call and the previous one, by setting the inactivityDetectedTime
    *  to current time.
    */
    AbstractActivityMetric.prototype.tryAccumulateInactivityTime = function () {
        var now = Date.now();
        if (this.inactivityDetected) {
            this.inactivityAggregatedTime += now - this.inactivityDetectedTime;
            this.inactivityDetectedTime = now;
        }
    };
    AbstractActivityMetric.prototype.markActivity = function () {
        this.tryAccumulateInactivityTime();
        this.inactivityDetected = false;
    };
    AbstractActivityMetric.prototype.markInactivity = function () {
        this.inactivityDetected = true;
        this.inactivityDetectedTime = Date.now();
    };
    AbstractActivityMetric.prototype.getMetric = function () {
        this.tryAccumulateInactivityTime();
        return {
            type: this.getMetricType(),
            value: Date.now() - this.navigationStart - this.inactivityAggregatedTime
        };
    };
    return AbstractActivityMetric;
}());
exports.AbstractActivityMetric = AbstractActivityMetric;

},{}],17:[function(require,module,exports){
"use strict";
var AbstractEventRule = (function () {
    function AbstractEventRule() {
    }
    AbstractEventRule.prototype.registerNotification = function (callback) {
        this.callback = callback;
        return this;
    };
    AbstractEventRule.prototype.notify = function () {
        this.callback();
    };
    return AbstractEventRule;
}());
exports.AbstractEventRule = AbstractEventRule;

},{}],18:[function(require,module,exports){
"use strict";
var __extends = (this && this.__extends) || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
};
var AbstractMetric_1 = require("./AbstractMetric");
var AbstractIdentificationMetric = (function (_super) {
    __extends(AbstractIdentificationMetric, _super);
    function AbstractIdentificationMetric(identificationService) {
        _super.call(this, true, false);
        this.identification = identificationService.getIdentification();
    }
    return AbstractIdentificationMetric;
}(AbstractMetric_1.AbstractMetric));
exports.AbstractIdentificationMetric = AbstractIdentificationMetric;

},{"./AbstractMetric":20}],19:[function(require,module,exports){
"use strict";
var AbstractInactivityMetric = (function () {
    function AbstractInactivityMetric(timing) {
        this.isLast = false;
        this.oneTime = false;
        this.minInactivityValue = Math.pow(2, 53) - 1; // Max js number (needed for the first inactivity occurance)
        this.navigationStart = timing.navigationStart;
        this.inactivityCounter = this.inactivitySum = this.minInactivityValue = this.maxInactivityValue = 0;
    }
    AbstractInactivityMetric.prototype.calculateInactivity = function (currentTime) {
        if ((Date.now() - this.navigationStart) < 500) {
            return;
        }
        this.inactivityCounter++;
        this.lastActivityTime = currentTime;
        this.inactivitySum = this.inactivitySum + this.lastActivityTime;
        this.minInactivityValue = Math.min(this.lastActivityTime, this.minInactivityValue);
        this.maxInactivityValue = Math.max(this.lastActivityTime, this.maxInactivityValue);
    };
    AbstractInactivityMetric.prototype.getMetric = function () {
        return {
            type: this.getMetricType(),
            value: {
                sum: this.inactivitySum,
                max: this.maxInactivityValue,
                min: this.minInactivityValue,
                count: this.inactivityCounter
            }
        };
    };
    return AbstractInactivityMetric;
}());
exports.AbstractInactivityMetric = AbstractInactivityMetric;

},{}],20:[function(require,module,exports){
"use strict";
var AbstractMetric = (function () {
    function AbstractMetric(isLast, oneTime) {
        if (isLast === void 0) { isLast = false; }
        if (oneTime === void 0) { oneTime = true; }
        this.isLast = isLast;
        this.oneTime = oneTime;
    }
    AbstractMetric.prototype.getMetric = function () {
        return {
            type: this.type,
            value: this.getMetricValue()
        };
    };
    return AbstractMetric;
}());
exports.AbstractMetric = AbstractMetric;

},{}],21:[function(require,module,exports){
"use strict";
var __extends = (this && this.__extends) || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
};
var MetricType_1 = require("./MetricType");
var AbstractInactivityMetric_1 = require("./AbstractInactivityMetric");
var AttentionMetric = (function (_super) {
    __extends(AttentionMetric, _super);
    function AttentionMetric(timing) {
        _super.call(this, timing);
    }
    AttentionMetric.prototype.getMetricType = function () {
        return MetricType_1.MetricType.attention;
    };
    return AttentionMetric;
}(AbstractInactivityMetric_1.AbstractInactivityMetric));
exports.AttentionMetric = AttentionMetric;

},{"./AbstractInactivityMetric":19,"./MetricType":35}],22:[function(require,module,exports){
"use strict";
var __extends = (this && this.__extends) || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
};
var MetricType_1 = require("./MetricType");
var AbstractMetric_1 = require("./AbstractMetric");
var BrowserMetric = (function (_super) {
    __extends(BrowserMetric, _super);
    function BrowserMetric(userAgentService) {
        _super.call(this);
        this.type = MetricType_1.MetricType.browser;
        this.userAgent = userAgentService.userAgent;
    }
    BrowserMetric.prototype.getMetricValue = function () {
        return this.userAgent.browser.name;
    };
    return BrowserMetric;
}(AbstractMetric_1.AbstractMetric));
exports.BrowserMetric = BrowserMetric;

},{"./AbstractMetric":20,"./MetricType":35}],23:[function(require,module,exports){
"use strict";
var __extends = (this && this.__extends) || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
};
var MetricType_1 = require("./MetricType");
var AbstractMetric_1 = require("./AbstractMetric");
var BrowserVersionMetric = (function (_super) {
    __extends(BrowserVersionMetric, _super);
    function BrowserVersionMetric(userAgentService) {
        _super.call(this);
        this.type = MetricType_1.MetricType.browserVersion;
        this.userAgent = userAgentService.userAgent;
    }
    BrowserVersionMetric.prototype.getMetricValue = function () {
        return this.userAgent.browser.version;
    };
    return BrowserVersionMetric;
}(AbstractMetric_1.AbstractMetric));
exports.BrowserVersionMetric = BrowserVersionMetric;

},{"./AbstractMetric":20,"./MetricType":35}],24:[function(require,module,exports){
"use strict";
var CompositeInactivity = (function () {
    function CompositeInactivity(hub, lackOfInterestMetric, attentionMetric) {
        this.hub = hub;
        this.lackOfInterestMetric = lackOfInterestMetric;
        this.attentionMetric = attentionMetric;
        this.lastActivityDetectedTime = Date.now();
        this.hub.bind(hub.userEvents, this.onEventRaised.bind(this));
    }
    CompositeInactivity.prototype.onEventRaised = function (ev) {
        this.updateMetric();
    };
    CompositeInactivity.prototype.updateMetric = function () {
        var now = Date.now();
        var activityDetectedTimeDiff = now - this.lastActivityDetectedTime;
        if (activityDetectedTimeDiff <= 1000) {
            this.lackOfInterestMetric.calculateInactivity(activityDetectedTimeDiff);
        }
        else if (activityDetectedTimeDiff > 1000 && activityDetectedTimeDiff < 5000) {
            this.attentionMetric.calculateInactivity(activityDetectedTimeDiff);
        }
        this.lastActivityDetectedTime = now;
    };
    return CompositeInactivity;
}());
exports.CompositeInactivity = CompositeInactivity;

},{}],25:[function(require,module,exports){
"use strict";
var __extends = (this && this.__extends) || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
};
var MetricType_1 = require("./MetricType");
var AbstractMetric_1 = require("./AbstractMetric");
var DOMLContentLoadedTimeMetric = (function (_super) {
    __extends(DOMLContentLoadedTimeMetric, _super);
    function DOMLContentLoadedTimeMetric(timing) {
        _super.call(this);
        this.timing = timing;
        this.isLast = false;
        this.oneTime = true;
        this.type = MetricType_1.MetricType.domContentLoaded;
    }
    DOMLContentLoadedTimeMetric.prototype.getMetricValue = function () {
        return this.timing.domContentLoadedEventEnd - this.timing.navigationStart;
    };
    return DOMLContentLoadedTimeMetric;
}(AbstractMetric_1.AbstractMetric));
exports.DOMLContentLoadedTimeMetric = DOMLContentLoadedTimeMetric;

},{"./AbstractMetric":20,"./MetricType":35}],26:[function(require,module,exports){
"use strict";
var __extends = (this && this.__extends) || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
};
var MetricType_1 = require("./MetricType");
var AbstractMetric_1 = require("./AbstractMetric");
var DocumentReferrerMetric = (function (_super) {
    __extends(DocumentReferrerMetric, _super);
    function DocumentReferrerMetric() {
        _super.apply(this, arguments);
        this.type = MetricType_1.MetricType.documentReferrer;
    }
    DocumentReferrerMetric.prototype.getMetricValue = function () {
        return document.referrer;
    };
    return DocumentReferrerMetric;
}(AbstractMetric_1.AbstractMetric));
exports.DocumentReferrerMetric = DocumentReferrerMetric;

},{"./AbstractMetric":20,"./MetricType":35}],27:[function(require,module,exports){
"use strict";
var __extends = (this && this.__extends) || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
};
var MetricType_1 = require("./MetricType");
var AbstractActivityMetric_1 = require("./AbstractActivityMetric");
var EngagementTimeAggregatorMetric = (function (_super) {
    __extends(EngagementTimeAggregatorMetric, _super);
    function EngagementTimeAggregatorMetric(hub, config, timing) {
        _super.call(this, timing);
        this.hub = hub;
        this.config = config;
        this.intervalId = 0;
        this.hub.bind(hub.userEvents, this.onEventRaised.bind(this));
        this.guardInactivityTime();
    }
    EngagementTimeAggregatorMetric.prototype.getMetricType = function () {
        return MetricType_1.MetricType.engagementTime;
    };
    EngagementTimeAggregatorMetric.prototype.guardInactivityTime = function () {
        var _this = this;
        clearTimeout(this.intervalId);
        this.intervalId = setTimeout(function () {
            _this.markInactivity();
        }, this.config.metrics.inactivityTime);
    };
    EngagementTimeAggregatorMetric.prototype.onEventRaised = function (ev) {
        this.markActivity();
        this.guardInactivityTime();
    };
    EngagementTimeAggregatorMetric.prototype.dispose = function (shutdown) {
        clearTimeout(this.intervalId);
    };
    return EngagementTimeAggregatorMetric;
}(AbstractActivityMetric_1.AbstractActivityMetric));
exports.EngagementTimeAggregatorMetric = EngagementTimeAggregatorMetric;

},{"./AbstractActivityMetric":16,"./MetricType":35}],28:[function(require,module,exports){
"use strict";
var MetricType_1 = require("./MetricType");
var EventIdsMetric = (function () {
    function EventIdsMetric() {
        this.isLast = false;
        this.oneTime = false;
        this.eventsArray = [];
    }
    EventIdsMetric.prototype.addEvent = function (eventId) {
        if (this.eventsArray.indexOf(eventId) === -1) {
            this.eventsArray.push(eventId);
        }
    };
    EventIdsMetric.prototype.getMetric = function () {
        return {
            value: this.eventsArray,
            type: MetricType_1.MetricType.eventIds
        };
    };
    return EventIdsMetric;
}());
exports.EventIdsMetric = EventIdsMetric;

},{"./MetricType":35}],29:[function(require,module,exports){
"use strict";
var MetricType_1 = require("./MetricType");
var IdMetric = (function () {
    function IdMetric(id) {
        this.id = id;
        this.isLast = true;
        this.oneTime = false;
    }
    IdMetric.prototype.getMetric = function () {
        return {
            value: this.id,
            type: MetricType_1.MetricType.messageId
        };
    };
    return IdMetric;
}());
exports.IdMetric = IdMetric;

},{"./MetricType":35}],30:[function(require,module,exports){
"use strict";
var __extends = (this && this.__extends) || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
};
var MetricType_1 = require("./MetricType");
var AbstractMetric_1 = require("./AbstractMetric");
var IsNewVisitorMetric = (function (_super) {
    __extends(IsNewVisitorMetric, _super);
    function IsNewVisitorMetric(identificationService) {
        _super.call(this);
        this.identificationService = identificationService;
        this.type = MetricType_1.MetricType.isNewVisitor;
    }
    IsNewVisitorMetric.prototype.getMetricValue = function () {
        return this.identificationService.isNewIdentification;
    };
    return IsNewVisitorMetric;
}(AbstractMetric_1.AbstractMetric));
exports.IsNewVisitorMetric = IsNewVisitorMetric;

},{"./AbstractMetric":20,"./MetricType":35}],31:[function(require,module,exports){
"use strict";
var MetricType_1 = require("./MetricType");
var EventType_1 = require("../eventHubs/EventType");
var JSErrorCountMetric = (function () {
    function JSErrorCountMetric(hub) {
        this.hub = hub;
        this.isLast = false;
        this.oneTime = false;
        this.jsErrorCounter = 0;
        this.hub.bind([EventType_1.EventType.error], this.onEventRaised.bind(this));
    }
    JSErrorCountMetric.prototype.onEventRaised = function (ev) {
        this.jsErrorCounter++;
    };
    JSErrorCountMetric.prototype.getMetric = function () {
        return {
            value: this.jsErrorCounter,
            type: MetricType_1.MetricType.jsErrorCount
        };
    };
    return JSErrorCountMetric;
}());
exports.JSErrorCountMetric = JSErrorCountMetric;

},{"../eventHubs/EventType":7,"./MetricType":35}],32:[function(require,module,exports){
"use strict";
var __extends = (this && this.__extends) || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
};
var MetricType_1 = require("./MetricType");
var AbstractInactivityMetric_1 = require("./AbstractInactivityMetric");
var LackOfInterestMetric = (function (_super) {
    __extends(LackOfInterestMetric, _super);
    function LackOfInterestMetric(timing) {
        _super.call(this, timing);
    }
    LackOfInterestMetric.prototype.getMetricType = function () {
        return MetricType_1.MetricType.lackOfInterest;
    };
    return LackOfInterestMetric;
}(AbstractInactivityMetric_1.AbstractInactivityMetric));
exports.LackOfInterestMetric = LackOfInterestMetric;

},{"./AbstractInactivityMetric":19,"./MetricType":35}],33:[function(require,module,exports){
"use strict";
var __extends = (this && this.__extends) || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
};
var MetricType_1 = require("./MetricType");
var AbstractMetric_1 = require("./AbstractMetric");
var LocationMetric = (function (_super) {
    __extends(LocationMetric, _super);
    function LocationMetric() {
        _super.apply(this, arguments);
        this.type = MetricType_1.MetricType.location;
    }
    LocationMetric.prototype.getMetricValue = function () {
        return location.href;
    };
    return LocationMetric;
}(AbstractMetric_1.AbstractMetric));
exports.LocationMetric = LocationMetric;

},{"./AbstractMetric":20,"./MetricType":35}],34:[function(require,module,exports){
"use strict";
var EventType_1 = require("../eventHubs/EventType");
var MetricAggregator = (function () {
    function MetricAggregator(metrics, hub, config, idMetricFactory, serializableFactory) {
        var _this = this;
        this.metrics = metrics;
        this.config = config;
        this.idMetricFactory = idMetricFactory;
        this.serializableFactory = serializableFactory;
        this.reliable = true;
        this.metricCounter = 0;
        this.messageType = 0 /* start */;
        this.serilaizer = serializableFactory.getSerializer();
        hub.bindTop([EventType_1.EventType.beforeunload, EventType_1.EventType.unload], function () {
            _this.terminate();
        });
    }
    MetricAggregator.prototype.terminate = function () {
        this.messageType = 2 /* end */;
        this.serilaizer = this.serializableFactory.getSerializer();
        this.metrics = this.metrics.filter(function (metric) { return metric.isLast; });
    };
    MetricAggregator.prototype.getMetrics = function () {
        var id = this.getMetricId();
        var metrics;
        var idMetric = this.idMetricFactory(id);
        metrics = this.metrics.concat([idMetric]);
        return {
            id: id,
            type: this.messageType,
            reliable: this.reliable,
            metrics: this.serilaizer.serialize(metrics.map(function (metric) { return metric.getMetric(); }))
        };
    };
    MetricAggregator.prototype.resolveMetrics = function (metricsIdentifier) {
        if (metricsIdentifier.reliable) {
            this.reliable = false;
            this.messageType = 1 /* chunk */;
            this.metrics = this.metrics.filter(function (metric) { return !metric.oneTime; });
        }
    };
    MetricAggregator.prototype.getMetricId = function () {
        return this.reliable ? this.metricCounter : ++this.metricCounter;
    };
    return MetricAggregator;
}());
exports.MetricAggregator = MetricAggregator;

},{"../eventHubs/EventType":7}],35:[function(require,module,exports){
"use strict";
var MetricType;
(function (MetricType) {
    MetricType[MetricType["visitId"] = 3] = "visitId";
    MetricType[MetricType["version"] = 6] = "version";
    MetricType[MetricType["screenX"] = 16] = "screenX";
    MetricType[MetricType["screenY"] = 17] = "screenY";
    MetricType[MetricType["browser"] = 18] = "browser";
    MetricType[MetricType["location"] = 7] = "location";
    MetricType[MetricType["visitorId"] = 2] = "visitorId";
    MetricType[MetricType["projectId"] = 1] = "projectId";
    MetricType[MetricType["messageId"] = 5] = "messageId";
    MetricType[MetricType["eventIds"] = 21] = "eventIds";
    MetricType[MetricType["pageviewId"] = 4] = "pageviewId";
    MetricType[MetricType["timestamp"] = 31] = "timestamp";
    MetricType[MetricType["attention"] = 32] = "attention";
    MetricType[MetricType["timeOnPage"] = 12] = "timeOnPage";
    MetricType[MetricType["numOfClicks"] = 14] = "numOfClicks";
    MetricType[MetricType["scrollReach"] = 13] = "scrollReach";
    MetricType[MetricType["jsErrorCount"] = 11] = "jsErrorCount";
    MetricType[MetricType["isNewVisitor"] = 20] = "isNewVisitor";
    MetricType[MetricType["engagementTime"] = 9] = "engagementTime";
    MetricType[MetricType["lackOfInterest"] = 30] = "lackOfInterest";
    MetricType[MetricType["browserVersion"] = 19] = "browserVersion";
    MetricType[MetricType["documentReferrer"] = 8] = "documentReferrer";
    MetricType[MetricType["domContentLoaded"] = 10] = "domContentLoaded";
    MetricType[MetricType["durationSinceLastVisit"] = 15] = "durationSinceLastVisit";
})(MetricType || (MetricType = {}));
exports.MetricType = MetricType;

},{}],36:[function(require,module,exports){
"use strict";
var __extends = (this && this.__extends) || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
};
var AbstractEventRule_1 = require("./AbstractEventRule");
var MetricsPromise = (function (_super) {
    __extends(MetricsPromise, _super);
    function MetricsPromise(metricsAggregator) {
        _super.call(this);
        this.metricsAggregator = metricsAggregator;
        this.started = false;
    }
    MetricsPromise.prototype.resolve = function (metricsIdentifier) {
        this.metricsAggregator.resolveMetrics(metricsIdentifier);
    };
    MetricsPromise.prototype.reject = function (metricsIdentifier) {
        if (metricsIdentifier.reliable && this.started) {
            this.notify();
        }
    };
    MetricsPromise.prototype.start = function () {
        this.started = true;
    };
    MetricsPromise.prototype.stop = function () {
        this.started = false;
    };
    return MetricsPromise;
}(AbstractEventRule_1.AbstractEventRule));
exports.MetricsPromise = MetricsPromise;

},{"./AbstractEventRule":17}],37:[function(require,module,exports){
"use strict";
var EventType_1 = require("../eventHubs/EventType");
var MetricsReader = (function () {
    function MetricsReader(notificationRules, hub, metricsAggregator, processor, promise, identificationService) {
        var _this = this;
        this.notificationRules = notificationRules;
        this.hub = hub;
        this.metricsAggregator = metricsAggregator;
        this.processor = processor;
        this.promise = promise;
        this.identificationService = identificationService;
        notificationRules.forEach(function (rule) { return rule.registerNotification(_this.read.bind(_this)).start(); });
        this.hub.bind([EventType_1.EventType.online, EventType_1.EventType.offline], function () {
            _this.applyOnNotificationRules(function (rule) { return navigator.onLine ? rule.start() : rule.stop(); });
        });
    }
    MetricsReader.prototype.read = function () {
        var metricsResult = this.metricsAggregator.getMetrics();
        if (metricsResult.isEmpty) {
            return;
        }
        this.identificationService.modifyIdentification();
        this.processor.process(metricsResult.metrics, {
            id: metricsResult.id,
            promise: this.promise,
            type: metricsResult.type,
            reliable: metricsResult.reliable
        });
    };
    MetricsReader.prototype.dispose = function (shutdown) {
        if (!shutdown) {
            this.read();
        }
        this.applyOnNotificationRules(function (rule) { return rule.stop(); });
    };
    MetricsReader.prototype.applyOnNotificationRules = function (apply) {
        this.notificationRules.forEach(function (rule) { return apply(rule); });
    };
    return MetricsReader;
}());
exports.MetricsReader = MetricsReader;

},{"../eventHubs/EventType":7}],38:[function(require,module,exports){
"use strict";
var MetricType_1 = require("./MetricType");
var EventType_1 = require("../EventHubs/EventType");
var NumberOfClicksMetric = (function () {
    function NumberOfClicksMetric(hub) {
        this.hub = hub;
        this.isLast = false;
        this.oneTime = false;
        this.clicksCounter = 0;
        this.hub.bind([EventType_1.EventType.mouseup], this.onMouseUpEventRaised.bind(this));
        this.hub.bind([EventType_1.EventType.mousedown], this.onMouseDownEventRaised.bind(this));
    }
    NumberOfClicksMetric.prototype.onMouseDownEventRaised = function (ev) {
        this.mouseDownEventTarget = ev.target;
    };
    NumberOfClicksMetric.prototype.onMouseUpEventRaised = function (ev) {
        if (this.mouseDownEventTarget === ev.target) {
            this.clicksCounter++;
        }
    };
    NumberOfClicksMetric.prototype.getMetric = function () {
        return {
            value: this.clicksCounter,
            type: MetricType_1.MetricType.numOfClicks
        };
    };
    return NumberOfClicksMetric;
}());
exports.NumberOfClicksMetric = NumberOfClicksMetric;

},{"../EventHubs/EventType":3,"./MetricType":35}],39:[function(require,module,exports){
"use strict";
var __extends = (this && this.__extends) || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
};
var MetricType_1 = require("./MetricType");
var AbstractIdentificationMetric_1 = require("./AbstractIdentificationMetric");
var PageViewIdentificationMetric = (function (_super) {
    __extends(PageViewIdentificationMetric, _super);
    function PageViewIdentificationMetric(identificationService) {
        _super.call(this, identificationService);
        this.type = MetricType_1.MetricType.pageviewId;
    }
    PageViewIdentificationMetric.prototype.getMetricValue = function () {
        return this.identification.PageView;
    };
    return PageViewIdentificationMetric;
}(AbstractIdentificationMetric_1.AbstractIdentificationMetric));
exports.PageViewIdentificationMetric = PageViewIdentificationMetric;

},{"./AbstractIdentificationMetric":18,"./MetricType":35}],40:[function(require,module,exports){
"use strict";
var __extends = (this && this.__extends) || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
};
var AbstractEventRule_1 = require("./AbstractEventRule");
var PeriodicalNotifierRule = (function (_super) {
    __extends(PeriodicalNotifierRule, _super);
    function PeriodicalNotifierRule(config) {
        _super.call(this);
        this.config = config;
        this.firstFibNumber = 0;
        this.secondFibNumber = 1;
        this.maxIntervalReached = false;
        this.maxFetchInterval = this.config.metrics.maxFetchInterval;
    }
    PeriodicalNotifierRule.prototype.start = function () {
        var _this = this;
        var interval = this.maxIntervalReached ? this.maxFetchInterval : this.getFetchInterval();
        this.timeoutId = setTimeout(function () {
            _this.notify();
            _this.start();
        }, interval);
    };
    PeriodicalNotifierRule.prototype.stop = function () {
        clearInterval(this.timeoutId);
    };
    PeriodicalNotifierRule.prototype.dispose = function (shutdown) {
        this.stop();
    };
    PeriodicalNotifierRule.prototype.getFetchInterval = function () {
        var fibNumber = this.firstFibNumber + this.secondFibNumber;
        var interval = fibNumber * 1000;
        if (interval > this.maxFetchInterval) {
            this.maxIntervalReached = true;
            return this.maxFetchInterval;
        }
        this.firstFibNumber = this.secondFibNumber;
        this.secondFibNumber = fibNumber;
        return interval;
    };
    return PeriodicalNotifierRule;
}(AbstractEventRule_1.AbstractEventRule));
exports.PeriodicalNotifierRule = PeriodicalNotifierRule;

},{"./AbstractEventRule":17}],41:[function(require,module,exports){
"use strict";
var __extends = (this && this.__extends) || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
};
var MetricType_1 = require("./MetricType");
var AbstractMetric_1 = require("./AbstractMetric");
var ProjectIdMetric = (function (_super) {
    __extends(ProjectIdMetric, _super);
    function ProjectIdMetric(projectId) {
        _super.call(this, true, false);
        this.projectId = projectId;
        this.type = MetricType_1.MetricType.projectId;
    }
    ProjectIdMetric.prototype.getMetricValue = function () {
        return this.projectId;
    };
    return ProjectIdMetric;
}(AbstractMetric_1.AbstractMetric));
exports.ProjectIdMetric = ProjectIdMetric;

},{"./AbstractMetric":20,"./MetricType":35}],42:[function(require,module,exports){
"use strict";
var __extends = (this && this.__extends) || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
};
var MetricType_1 = require("./MetricType");
var AbstractMetric_1 = require("./AbstractMetric");
var ResolutionHeightMetric = (function (_super) {
    __extends(ResolutionHeightMetric, _super);
    function ResolutionHeightMetric() {
        _super.apply(this, arguments);
        this.type = MetricType_1.MetricType.screenY;
    }
    ResolutionHeightMetric.prototype.getMetricValue = function () {
        return window.innerHeight;
    };
    return ResolutionHeightMetric;
}(AbstractMetric_1.AbstractMetric));
exports.ResolutionHeightMetric = ResolutionHeightMetric;

},{"./AbstractMetric":20,"./MetricType":35}],43:[function(require,module,exports){
"use strict";
var __extends = (this && this.__extends) || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
};
var MetricType_1 = require("./MetricType");
var AbstractMetric_1 = require("./AbstractMetric");
var ResolutionWidthMetric = (function (_super) {
    __extends(ResolutionWidthMetric, _super);
    function ResolutionWidthMetric() {
        _super.apply(this, arguments);
        this.type = MetricType_1.MetricType.screenX;
    }
    ResolutionWidthMetric.prototype.getMetricValue = function () {
        return window.innerWidth;
    };
    return ResolutionWidthMetric;
}(AbstractMetric_1.AbstractMetric));
exports.ResolutionWidthMetric = ResolutionWidthMetric;

},{"./AbstractMetric":20,"./MetricType":35}],44:[function(require,module,exports){
"use strict";
var MetricType_1 = require("./MetricType");
var EventType_1 = require("../eventHubs/EventType");
var ScrollReachMetric = (function () {
    function ScrollReachMetric(hub) {
        this.hub = hub;
        this.isLast = false;
        this.oneTime = false;
        this.bindedOnEventRaised = this.onEventRaised.bind(this);
        this.maxScrollReach = 0;
        this.hub.bind([EventType_1.EventType.scroll, EventType_1.EventType.resize], this.bindedOnEventRaised);
    }
    ScrollReachMetric.prototype.onEventRaised = function (ev) {
        var clientHeight = window.innerHeight || document.documentElement.clientHeight || document.body.clientHeight;
        var scrollTop = document.documentElement.scrollTop || document.body.scrollTop;
        var scrollHeight = document.documentElement.scrollHeight || document.body.scrollHeight;
        var scrollReach = scrollTop / (scrollHeight - clientHeight) * 100;
        scrollReach = Math.abs(Math.round(Math.min(100, scrollReach)));
        this.maxScrollReach = Math.max(scrollReach, this.maxScrollReach);
        if (this.maxScrollReach === 100) {
            this.hub.unbind([EventType_1.EventType.scroll, EventType_1.EventType.resize], this.bindedOnEventRaised);
        }
    };
    ScrollReachMetric.prototype.getMetric = function () {
        return {
            value: this.maxScrollReach,
            type: MetricType_1.MetricType.scrollReach
        };
    };
    return ScrollReachMetric;
}());
exports.ScrollReachMetric = ScrollReachMetric;

},{"../eventHubs/EventType":7,"./MetricType":35}],45:[function(require,module,exports){
"use strict";
var __extends = (this && this.__extends) || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
};
var MetricType_1 = require("./MetricType");
var EventType_1 = require("../eventHubs/EventType");
var AbstractActivityMetric_1 = require("./AbstractActivityMetric");
var TimeOnPageMetric = (function (_super) {
    __extends(TimeOnPageMetric, _super);
    function TimeOnPageMetric(hub, timing) {
        _super.call(this, timing);
        this.hub = hub;
        this.hub.bind([EventType_1.EventType.visibilitychange], this.onEventRaised.bind(this));
    }
    TimeOnPageMetric.prototype.getMetricType = function () {
        return MetricType_1.MetricType.timeOnPage;
    };
    TimeOnPageMetric.prototype.onEventRaised = function (ev) {
        if (document.hidden) {
            this.markInactivity();
        }
        else {
            this.markActivity();
        }
    };
    return TimeOnPageMetric;
}(AbstractActivityMetric_1.AbstractActivityMetric));
exports.TimeOnPageMetric = TimeOnPageMetric;

},{"../eventHubs/EventType":7,"./AbstractActivityMetric":16,"./MetricType":35}],46:[function(require,module,exports){
"use strict";
var __extends = (this && this.__extends) || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
};
var MetricType_1 = require("./MetricType");
var AbstractMetric_1 = require("./AbstractMetric");
var VersionMetric = (function (_super) {
    __extends(VersionMetric, _super);
    function VersionMetric() {
        _super.apply(this, arguments);
        this.type = MetricType_1.MetricType.version;
    }
    VersionMetric.prototype.getMetricValue = function () {
        return 1;
    };
    return VersionMetric;
}(AbstractMetric_1.AbstractMetric));
exports.VersionMetric = VersionMetric;

},{"./AbstractMetric":20,"./MetricType":35}],47:[function(require,module,exports){
"use strict";
var __extends = (this && this.__extends) || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
};
var MetricType_1 = require("./MetricType");
var AbstractIdentificationMetric_1 = require("./AbstractIdentificationMetric");
var VisitIdentificationMetric = (function (_super) {
    __extends(VisitIdentificationMetric, _super);
    function VisitIdentificationMetric(identificationService) {
        _super.call(this, identificationService);
        this.type = MetricType_1.MetricType.visitId;
    }
    VisitIdentificationMetric.prototype.getMetricValue = function () {
        return this.identification.Visit;
    };
    return VisitIdentificationMetric;
}(AbstractIdentificationMetric_1.AbstractIdentificationMetric));
exports.VisitIdentificationMetric = VisitIdentificationMetric;

},{"./AbstractIdentificationMetric":18,"./MetricType":35}],48:[function(require,module,exports){
"use strict";
var __extends = (this && this.__extends) || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
};
var MetricType_1 = require("./MetricType");
var AbstractIdentificationMetric_1 = require("./AbstractIdentificationMetric");
var VisitorIdentificationMetric = (function (_super) {
    __extends(VisitorIdentificationMetric, _super);
    function VisitorIdentificationMetric(identificationService) {
        _super.call(this, identificationService);
        this.type = MetricType_1.MetricType.visitorId;
    }
    VisitorIdentificationMetric.prototype.getMetricValue = function () {
        return this.identification.Visitor;
    };
    return VisitorIdentificationMetric;
}(AbstractIdentificationMetric_1.AbstractIdentificationMetric));
exports.VisitorIdentificationMetric = VisitorIdentificationMetric;

},{"./AbstractIdentificationMetric":18,"./MetricType":35}],49:[function(require,module,exports){
"use strict";
var CookiesService = (function () {
    function CookiesService() {
    }
    CookiesService.prototype.delete = function (cookie) {
        this.write(cookie, "", -1);
    };
    CookiesService.prototype.read = function (cookie) {
        var to = 0;
        var from = 0;
        var tuples = document.cookie.split(";");
        cookie += "=";
        for (var _i = 0, tuples_1 = tuples; _i < tuples_1.length; _i++) {
            var keyValue = tuples_1[_i];
            if (keyValue.trim().indexOf(cookie) === 0) {
                to = from + keyValue.length;
                from = from + keyValue.split("=")[0].length + 1;
                return document.cookie.substring(from, to);
            }
            from += keyValue.length + 1;
        }
        return null;
    };
    CookiesService.prototype.write = function (cookie, value, days) {
        var expires = "";
        if (days) {
            var date = new Date();
            date.setTime(date.getTime() + (days * 86400000));
            expires = "; expires=" + date.toUTCString();
        }
        document.cookie = cookie + "=" + value + expires + "; path=/;";
    };
    return CookiesService;
}());
exports.CookiesService = CookiesService;

},{}],50:[function(require,module,exports){
"use strict";
var EventType_1 = require("../../eventHubs/EventType");
var Disposer = (function () {
    function Disposer(hub, container, config, app) {
        var _this = this;
        this.container = container;
        this.config = config;
        this.app = app;
        var bindedDispose = this.dispose.bind(this);
        this.transportChannel = config.transport.mainChannel;
        setTimeout(bindedDispose, config.identification.visitTimeSpan);
        hub.bind([EventType_1.EventType.unload, EventType_1.EventType.beforeunload], function () { return _this.dispose(); });
        this.channelFactory = this.resolveChannel(this.transportChannel);
    }
    Disposer.prototype.resolveChannel = function (channelType) {
        return this.container.resolveFactory(channelType + " channel");
    };
    Disposer.prototype.getSerializer = function () {
        return this.container.resolve(this.transportChannel + " serializer");
    };
    Disposer.prototype.getChannel = function (channelSettings) {
        return this.channelFactory(channelSettings);
    };
    Disposer.prototype.dispose = function (shutdown) {
        this.transportChannel = this.config.transport.terminalChannel;
        this.metricAggregator.terminate();
        this.channelFactory = this.resolveChannel(this.transportChannel);
        this.container.dispose(shutdown);
        this.app.stop();
    };
    Disposer.prototype.shutdown = function () {
        this.dispose(true);
    };
    return Disposer;
}());
exports.Disposer = Disposer;

},{"../../eventHubs/EventType":7}],51:[function(require,module,exports){
"use strict";
var IdGenerator = (function () {
    function IdGenerator() {
    }
    IdGenerator.prototype.generate = function () {
        return Math.floor(Math.random() * IdGenerator.maxNumber);
    };
    IdGenerator.maxNumber = Math.pow(2, 53) - 1;
    return IdGenerator;
}());
exports.IdGenerator = IdGenerator;

},{}],52:[function(require,module,exports){
"use strict";
var ObjectExtender_1 = require("../objectExtender/ObjectExtender");
var IdentificationService = (function () {
    function IdentificationService(idGenerator, cookiesService, config) {
        this.idGenerator = idGenerator;
        this.cookiesService = cookiesService;
        this.config = config;
        this.cookie = "ctm";
        this.isNewIdentification = false;
        this.setOrAddIdentification();
    }
    IdentificationService.prototype.setOrAddIdentification = function () {
        var _this = this;
        var isIdentified = false;
        var subject = this.parseIdentification();
        if (subject) {
            isIdentified = this.persistIdentification(subject, function (s) {
                if (!_this.isInVisitRange(subject)) {
                    subject.vst = _this.idGenerator.generate();
                }
                subject.pgv = _this.idGenerator.generate();
                subject.intr = Date.parse(new Date().toUTCString());
                return subject;
            });
        }
        if (!isIdentified) {
            this.createIdentification();
        }
        this.setIdentificationFromStored();
    };
    IdentificationService.prototype.parseIdentification = function () {
        var ctm = this.cookiesService.read("ctm");
        if (ctm) {
            try {
                return JSON.parse(ctm);
            }
            catch (e) { }
        }
        return null;
    };
    IdentificationService.prototype.setIdentificationFromStored = function () {
        this.identification = {
            Visit: this.storedIdentification.vst,
            Visitor: this.storedIdentification.vstr,
            PageView: this.storedIdentification.pgv,
            LastModified: this.storedIdentification.intr
        };
    };
    IdentificationService.prototype.getIdentification = function () {
        return this.identification;
    };
    IdentificationService.prototype.persistIdentification = function (subject, subjectTransform) {
        if (this.validate(subject)) {
            subject = subjectTransform ? subjectTransform(subject) : subject;
            this.updateCookie(subject);
            this.storedIdentification = subject;
            return true;
        }
        return false;
    };
    IdentificationService.prototype.isInVisitRange = function (identification) {
        return Date.parse(new Date().toUTCString()) - identification.intr < this.config.identification.visitTimeSpan;
    };
    IdentificationService.prototype.createIdentification = function () {
        this.updateCookie(this.storedIdentification = {
            pgv: this.idGenerator.generate(),
            vst: this.idGenerator.generate(),
            vstr: this.idGenerator.generate(),
            intr: Date.parse(new Date().toUTCString())
        });
        this.isNewIdentification = true;
    };
    IdentificationService.prototype.validate = function (identification) {
        return ["vst", "pgv", "vstr", "intr"].every(function (key) {
            var value;
            if (value = identification[key]) {
                return !isNaN(value);
            }
            return false;
        });
    };
    IdentificationService.prototype.modifyIdentification = function () {
        var now = Date.parse(new Date().toUTCString());
        this.storedIdentification.intr = this.identification.LastModified = now;
        this.updateCookie(this.storedIdentification);
    };
    IdentificationService.prototype.setIdentification = function (identification) {
        var subject = this.parseIdentification() || {};
        subject = ObjectExtender_1.ObjectExtender.extend(subject, identification);
        if (this.persistIdentification(subject)) {
            this.setIdentificationFromStored();
        }
    };
    IdentificationService.prototype.updateCookie = function (identification) {
        var value = JSON.stringify(identification);
        this.cookiesService.write(this.cookie, value, this.config.identification.expirationDays);
    };
    return IdentificationService;
}());
exports.IdentificationService = IdentificationService;

},{"../objectExtender/ObjectExtender":53}],53:[function(require,module,exports){
"use strict";
var ObjectExtender = (function () {
    function ObjectExtender() {
    }
    ObjectExtender.extend = function (target) {
        var length = arguments.length, options, name, src, copy, copyIsArray, clone;
        for (var i = 1; i < length; i++) {
            if (options = arguments[i]) {
                for (name in options) {
                    src = target[name];
                    copy = options[name];
                    if (target === copy) {
                        continue;
                    }
                    if (copy && (ObjectExtender.isPlainObject(copy) || (copyIsArray = Array.isArray(copy)))) {
                        if (copyIsArray) {
                            copyIsArray = false;
                            target[name] = copy.slice();
                        }
                        else {
                            clone = src && ObjectExtender.isPlainObject(src) ? src : {};
                            target[name] = ObjectExtender.extend(clone, copy);
                        }
                    }
                    else if (copy !== undefined) {
                        target[name] = copy;
                    }
                }
            }
        }
        return target;
    };
    ObjectExtender.isPlainObject = function (obj) {
        if (ObjectExtender.type(obj) !== "object" || obj.nodeType || obj === window) {
            return false;
        }
        if (obj.constructor && !ObjectExtender.hasOwn.call(obj.constructor.prototype, "isPrototypeOf")) {
            return false;
        }
        // If the function hasn't returned already, we're confident that
        // |obj| is a plain object, created by {} or constructed with new Object
        return true;
    };
    ObjectExtender.type = function (obj) {
        if (obj == null) {
            return obj + "";
        }
        return typeof obj === "object" || typeof obj === "function" ?
            ObjectExtender.class2type[ObjectExtender.toString.call(obj)] || "object" :
            typeof obj;
    };
    ObjectExtender.class2type = {};
    ObjectExtender.toString = ObjectExtender.class2type.toString;
    ObjectExtender.hasOwn = ObjectExtender.class2type.hasOwnProperty;
    return ObjectExtender;
}());
exports.ObjectExtender = ObjectExtender;

},{}],54:[function(require,module,exports){
"use strict";
var UserAgentService = (function () {
    function UserAgentService(userAgent) {
        this.tokenizer = / (\w+)(?:\/([\w\.]+))? (?:(\([^\)]+\)) )?/img;
        this.userAgent = this.detect(" " + (userAgent || navigator.userAgent) + " ");
        this.isBrowserSupported = this.checkBrowserSupport(this.userAgent.browser, this.userAgent.is);
    }
    UserAgentService.prototype.detect = function (userAgent) {
        var xhr = window.XMLHttpRequest;
        var tokens = this.tokenize(userAgent);
        var result = { is: { mobile: false }, browser: { version: 6 /* NotSupported */ } };
        var browser = result.browser;
        var mozExtra = tokens["Mozilla"] && tokens["Mozilla"]["extra"] ? tokens["Mozilla"]["extra"] : null;
        var supports = result.supports = {
            sendBeacon: !!navigator.sendBeacon,
            binaryTransport: xhr && "withCredentials" in new XMLHttpRequest
        };
        if (tokens["Opera"]) {
            browser.version = 0;
            browser.name = "Opera";
            browser.type = 1 /* Opera */;
            return result;
        }
        if (tokens["Edge"]) {
            browser.type = 0 /* Edge */;
            browser.name = "Edge";
            browser.version = parseInt(tokens["Edge"]["value"]);
            result.is.mobile = userAgent.indexOf("Windows Phone; ") !== -1;
            return result;
        }
        if (mozExtra) {
            var index = void 0;
            var msieIndex = mozExtra.indexOf("MSIE ");
            var tridentIndex = mozExtra.indexOf("; Trident/");
            var isIE = msieIndex + tridentIndex > -1;
            if (isIE) {
                index = msieIndex !== -1 ? msieIndex : mozExtra.indexOf("; rv:");
                if (index !== -1) {
                    browser.type = 7 /* InternetExplorer */;
                    browser.name = "Internet Explorer";
                    browser.version = parseFloat(mozExtra.substr(index + 5, 3));
                    result.is.mobile = mozExtra.indexOf("; Touch") !== -1 || mozExtra.indexOf("; IEMobile/") !== -1;
                    return result;
                }
            }
        }
        if (tokens["Firefox"] && tokens["Firefox"]["value"]) {
            browser.type = 5 /* FireFox */;
            browser.name = "Firefox";
            browser.version = parseFloat(tokens["Firefox"]["value"]);
            result.is.mobile = mozExtra && mozExtra.indexOf("Android; ") !== -1;
            return result;
        }
        if ((tokens["Chrome"] && tokens["Chrome"]["value"] || tokens["CriOS"] && tokens["CriOS"]["value"]) && !tokens["Version"]) {
            browser.type = 3 /* Chrome */;
            browser.name = "Chrome";
            browser.version = parseFloat(tokens["Chrome"] ? tokens["Chrome"]["value"] : tokens["CriOS"]["value"]);
            result.is.mobile = tokens["CriOS"] || mozExtra && mozExtra.indexOf("; Android ") !== -1;
            return result;
        }
        if (tokens["Safari"]) {
            browser.name = "Safari";
            if (mozExtra && mozExtra.indexOf("; Android ") !== -1 && tokens["AppleWebKit"] && tokens["AppleWebKit"]["value"]) {
                browser.type = 2 /* WebKit */;
                browser.version = parseFloat(tokens["AppleWebKit"]["value"]);
                result.is.mobile = true;
                return result;
            }
            if (mozExtra && mozExtra.indexOf("Windows") === -1 && tokens["Version"] && tokens["Version"]["value"]) {
                browser.type = 4 /* Safari */;
                browser.version = parseFloat(tokens["Version"]["value"]);
                result.is.mobile = !!tokens["Mobile"];
            }
        }
        return result;
    };
    UserAgentService.prototype.checkBrowserSupport = function (browser, device) {
        return browser.type === 0 /* Edge */ && !device.mobile ||
            browser.type === 3 /* Chrome */ && browser.version >= 9 ||
            browser.type === 2 /* WebKit */ && browser.version >= 534 ||
            browser.type === 5 /* FireFox */ && browser.version >= 25 && !device.mobile ||
            browser.type === 4 /* Safari */ && browser.version >= 5.1 && browser.version <= 10 ||
            browser.type === 7 /* InternetExplorer */ && browser.version > 9 && !device.mobile;
    };
    UserAgentService.prototype.tokenize = function (userAgent) {
        var tokens = {};
        var token;
        while (token = this.tokenizer.exec(userAgent)) {
            tokens[token[1]] = {
                value: token[2],
                extra: token[3]
            };
            this.tokenizer.lastIndex--;
        }
        return tokens;
    };
    return UserAgentService;
}());
exports.UserAgentService = UserAgentService;

},{}],55:[function(require,module,exports){
"use strict";
var AbstractTransportChannel = (function () {
    function AbstractTransportChannel(settings) {
        this.settings = settings;
    }
    AbstractTransportChannel.prototype.onRequestSuccess = function (envelope) {
        this.reset();
        this.settings.sendPromise.resolve(envelope);
    };
    AbstractTransportChannel.prototype.onRequestFailure = function (envelope) {
        var _this = this;
        this.reset();
        setTimeout(function () {
            _this.settings.sendPromise.reject(envelope);
        }, this.settings.waitInterval);
    };
    return AbstractTransportChannel;
}());
exports.AbstractTransportChannel = AbstractTransportChannel;

},{}],56:[function(require,module,exports){
"use strict";
var BeaconTransportChannel = (function () {
    function BeaconTransportChannel(settings) {
        this.settings = settings;
    }
    BeaconTransportChannel.prototype.send = function (url, envelope) {
        var data = envelope.message.data;
        if (navigator.sendBeacon(url + "&" + data)) {
            this.settings.sendPromise.resolve(envelope);
        }
        else {
            this.settings.sendPromise.reject(envelope);
        }
    };
    return BeaconTransportChannel;
}());
exports.BeaconTransportChannel = BeaconTransportChannel;

},{}],57:[function(require,module,exports){
"use strict";
var __extends = (this && this.__extends) || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
};
var AbstractTransportChannel_1 = require("./AbstractTransportChannel");
var ImageTransportChannel = (function (_super) {
    __extends(ImageTransportChannel, _super);
    function ImageTransportChannel(settings) {
        _super.call(this, settings);
        this.image = new Image();
    }
    ImageTransportChannel.prototype.send = function (url, envelope) {
        var _this = this;
        var data = envelope.message.data;
        this.image.onload = function () {
            _this.onRequestSuccess(envelope);
        };
        this.image.onerror = function () {
            _this.onRequestFailure(envelope);
        };
        this.image.src += url + "&" + data + "&r=" + Date.now();
    };
    ImageTransportChannel.prototype.reset = function () {
        this.image = this.image.onerror = this.image.onload = null;
    };
    return ImageTransportChannel;
}(AbstractTransportChannel_1.AbstractTransportChannel));
exports.ImageTransportChannel = ImageTransportChannel;

},{"./AbstractTransportChannel":55}],58:[function(require,module,exports){
"use strict";
var __extends = (this && this.__extends) || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
};
var AbstractTransportChannel_1 = require("./AbstractTransportChannel");
var TransportChannelXhr = (function (_super) {
    __extends(TransportChannelXhr, _super);
    function TransportChannelXhr(settings) {
        _super.call(this, settings);
        this.xhr = new XMLHttpRequest();
    }
    TransportChannelXhr.prototype.send = function (url, envelope) {
        var _this = this;
        var xhr = this.xhr;
        var data = envelope.message.data;
        try {
            xhr.open("POST", url);
            xhr.timeout = 30000;
            xhr.setRequestHeader("Content-Type", "text/plain");
            this.xhr.onreadystatechange = function () {
                if (xhr.readyState === 4) {
                    if (xhr.status === 200) {
                        _this.onRequestSuccess(envelope);
                    }
                    else {
                        _this.onRequestFailure(envelope);
                    }
                }
            };
            xhr.onload = function () {
                _this.onRequestSuccess(envelope);
            };
            xhr.onerror = xhr.ontimeout = xhr.onabort = function () {
                _this.onRequestFailure(envelope);
            };
            xhr.send(data);
        }
        catch (ex) {
            this.onRequestFailure(envelope);
        }
    };
    TransportChannelXhr.prototype.reset = function () {
        this.xhr = this.xhr.onabort = this.xhr.ontimeout = this.xhr.onerror = this.xhr.onload = this.xhr.onreadystatechange = null;
    };
    return TransportChannelXhr;
}(AbstractTransportChannel_1.AbstractTransportChannel));
exports.TransportChannelXhr = TransportChannelXhr;

},{"./AbstractTransportChannel":55}]},{},[2])(2)
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyaWZ5L25vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJidWlsZC9zb3VyY2UvQXBwL0FwcC5qcyIsImJ1aWxkL3NvdXJjZS9BcHAvQ2xpY2tUYWxlTW9uaXRvci5qcyIsImJ1aWxkL3NvdXJjZS9FdmVudEh1YnMvRXZlbnRUeXBlLmpzIiwiYnVpbGQvc291cmNlL2NvbGxlY3Rpb25zL0RpY3Rpb25hcnkuanMiLCJidWlsZC9zb3VyY2UvY29uZmlnL0NvbmZpZ3VyYXRpb24uanMiLCJidWlsZC9zb3VyY2UvZGlzdHJpYnV0aW9uL0Rpc3RyaWJ1dGlvblNlcnZpY2UuanMiLCJidWlsZC9zb3VyY2UvZXZlbnRIdWJzL0h1Yi5qcyIsImJ1aWxkL3NvdXJjZS9pb2MvQ29udGFpbmVyLmpzIiwiYnVpbGQvc291cmNlL2lvYy9HZW5lcmljU2VydmljZUVudHJ5LmpzIiwiYnVpbGQvc291cmNlL2lvYy9OYW1lUmVzb2x2ZXIuanMiLCJidWlsZC9zb3VyY2UvaW9jL1NlcnZpY2VFbnRyeS5qcyIsImJ1aWxkL3NvdXJjZS9pb2MvU2VydmljZUtleS5qcyIsImJ1aWxkL3NvdXJjZS9tZXNzYWdpbmcvSlNPTlNlcmlhbGl6ZXIuanMiLCJidWlsZC9zb3VyY2UvbWVzc2FnaW5nL1F1ZXJ5U3RyaW5nU2VyaWFsaXplci5qcyIsImJ1aWxkL3NvdXJjZS9tZXRyaWNzL0Fic3RyYWN0QWN0aXZpdHlNZXRyaWMuanMiLCJidWlsZC9zb3VyY2UvbWV0cmljcy9BYnN0cmFjdEV2ZW50UnVsZS5qcyIsImJ1aWxkL3NvdXJjZS9tZXRyaWNzL0Fic3RyYWN0SWRlbnRpZmljYXRpb25NZXRyaWMuanMiLCJidWlsZC9zb3VyY2UvbWV0cmljcy9BYnN0cmFjdEluYWN0aXZpdHlNZXRyaWMuanMiLCJidWlsZC9zb3VyY2UvbWV0cmljcy9BYnN0cmFjdE1ldHJpYy5qcyIsImJ1aWxkL3NvdXJjZS9tZXRyaWNzL0F0dGVudGlvbk1ldHJpYy5qcyIsImJ1aWxkL3NvdXJjZS9tZXRyaWNzL0Jyb3dzZXJNZXRyaWMuanMiLCJidWlsZC9zb3VyY2UvbWV0cmljcy9Ccm93c2VyVmVyc2lvbk1ldHJpYy5qcyIsImJ1aWxkL3NvdXJjZS9tZXRyaWNzL0NvbXBvc2l0ZUluYWN0aXZpdHkuanMiLCJidWlsZC9zb3VyY2UvbWV0cmljcy9ET01MQ29udGVudExvYWRlZFRpbWVNZXRyaWMuanMiLCJidWlsZC9zb3VyY2UvbWV0cmljcy9Eb2N1bWVudFJlZmVycmVyTWV0cmljLmpzIiwiYnVpbGQvc291cmNlL21ldHJpY3MvRW5nYWdlbWVudFRpbWVBZ2dyZWdhdG9yTWV0cmljLmpzIiwiYnVpbGQvc291cmNlL21ldHJpY3MvRXZlbnRJZHNNZXRyaWMuanMiLCJidWlsZC9zb3VyY2UvbWV0cmljcy9JZE1ldHJpYy5qcyIsImJ1aWxkL3NvdXJjZS9tZXRyaWNzL0lzTmV3VmlzaXRvck1ldHJpYy5qcyIsImJ1aWxkL3NvdXJjZS9tZXRyaWNzL0pTRXJyb3JDb3VudE1ldHJpYy5qcyIsImJ1aWxkL3NvdXJjZS9tZXRyaWNzL0xhY2tPZkludGVyZXN0TWV0cmljLmpzIiwiYnVpbGQvc291cmNlL21ldHJpY3MvTG9jYXRpb25NZXRyaWMuanMiLCJidWlsZC9zb3VyY2UvbWV0cmljcy9NZXRyaWNBZ2dyZWdhdG9yLmpzIiwiYnVpbGQvc291cmNlL21ldHJpY3MvTWV0cmljVHlwZS5qcyIsImJ1aWxkL3NvdXJjZS9tZXRyaWNzL01ldHJpY3NQcm9taXNlLmpzIiwiYnVpbGQvc291cmNlL21ldHJpY3MvTWV0cmljc1JlYWRlci5qcyIsImJ1aWxkL3NvdXJjZS9tZXRyaWNzL051bWJlck9mQ2xpY2tzTWV0cmljLmpzIiwiYnVpbGQvc291cmNlL21ldHJpY3MvUGFnZVZpZXdJZGVudGlmaWNhdGlvbk1ldHJpYy5qcyIsImJ1aWxkL3NvdXJjZS9tZXRyaWNzL1BlcmlvZGljYWxOb3RpZmllclJ1bGUuanMiLCJidWlsZC9zb3VyY2UvbWV0cmljcy9Qcm9qZWN0SWRNZXRyaWMuanMiLCJidWlsZC9zb3VyY2UvbWV0cmljcy9SZXNvbHV0aW9uSGVpZ2h0TWV0cmljLmpzIiwiYnVpbGQvc291cmNlL21ldHJpY3MvUmVzb2x1dGlvbldpZHRoTWV0cmljLmpzIiwiYnVpbGQvc291cmNlL21ldHJpY3MvU2Nyb2xsUmVhY2hNZXRyaWMuanMiLCJidWlsZC9zb3VyY2UvbWV0cmljcy9UaW1lT25QYWdlTWV0cmljLmpzIiwiYnVpbGQvc291cmNlL21ldHJpY3MvVmVyc2lvbk1ldHJpYy5qcyIsImJ1aWxkL3NvdXJjZS9tZXRyaWNzL1Zpc2l0SWRlbnRpZmljYXRpb25NZXRyaWMuanMiLCJidWlsZC9zb3VyY2UvbWV0cmljcy9WaXNpdG9ySWRlbnRpZmljYXRpb25NZXRyaWMuanMiLCJidWlsZC9zb3VyY2Uvc2VydmljZXMvY29va2llcy9Db29raWVzU2VydmljZS5qcyIsImJ1aWxkL3NvdXJjZS9zZXJ2aWNlcy9kaXNwb3Nlci9EaXNwb3Nlci5qcyIsImJ1aWxkL3NvdXJjZS9zZXJ2aWNlcy9pZEdlbmVyYXRvci9JZEdlbmVyYXRvci5qcyIsImJ1aWxkL3NvdXJjZS9zZXJ2aWNlcy9pZGVudGlmaWNhdGlvbi9JZGVudGlmaWNhdGlvblNlcnZpY2UuanMiLCJidWlsZC9zb3VyY2Uvc2VydmljZXMvb2JqZWN0RXh0ZW5kZXIvT2JqZWN0RXh0ZW5kZXIuanMiLCJidWlsZC9zb3VyY2Uvc2VydmljZXMvdXNlckFnZW50L1VzZXJBZ2VudFNlcnZpY2UuanMiLCJidWlsZC9zb3VyY2UvdHJhbnNwb3J0L0Fic3RyYWN0VHJhbnNwb3J0Q2hhbm5lbC5qcyIsImJ1aWxkL3NvdXJjZS90cmFuc3BvcnQvQmVhY29uVHJhbnNwb3J0Q2hhbm5lbC5qcyIsImJ1aWxkL3NvdXJjZS90cmFuc3BvcnQvSW1hZ2VUcmFuc3BvcnRDaGFubmVsLmpzIiwiYnVpbGQvc291cmNlL3RyYW5zcG9ydC9YaHJUcmFuc3BvcnRDaGFubmVsLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBO0FDQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDcktBO0FBQ0E7QUFDQTtBQUNBOztBQ0hBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ2xCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNwQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDdkNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7O0FDNURBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNuRkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDL0dBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNsREE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDM0JBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDdEJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNkQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ2JBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNkQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUMxQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ2RBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDaEJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ2pDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDakJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDbkJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3JCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNyQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzFCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDdkJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNwQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3RDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3RCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDakJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3JCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDdkJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDbkJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNwQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQy9DQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDN0JBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDL0JBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUN6Q0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzdCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDcEJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzdDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNyQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3BCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDcEJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNoQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDOUJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNwQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3BCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDcEJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNuQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDcENBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNYQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3BHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUN6REE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDbkdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDbkJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNqQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDOUJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJmaWxlIjoiZ2VuZXJhdGVkLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbiBlKHQsbixyKXtmdW5jdGlvbiBzKG8sdSl7aWYoIW5bb10pe2lmKCF0W29dKXt2YXIgYT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2lmKCF1JiZhKXJldHVybiBhKG8sITApO2lmKGkpcmV0dXJuIGkobywhMCk7dmFyIGY9bmV3IEVycm9yKFwiQ2Fubm90IGZpbmQgbW9kdWxlICdcIitvK1wiJ1wiKTt0aHJvdyBmLmNvZGU9XCJNT0RVTEVfTk9UX0ZPVU5EXCIsZn12YXIgbD1uW29dPXtleHBvcnRzOnt9fTt0W29dWzBdLmNhbGwobC5leHBvcnRzLGZ1bmN0aW9uKGUpe3ZhciBuPXRbb11bMV1bZV07cmV0dXJuIHMobj9uOmUpfSxsLGwuZXhwb3J0cyxlLHQsbixyKX1yZXR1cm4gbltvXS5leHBvcnRzfXZhciBpPXR5cGVvZiByZXF1aXJlPT1cImZ1bmN0aW9uXCImJnJlcXVpcmU7Zm9yKHZhciBvPTA7bzxyLmxlbmd0aDtvKyspcyhyW29dKTtyZXR1cm4gc30pIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgSHViXzEgPSByZXF1aXJlKFwiLi4vZXZlbnRIdWJzL0h1YlwiKTtcbnZhciBDb250YWluZXJfMSA9IHJlcXVpcmUoXCIuLi9pb2MvQ29udGFpbmVyXCIpO1xudmFyIElkTWV0cmljXzEgPSByZXF1aXJlKFwiLi4vbWV0cmljcy9JZE1ldHJpY1wiKTtcbnZhciBDb25maWd1cmF0aW9uXzEgPSByZXF1aXJlKFwiLi4vY29uZmlnL0NvbmZpZ3VyYXRpb25cIik7XG52YXIgRGlzcG9zZXJfMSA9IHJlcXVpcmUoXCIuLi9zZXJ2aWNlcy9kaXNwb3Nlci9EaXNwb3NlclwiKTtcbnZhciBNZXRyaWNzUmVhZGVyXzEgPSByZXF1aXJlKFwiLi4vbWV0cmljcy9NZXRyaWNzUmVhZGVyXCIpO1xudmFyIFZlcnNpb25NZXRyaWNfMSA9IHJlcXVpcmUoXCIuLi9tZXRyaWNzL1ZlcnNpb25NZXRyaWNcIik7XG52YXIgQnJvd3Nlck1ldHJpY18xID0gcmVxdWlyZShcIi4uL21ldHJpY3MvQnJvd3Nlck1ldHJpY1wiKTtcbnZhciBFdmVudElkc01ldHJpY18xID0gcmVxdWlyZShcIi4uL21ldHJpY3MvRXZlbnRJZHNNZXRyaWNcIik7XG52YXIgTG9jYXRpb25NZXRyaWNfMSA9IHJlcXVpcmUoXCIuLi9tZXRyaWNzL0xvY2F0aW9uTWV0cmljXCIpO1xudmFyIE1ldHJpY3NQcm9taXNlXzEgPSByZXF1aXJlKFwiLi4vbWV0cmljcy9NZXRyaWNzUHJvbWlzZVwiKTtcbnZhciBKU09OU2VyaWFsaXplcl8xID0gcmVxdWlyZShcIi4uL21lc3NhZ2luZy9KU09OU2VyaWFsaXplclwiKTtcbnZhciBBdHRlbnRpb25NZXRyaWNfMSA9IHJlcXVpcmUoXCIuLi9tZXRyaWNzL0F0dGVudGlvbk1ldHJpY1wiKTtcbnZhciBQcm9qZWN0SWRNZXRyaWNfMSA9IHJlcXVpcmUoXCIuLi9tZXRyaWNzL1Byb2plY3RJZE1ldHJpY1wiKTtcbnZhciBUaW1lT25QYWdlTWV0cmljXzEgPSByZXF1aXJlKFwiLi4vbWV0cmljcy9UaW1lT25QYWdlTWV0cmljXCIpO1xudmFyIE1ldHJpY0FnZ3JlZ2F0b3JfMSA9IHJlcXVpcmUoXCIuLi9tZXRyaWNzL01ldHJpY0FnZ3JlZ2F0b3JcIik7XG52YXIgU2Nyb2xsUmVhY2hNZXRyaWNfMSA9IHJlcXVpcmUoXCIuLi9tZXRyaWNzL1Njcm9sbFJlYWNoTWV0cmljXCIpO1xudmFyIElkR2VuZXJhdG9yXzEgPSByZXF1aXJlKFwiLi4vc2VydmljZXMvaWRHZW5lcmF0b3IvSWRHZW5lcmF0b3JcIik7XG52YXIgSXNOZXdWaXNpdG9yTWV0cmljXzEgPSByZXF1aXJlKFwiLi4vbWV0cmljcy9Jc05ld1Zpc2l0b3JNZXRyaWNcIik7XG52YXIgSlNFcnJvckNvdW50TWV0cmljXzEgPSByZXF1aXJlKFwiLi4vbWV0cmljcy9KU0Vycm9yQ291bnRNZXRyaWNcIik7XG52YXIgQ29va2llc1NlcnZpY2VfMSA9IHJlcXVpcmUoXCIuLi9zZXJ2aWNlcy9jb29raWVzL0Nvb2tpZXNTZXJ2aWNlXCIpO1xudmFyIENvbXBvc2l0ZUluYWN0aXZpdHlfMSA9IHJlcXVpcmUoXCIuLi9tZXRyaWNzL0NvbXBvc2l0ZUluYWN0aXZpdHlcIik7XG52YXIgQnJvd3NlclZlcnNpb25NZXRyaWNfMSA9IHJlcXVpcmUoXCIuLi9tZXRyaWNzL0Jyb3dzZXJWZXJzaW9uTWV0cmljXCIpO1xudmFyIExhY2tPZkludGVyZXN0TWV0cmljXzEgPSByZXF1aXJlKFwiLi4vbWV0cmljcy9MYWNrT2ZJbnRlcmVzdE1ldHJpY1wiKTtcbnZhciBOdW1iZXJPZkNsaWNrc01ldHJpY18xID0gcmVxdWlyZShcIi4uL21ldHJpY3MvTnVtYmVyT2ZDbGlja3NNZXRyaWNcIik7XG52YXIgWGhyVHJhbnNwb3J0Q2hhbm5lbF8xID0gcmVxdWlyZShcIi4uL3RyYW5zcG9ydC9YaHJUcmFuc3BvcnRDaGFubmVsXCIpO1xudmFyIFJlc29sdXRpb25XaWR0aE1ldHJpY18xID0gcmVxdWlyZShcIi4uL21ldHJpY3MvUmVzb2x1dGlvbldpZHRoTWV0cmljXCIpO1xudmFyIERpc3RyaWJ1dGlvblNlcnZpY2VfMSA9IHJlcXVpcmUoXCIuLi9kaXN0cmlidXRpb24vRGlzdHJpYnV0aW9uU2VydmljZVwiKTtcbnZhciBVc2VyQWdlbnRTZXJ2aWNlXzEgPSByZXF1aXJlKFwiLi4vc2VydmljZXMvdXNlckFnZW50L1VzZXJBZ2VudFNlcnZpY2VcIik7XG52YXIgUXVlcnlTdHJpbmdTZXJpYWxpemVyXzEgPSByZXF1aXJlKFwiLi4vbWVzc2FnaW5nL1F1ZXJ5U3RyaW5nU2VyaWFsaXplclwiKTtcbnZhciBJbWFnZVRyYW5zcG9ydENoYW5uZWxfMSA9IHJlcXVpcmUoXCIuLi90cmFuc3BvcnQvSW1hZ2VUcmFuc3BvcnRDaGFubmVsXCIpO1xudmFyIERvY3VtZW50UmVmZXJyZXJNZXRyaWNfMSA9IHJlcXVpcmUoXCIuLi9tZXRyaWNzL0RvY3VtZW50UmVmZXJyZXJNZXRyaWNcIik7XG52YXIgUGVyaW9kaWNhbE5vdGlmaWVyUnVsZV8xID0gcmVxdWlyZShcIi4uL21ldHJpY3MvUGVyaW9kaWNhbE5vdGlmaWVyUnVsZVwiKTtcbnZhciBSZXNvbHV0aW9uSGVpZ2h0TWV0cmljXzEgPSByZXF1aXJlKFwiLi4vbWV0cmljcy9SZXNvbHV0aW9uSGVpZ2h0TWV0cmljXCIpO1xudmFyIEJlYWNvblRyYW5zcG9ydENoYW5uZWxfMSA9IHJlcXVpcmUoXCIuLi90cmFuc3BvcnQvQmVhY29uVHJhbnNwb3J0Q2hhbm5lbFwiKTtcbnZhciBWaXNpdElkZW50aWZpY2F0aW9uTWV0cmljXzEgPSByZXF1aXJlKFwiLi4vbWV0cmljcy9WaXNpdElkZW50aWZpY2F0aW9uTWV0cmljXCIpO1xudmFyIERPTUxDb250ZW50TG9hZGVkVGltZU1ldHJpY18xID0gcmVxdWlyZShcIi4uL21ldHJpY3MvRE9NTENvbnRlbnRMb2FkZWRUaW1lTWV0cmljXCIpO1xudmFyIFZpc2l0b3JJZGVudGlmaWNhdGlvbk1ldHJpY18xID0gcmVxdWlyZShcIi4uL21ldHJpY3MvVmlzaXRvcklkZW50aWZpY2F0aW9uTWV0cmljXCIpO1xudmFyIFBhZ2VWaWV3SWRlbnRpZmljYXRpb25NZXRyaWNfMSA9IHJlcXVpcmUoXCIuLi9tZXRyaWNzL1BhZ2VWaWV3SWRlbnRpZmljYXRpb25NZXRyaWNcIik7XG52YXIgSWRlbnRpZmljYXRpb25TZXJ2aWNlXzEgPSByZXF1aXJlKFwiLi4vc2VydmljZXMvaWRlbnRpZmljYXRpb24vSWRlbnRpZmljYXRpb25TZXJ2aWNlXCIpO1xudmFyIEVuZ2FnZW1lbnRUaW1lQWdncmVnYXRvck1ldHJpY18xID0gcmVxdWlyZShcIi4uL21ldHJpY3MvRW5nYWdlbWVudFRpbWVBZ2dyZWdhdG9yTWV0cmljXCIpO1xudmFyIEFwcCA9IChmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gQXBwKHByb2plY3RJZCkge1xuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgICB0aGlzLnByb2plY3RJZCA9IHByb2plY3RJZDtcbiAgICAgICAgdGhpcy5ib290c3RyYXAoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgaWYgKF90aGlzLnRyeVJlZ2lzdGVyQ29tcG9uZW50cygpKSB7XG4gICAgICAgICAgICAgICAgX3RoaXMuc3RhcnQoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfVxuICAgIEFwcC5wcm90b3R5cGUuYm9vdHN0cmFwID0gZnVuY3Rpb24gKGNhbGxiYWNrKSB7XG4gICAgICAgIGlmICghQXBwLmlzTW9uaXRvcmluZykge1xuICAgICAgICAgICAgaWYgKC9jb21wbGV0ZXxpbnRlcmFjdGl2ZS8udGVzdChkb2N1bWVudC5yZWFkeVN0YXRlKSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBjYWxsYmFjaygpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcIkRPTUNvbnRlbnRMb2FkZWRcIiwgY2FsbGJhY2ssIGZhbHNlKTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgQXBwLnByb3RvdHlwZS5zdGFydCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIGRpc3Bvc2VyID0gQXBwLmNvbnRhaW5lci5yZXNvbHZlKFwiRGlzcG9zZXJcIik7XG4gICAgICAgIEFwcC5pc01vbml0b3JpbmcgPSB0cnVlO1xuICAgICAgICBBcHAuY29udGFpbmVyLnJlc29sdmUoXCJIdWJcIik7XG4gICAgICAgIEFwcC5jb250YWluZXIucmVzb2x2ZShcIkNvbXBvc2l0ZUluYWN0aXZpdHlcIik7XG4gICAgICAgIEFwcC5jb250YWluZXIucmVzb2x2ZShcIk1ldHJpY3NSZWFkZXJcIik7XG4gICAgICAgIEFwcC5jb250YWluZXIucmVzb2x2ZShcIkRpc3RyaWJ1dGlvblNlcnZpY2VcIik7XG4gICAgICAgIGRpc3Bvc2VyLm1ldHJpY0FnZ3JlZ2F0b3IgPSBBcHAuY29udGFpbmVyLnJlc29sdmUoXCJNZXRyaWNBZ2dyZWdhdG9yXCIpO1xuICAgIH07XG4gICAgQXBwLnByb3RvdHlwZS50cnlSZWdpc3RlckNvbXBvbmVudHMgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgIHZhciB1c2VyQWdlbnRTZXJ2aWNlID0gbmV3IFVzZXJBZ2VudFNlcnZpY2VfMS5Vc2VyQWdlbnRTZXJ2aWNlKCk7XG4gICAgICAgIGlmICh1c2VyQWdlbnRTZXJ2aWNlLmlzQnJvd3NlclN1cHBvcnRlZCkge1xuICAgICAgICAgICAgQXBwLmNvbnRhaW5lciA9IG5ldyBDb250YWluZXJfMS5Db250YWluZXIoKTtcbiAgICAgICAgICAgIHRoaXMuZXZlbnRSZXBvc2l0b3J5ID0gbmV3IEV2ZW50SWRzTWV0cmljXzEuRXZlbnRJZHNNZXRyaWMoKTtcbiAgICAgICAgICAgIEFwcC5jb250YWluZXIucmVnaXN0ZXIoXCJIdWJcIiwgZnVuY3Rpb24gKGMpIHsgcmV0dXJuIG5ldyBIdWJfMS5IdWIodXNlckFnZW50U2VydmljZSk7IH0pO1xuICAgICAgICAgICAgQXBwLmNvbnRhaW5lci5yZWdpc3Rlckluc3RhbmNlKHVzZXJBZ2VudFNlcnZpY2UpO1xuICAgICAgICAgICAgQXBwLnJlZ2lzdGVyVHJhbnNwb3J0Q2hhbm5lbHModXNlckFnZW50U2VydmljZS51c2VyQWdlbnQsIENvbmZpZ3VyYXRpb25fMS5Db25maWd1cmF0aW9uKTtcbiAgICAgICAgICAgIEFwcC5jb250YWluZXIucmVnaXN0ZXIoXCJJZEdlbmVyYXRvclwiLCBmdW5jdGlvbiAoYykgeyByZXR1cm4gbmV3IElkR2VuZXJhdG9yXzEuSWRHZW5lcmF0b3IoKTsgfSk7XG4gICAgICAgICAgICBBcHAuY29udGFpbmVyLnJlZ2lzdGVyKFwiVmVyc2lvbk1ldHJpY1wiLCBmdW5jdGlvbiAoYykgeyByZXR1cm4gbmV3IFZlcnNpb25NZXRyaWNfMS5WZXJzaW9uTWV0cmljKCk7IH0pO1xuICAgICAgICAgICAgQXBwLmNvbnRhaW5lci5yZWdpc3RlcihcIkxvY2F0aW9uTWV0cmljXCIsIGZ1bmN0aW9uIChjKSB7IHJldHVybiBuZXcgTG9jYXRpb25NZXRyaWNfMS5Mb2NhdGlvbk1ldHJpYygpOyB9KTtcbiAgICAgICAgICAgIEFwcC5jb250YWluZXIucmVnaXN0ZXIoXCJDb29raWVzU2VydmljZVwiLCBmdW5jdGlvbiAoYykgeyByZXR1cm4gbmV3IENvb2tpZXNTZXJ2aWNlXzEuQ29va2llc1NlcnZpY2UoKTsgfSk7XG4gICAgICAgICAgICBBcHAuY29udGFpbmVyLnJlZ2lzdGVyKFwiQnJvd3Nlck1ldHJpY1wiLCBmdW5jdGlvbiAoYykgeyByZXR1cm4gbmV3IEJyb3dzZXJNZXRyaWNfMS5Ccm93c2VyTWV0cmljKHVzZXJBZ2VudFNlcnZpY2UpOyB9KTtcbiAgICAgICAgICAgIEFwcC5jb250YWluZXIucmVnaXN0ZXIoXCJSZXNvbHV0aW9uV2lkdGhNZXRyaWNcIiwgZnVuY3Rpb24gKGMpIHsgcmV0dXJuIG5ldyBSZXNvbHV0aW9uV2lkdGhNZXRyaWNfMS5SZXNvbHV0aW9uV2lkdGhNZXRyaWMoKTsgfSk7XG4gICAgICAgICAgICBBcHAuY29udGFpbmVyLnJlZ2lzdGVyTmFtZWRJbnN0YW5jZShcIkV2ZW50SWRzTWV0cmljXCIsIHRoaXMuZXZlbnRSZXBvc2l0b3J5KTtcbiAgICAgICAgICAgIEFwcC5jb250YWluZXIucmVnaXN0ZXIoXCJQcm9qZWN0SWRNZXRyaWNcIiwgZnVuY3Rpb24gKGMpIHsgcmV0dXJuIG5ldyBQcm9qZWN0SWRNZXRyaWNfMS5Qcm9qZWN0SWRNZXRyaWMoX3RoaXMucHJvamVjdElkKTsgfSk7XG4gICAgICAgICAgICBBcHAuY29udGFpbmVyLnJlZ2lzdGVyKFwiRG9jdW1lbnRSZWZlcnJlck1ldHJpY1wiLCBmdW5jdGlvbiAoYykgeyByZXR1cm4gbmV3IERvY3VtZW50UmVmZXJyZXJNZXRyaWNfMS5Eb2N1bWVudFJlZmVycmVyTWV0cmljKCk7IH0pO1xuICAgICAgICAgICAgQXBwLmNvbnRhaW5lci5yZWdpc3RlcihcIlJlc29sdXRpb25IZWlnaHRNZXRyaWNcIiwgZnVuY3Rpb24gKGMpIHsgcmV0dXJuIG5ldyBSZXNvbHV0aW9uSGVpZ2h0TWV0cmljXzEuUmVzb2x1dGlvbkhlaWdodE1ldHJpYygpOyB9KTtcbiAgICAgICAgICAgIEFwcC5jb250YWluZXIucmVnaXN0ZXIoXCJJZE1ldHJpY1wiLCBmdW5jdGlvbiAoYywgaWQpIHsgcmV0dXJuIG5ldyBJZE1ldHJpY18xLklkTWV0cmljKGlkKTsgfSkuYXNUcmFuc2llbnQoKTtcbiAgICAgICAgICAgIEFwcC5jb250YWluZXIucmVnaXN0ZXIoXCJBdHRlbnRpb25NZXRyaWNcIiwgZnVuY3Rpb24gKGMpIHsgcmV0dXJuIG5ldyBBdHRlbnRpb25NZXRyaWNfMS5BdHRlbnRpb25NZXRyaWMocGVyZm9ybWFuY2UudGltaW5nKTsgfSk7XG4gICAgICAgICAgICBBcHAuY29udGFpbmVyLnJlZ2lzdGVyKFwiQnJvd3NlclZlcnNpb25NZXRyaWNcIiwgZnVuY3Rpb24gKGMpIHsgcmV0dXJuIG5ldyBCcm93c2VyVmVyc2lvbk1ldHJpY18xLkJyb3dzZXJWZXJzaW9uTWV0cmljKHVzZXJBZ2VudFNlcnZpY2UpOyB9KTtcbiAgICAgICAgICAgIEFwcC5jb250YWluZXIucmVnaXN0ZXIoXCJTY3JvbGxSZWFjaE1ldHJpY1wiLCBmdW5jdGlvbiAoYykgeyByZXR1cm4gbmV3IFNjcm9sbFJlYWNoTWV0cmljXzEuU2Nyb2xsUmVhY2hNZXRyaWMoYy5yZXNvbHZlKFwiSHViXCIpKTsgfSk7XG4gICAgICAgICAgICBBcHAuY29udGFpbmVyLnJlZ2lzdGVyKFwiSlNFcnJvckNvdW50TWV0cmljXCIsIGZ1bmN0aW9uIChjKSB7IHJldHVybiBuZXcgSlNFcnJvckNvdW50TWV0cmljXzEuSlNFcnJvckNvdW50TWV0cmljKGMucmVzb2x2ZShcIkh1YlwiKSk7IH0pO1xuICAgICAgICAgICAgQXBwLmNvbnRhaW5lci5yZWdpc3RlcihcIkxhY2tPZkludGVyZXN0TWV0cmljXCIsIGZ1bmN0aW9uIChjKSB7IHJldHVybiBuZXcgTGFja09mSW50ZXJlc3RNZXRyaWNfMS5MYWNrT2ZJbnRlcmVzdE1ldHJpYyhwZXJmb3JtYW5jZS50aW1pbmcpOyB9KTtcbiAgICAgICAgICAgIEFwcC5jb250YWluZXIucmVnaXN0ZXIoQ29uZmlndXJhdGlvbl8xLkNvbmZpZ3VyYXRpb24udHJhbnNwb3J0Lm1haW5DaGFubmVsICsgXCIgc2VyaWFsaXplclwiLCBmdW5jdGlvbiAoYykgeyByZXR1cm4gbmV3IEpTT05TZXJpYWxpemVyXzEuSlNPTlNlcmlhbGl6ZXIoKTsgfSk7XG4gICAgICAgICAgICBBcHAuY29udGFpbmVyLnJlZ2lzdGVyKFwiTnVtYmVyT2ZDbGlja3NNZXRyaWNcIiwgZnVuY3Rpb24gKGMpIHsgcmV0dXJuIG5ldyBOdW1iZXJPZkNsaWNrc01ldHJpY18xLk51bWJlck9mQ2xpY2tzTWV0cmljKGMucmVzb2x2ZShcIkh1YlwiKSk7IH0pO1xuICAgICAgICAgICAgQXBwLmNvbnRhaW5lci5yZWdpc3RlcihcIlBlcmlvZGljYWxOb3RpZmllclJ1bGVcIiwgZnVuY3Rpb24gKGMpIHsgcmV0dXJuIG5ldyBQZXJpb2RpY2FsTm90aWZpZXJSdWxlXzEuUGVyaW9kaWNhbE5vdGlmaWVyUnVsZShDb25maWd1cmF0aW9uXzEuQ29uZmlndXJhdGlvbik7IH0pO1xuICAgICAgICAgICAgQXBwLmNvbnRhaW5lci5yZWdpc3RlcihDb25maWd1cmF0aW9uXzEuQ29uZmlndXJhdGlvbi50cmFuc3BvcnQudGVybWluYWxDaGFubmVsICsgXCIgc2VyaWFsaXplclwiLCBmdW5jdGlvbiAoYykgeyByZXR1cm4gbmV3IFF1ZXJ5U3RyaW5nU2VyaWFsaXplcl8xLlF1ZXJ5U3RyaW5nU2VyaWFsaXplcigpOyB9KTtcbiAgICAgICAgICAgIEFwcC5jb250YWluZXIucmVnaXN0ZXIoXCJET01MQ29udGVudExvYWRlZFRpbWVNZXRyaWNcIiwgZnVuY3Rpb24gKGMpIHsgcmV0dXJuIG5ldyBET01MQ29udGVudExvYWRlZFRpbWVNZXRyaWNfMS5ET01MQ29udGVudExvYWRlZFRpbWVNZXRyaWMocGVyZm9ybWFuY2UudGltaW5nKTsgfSk7XG4gICAgICAgICAgICBBcHAuY29udGFpbmVyLnJlZ2lzdGVyKFwiVGltZU9uUGFnZU1ldHJpY1wiLCBmdW5jdGlvbiAoYykgeyByZXR1cm4gbmV3IFRpbWVPblBhZ2VNZXRyaWNfMS5UaW1lT25QYWdlTWV0cmljKGMucmVzb2x2ZShcIkh1YlwiKSwgcGVyZm9ybWFuY2UudGltaW5nKTsgfSk7XG4gICAgICAgICAgICBBcHAuY29udGFpbmVyLnJlZ2lzdGVyKFwiRGlzcG9zZXJcIiwgZnVuY3Rpb24gKGMpIHsgcmV0dXJuIG5ldyBEaXNwb3Nlcl8xLkRpc3Bvc2VyKGMucmVzb2x2ZShcIkh1YlwiKSwgYywgQ29uZmlndXJhdGlvbl8xLkNvbmZpZ3VyYXRpb24sIF90aGlzKTsgfSkub3duZWRFeHRlcm5hbGx5KCk7XG4gICAgICAgICAgICBBcHAuY29udGFpbmVyLnJlZ2lzdGVyKFwiTWV0cmljc1Byb21pc2VcIiwgZnVuY3Rpb24gKGMpIHsgcmV0dXJuIG5ldyBNZXRyaWNzUHJvbWlzZV8xLk1ldHJpY3NQcm9taXNlKGMucmVzb2x2ZShcIk1ldHJpY0FnZ3JlZ2F0b3JcIikpOyB9KTtcbiAgICAgICAgICAgIEFwcC5jb250YWluZXIucmVnaXN0ZXIoXCJJc05ld1Zpc2l0b3JNZXRyaWNcIiwgZnVuY3Rpb24gKGMpIHsgcmV0dXJuIG5ldyBJc05ld1Zpc2l0b3JNZXRyaWNfMS5Jc05ld1Zpc2l0b3JNZXRyaWMoYy5yZXNvbHZlKFwiSWRlbnRpZmljYXRpb25TZXJ2aWNlXCIpKTsgfSk7XG4gICAgICAgICAgICBBcHAuY29udGFpbmVyLnJlZ2lzdGVyKFwiVmlzaXRJZGVudGlmaWNhdGlvbk1ldHJpY1wiLCBmdW5jdGlvbiAoYykgeyByZXR1cm4gbmV3IFZpc2l0SWRlbnRpZmljYXRpb25NZXRyaWNfMS5WaXNpdElkZW50aWZpY2F0aW9uTWV0cmljKGMucmVzb2x2ZShcIklkZW50aWZpY2F0aW9uU2VydmljZVwiKSk7IH0pO1xuICAgICAgICAgICAgQXBwLmNvbnRhaW5lci5yZWdpc3RlcihcIlZpc2l0b3JJZGVudGlmaWNhdGlvbk1ldHJpY1wiLCBmdW5jdGlvbiAoYykgeyByZXR1cm4gbmV3IFZpc2l0b3JJZGVudGlmaWNhdGlvbk1ldHJpY18xLlZpc2l0b3JJZGVudGlmaWNhdGlvbk1ldHJpYyhjLnJlc29sdmUoXCJJZGVudGlmaWNhdGlvblNlcnZpY2VcIikpOyB9KTtcbiAgICAgICAgICAgIEFwcC5jb250YWluZXIucmVnaXN0ZXIoXCJQYWdlVmlld0lkZW50aWZpY2F0aW9uTWV0cmljXCIsIGZ1bmN0aW9uIChjKSB7IHJldHVybiBuZXcgUGFnZVZpZXdJZGVudGlmaWNhdGlvbk1ldHJpY18xLlBhZ2VWaWV3SWRlbnRpZmljYXRpb25NZXRyaWMoYy5yZXNvbHZlKFwiSWRlbnRpZmljYXRpb25TZXJ2aWNlXCIpKTsgfSk7XG4gICAgICAgICAgICBBcHAuY29udGFpbmVyLnJlZ2lzdGVyKFwiRW5nYWdlbWVudFRpbWVBZ2dyZWdhdG9yTWV0cmljXCIsIGZ1bmN0aW9uIChjKSB7IHJldHVybiBuZXcgRW5nYWdlbWVudFRpbWVBZ2dyZWdhdG9yTWV0cmljXzEuRW5nYWdlbWVudFRpbWVBZ2dyZWdhdG9yTWV0cmljKGMucmVzb2x2ZShcIkh1YlwiKSwgQ29uZmlndXJhdGlvbl8xLkNvbmZpZ3VyYXRpb24sIHBlcmZvcm1hbmNlLnRpbWluZyk7IH0pO1xuICAgICAgICAgICAgQXBwLmNvbnRhaW5lci5yZWdpc3RlcihcIkRpc3RyaWJ1dGlvblNlcnZpY2VcIiwgZnVuY3Rpb24gKGMpIHsgcmV0dXJuIG5ldyBEaXN0cmlidXRpb25TZXJ2aWNlXzEuRGlzdHJpYnV0aW9uU2VydmljZShfdGhpcywgQ29uZmlndXJhdGlvbl8xLkNvbmZpZ3VyYXRpb24sIGMucmVzb2x2ZShcIkh1YlwiKSwgYywgYy5yZXNvbHZlKFwiRGlzcG9zZXJcIikpOyB9KTtcbiAgICAgICAgICAgIEFwcC5jb250YWluZXIucmVnaXN0ZXIoXCJDb21wb3NpdGVJbmFjdGl2aXR5XCIsIGZ1bmN0aW9uIChjKSB7IHJldHVybiBuZXcgQ29tcG9zaXRlSW5hY3Rpdml0eV8xLkNvbXBvc2l0ZUluYWN0aXZpdHkoYy5yZXNvbHZlKFwiSHViXCIpLCBjLnJlc29sdmUoXCJMYWNrT2ZJbnRlcmVzdE1ldHJpY1wiKSwgYy5yZXNvbHZlKFwiQXR0ZW50aW9uTWV0cmljXCIpKTsgfSk7XG4gICAgICAgICAgICBBcHAuY29udGFpbmVyLnJlZ2lzdGVyKFwiSWRlbnRpZmljYXRpb25TZXJ2aWNlXCIsIGZ1bmN0aW9uIChjKSB7IHJldHVybiBuZXcgSWRlbnRpZmljYXRpb25TZXJ2aWNlXzEuSWRlbnRpZmljYXRpb25TZXJ2aWNlKGMucmVzb2x2ZShcIklkR2VuZXJhdG9yXCIpLCBjLnJlc29sdmUoXCJDb29raWVzU2VydmljZVwiKSwgQ29uZmlndXJhdGlvbl8xLkNvbmZpZ3VyYXRpb24pOyB9KTtcbiAgICAgICAgICAgIEFwcC5jb250YWluZXIucmVnaXN0ZXIoXCJNZXRyaWNBZ2dyZWdhdG9yXCIsIGZ1bmN0aW9uIChjKSB7XG4gICAgICAgICAgICAgICAgdmFyIG1ldHJpY0FycmF5ID0gQ29uZmlndXJhdGlvbl8xLkNvbmZpZ3VyYXRpb24ubWV0cmljcy5wcm92aWRlcnMubWFwKGZ1bmN0aW9uIChtZXRyaWMpIHsgcmV0dXJuIGMucmVzb2x2ZShtZXRyaWMpOyB9KTtcbiAgICAgICAgICAgICAgICBtZXRyaWNBcnJheSA9IG1ldHJpY0FycmF5LmNvbmNhdChbXG4gICAgICAgICAgICAgICAgICAgIGMucmVzb2x2ZShcIlZlcnNpb25NZXRyaWNcIiksXG4gICAgICAgICAgICAgICAgICAgIGMucmVzb2x2ZShcIkxvY2F0aW9uTWV0cmljXCIpLFxuICAgICAgICAgICAgICAgICAgICBjLnJlc29sdmUoXCJQcm9qZWN0SWRNZXRyaWNcIiksXG4gICAgICAgICAgICAgICAgICAgIGMucmVzb2x2ZShcIkRvY3VtZW50UmVmZXJyZXJNZXRyaWNcIiksXG4gICAgICAgICAgICAgICAgICAgIGMucmVzb2x2ZShcIlZpc2l0SWRlbnRpZmljYXRpb25NZXRyaWNcIiksXG4gICAgICAgICAgICAgICAgICAgIGMucmVzb2x2ZShcIkRPTUxDb250ZW50TG9hZGVkVGltZU1ldHJpY1wiKSxcbiAgICAgICAgICAgICAgICAgICAgYy5yZXNvbHZlKFwiVmlzaXRvcklkZW50aWZpY2F0aW9uTWV0cmljXCIpLFxuICAgICAgICAgICAgICAgICAgICBjLnJlc29sdmUoXCJQYWdlVmlld0lkZW50aWZpY2F0aW9uTWV0cmljXCIpXG4gICAgICAgICAgICAgICAgXSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBNZXRyaWNBZ2dyZWdhdG9yXzEuTWV0cmljQWdncmVnYXRvcihtZXRyaWNBcnJheSwgYy5yZXNvbHZlKFwiSHViXCIpLCBDb25maWd1cmF0aW9uXzEuQ29uZmlndXJhdGlvbiwgYy5yZXNvbHZlRmFjdG9yeShcIklkTWV0cmljXCIpLCBjLnJlc29sdmUoXCJEaXNwb3NlclwiKSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIEFwcC5jb250YWluZXIucmVnaXN0ZXIoXCJNZXRyaWNzUmVhZGVyXCIsIGZ1bmN0aW9uIChjKSB7XG4gICAgICAgICAgICAgICAgdmFyIHByb21pc2UgPSBjLnJlc29sdmUoXCJNZXRyaWNzUHJvbWlzZVwiKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IE1ldHJpY3NSZWFkZXJfMS5NZXRyaWNzUmVhZGVyKFtcbiAgICAgICAgICAgICAgICAgICAgcHJvbWlzZSxcbiAgICAgICAgICAgICAgICAgICAgYy5yZXNvbHZlKFwiUGVyaW9kaWNhbE5vdGlmaWVyUnVsZVwiKV0sIGMucmVzb2x2ZShcIkh1YlwiKSwgYy5yZXNvbHZlKFwiTWV0cmljQWdncmVnYXRvclwiKSwgYy5yZXNvbHZlKFwiRGlzdHJpYnV0aW9uU2VydmljZVwiKSwgcHJvbWlzZSwgYy5yZXNvbHZlKFwiSWRlbnRpZmljYXRpb25TZXJ2aWNlXCIpKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH07XG4gICAgQXBwLnByb3RvdHlwZS5zaHV0ZG93biA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5kaXNwb3NlKHRydWUpO1xuICAgIH07XG4gICAgQXBwLnByb3RvdHlwZS5kaXNwb3NlID0gZnVuY3Rpb24gKHNodXRkb3duKSB7XG4gICAgICAgIHZhciBkaXNwb3NlciA9IEFwcC5jb250YWluZXIucmVzb2x2ZShcIkRpc3Bvc2VyXCIpO1xuICAgICAgICBkaXNwb3Nlci5kaXNwb3NlKHNodXRkb3duKTtcbiAgICB9O1xuICAgIEFwcC5wcm90b3R5cGUuc3RvcCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgQXBwLmlzTW9uaXRvcmluZyA9IGZhbHNlO1xuICAgIH07XG4gICAgQXBwLnByb3RvdHlwZS5pc01vbml0b3JpbmcgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiBBcHAuaXNNb25pdG9yaW5nO1xuICAgIH07XG4gICAgQXBwLnByb3RvdHlwZS5zZXRJZGVudGlmaWNhdGlvbiA9IGZ1bmN0aW9uIChpZGVudGlmaWNhdGlvbikge1xuICAgICAgICB2YXIgaWRlbnRpZmljYXRpb25TZXJ2aWNlID0gQXBwLmNvbnRhaW5lci5yZXNvbHZlKFwiSWRlbnRpZmljYXRpb25TZXJ2aWNlXCIpO1xuICAgICAgICBpZGVudGlmaWNhdGlvblNlcnZpY2Uuc2V0SWRlbnRpZmljYXRpb24oaWRlbnRpZmljYXRpb24pO1xuICAgIH07XG4gICAgQXBwLnJlZ2lzdGVyVHJhbnNwb3J0Q2hhbm5lbHMgPSBmdW5jdGlvbiAodXNlckFnZW50LCBjb25maWcpIHtcbiAgICAgICAgdmFyIHRyYW5zcG9ydENvbmZpZyA9IGNvbmZpZy50cmFuc3BvcnQ7XG4gICAgICAgIHZhciBicm93c2VyVHlwZSA9IHVzZXJBZ2VudC5icm93c2VyLnR5cGU7XG4gICAgICAgIHZhciB0cmFuc3BvcnRDaGFubmVsVGVybWluYWwgPSB1c2VyQWdlbnQuc3VwcG9ydHMuc2VuZEJlYWNvbiA/IEJlYWNvblRyYW5zcG9ydENoYW5uZWxfMS5CZWFjb25UcmFuc3BvcnRDaGFubmVsIDogSW1hZ2VUcmFuc3BvcnRDaGFubmVsXzEuSW1hZ2VUcmFuc3BvcnRDaGFubmVsO1xuICAgICAgICBBcHAuY29udGFpbmVyLnJlZ2lzdGVyKHRyYW5zcG9ydENvbmZpZy50ZXJtaW5hbENoYW5uZWwgKyBcIiBjaGFubmVsXCIsIGZ1bmN0aW9uIChjLCBzZXR0aW5ncykgeyByZXR1cm4gbmV3IHRyYW5zcG9ydENoYW5uZWxUZXJtaW5hbChzZXR0aW5ncyk7IH0pLm93bmVkRXh0ZXJuYWxseSgpO1xuICAgICAgICBBcHAuY29udGFpbmVyLnJlZ2lzdGVyKHRyYW5zcG9ydENvbmZpZy5tYWluQ2hhbm5lbCArIFwiIGNoYW5uZWxcIiwgZnVuY3Rpb24gKGMsIHNldHRpbmdzKSB7IHJldHVybiBuZXcgWGhyVHJhbnNwb3J0Q2hhbm5lbF8xLlRyYW5zcG9ydENoYW5uZWxYaHIoc2V0dGluZ3MpOyB9KS5hc1RyYW5zaWVudCgpLm93bmVkRXh0ZXJuYWxseSgpO1xuICAgIH07XG4gICAgQXBwLnByb3RvdHlwZS5hZGRFdmVudCA9IGZ1bmN0aW9uIChldmVudElkKSB7XG4gICAgICAgIHRoaXMuZXZlbnRSZXBvc2l0b3J5LmFkZEV2ZW50KGV2ZW50SWQpO1xuICAgIH07XG4gICAgQXBwLmlzTW9uaXRvcmluZyA9IGZhbHNlO1xuICAgIHJldHVybiBBcHA7XG59KCkpO1xuZXhwb3J0cy5BcHAgPSBBcHA7XG4iLCJcInVzZSBzdHJpY3RcIjtcbnZhciBBcHBfMSA9IHJlcXVpcmUoXCIuL0FwcFwiKTtcbmV4cG9ydHMuQXBwID0gQXBwXzEuQXBwO1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgRXZlbnRUeXBlO1xuKGZ1bmN0aW9uIChFdmVudFR5cGUpIHtcbiAgICBFdmVudFR5cGVbRXZlbnRUeXBlW1wiZXJyb3JcIl0gPSAwXSA9IFwiZXJyb3JcIjtcbiAgICBFdmVudFR5cGVbRXZlbnRUeXBlW1wia2V5dXBcIl0gPSAxXSA9IFwia2V5dXBcIjtcbiAgICBFdmVudFR5cGVbRXZlbnRUeXBlW1wic2Nyb2xsXCJdID0gMl0gPSBcInNjcm9sbFwiO1xuICAgIEV2ZW50VHlwZVtFdmVudFR5cGVbXCJyZXNpemVcIl0gPSAzXSA9IFwicmVzaXplXCI7XG4gICAgRXZlbnRUeXBlW0V2ZW50VHlwZVtcInVubG9hZFwiXSA9IDRdID0gXCJ1bmxvYWRcIjtcbiAgICBFdmVudFR5cGVbRXZlbnRUeXBlW1wib25saW5lXCJdID0gNV0gPSBcIm9ubGluZVwiO1xuICAgIEV2ZW50VHlwZVtFdmVudFR5cGVbXCJtb3VzZXVwXCJdID0gNl0gPSBcIm1vdXNldXBcIjtcbiAgICBFdmVudFR5cGVbRXZlbnRUeXBlW1wib2ZmbGluZVwiXSA9IDddID0gXCJvZmZsaW5lXCI7XG4gICAgRXZlbnRUeXBlW0V2ZW50VHlwZVtcIm1vdXNlZG93blwiXSA9IDhdID0gXCJtb3VzZWRvd25cIjtcbiAgICBFdmVudFR5cGVbRXZlbnRUeXBlW1wibW91c2VvdmVyXCJdID0gOV0gPSBcIm1vdXNlb3ZlclwiO1xuICAgIEV2ZW50VHlwZVtFdmVudFR5cGVbXCJ0b3VjaHN0YXJ0XCJdID0gMTBdID0gXCJ0b3VjaHN0YXJ0XCI7XG4gICAgRXZlbnRUeXBlW0V2ZW50VHlwZVtcImJlZm9yZXVubG9hZFwiXSA9IDExXSA9IFwiYmVmb3JldW5sb2FkXCI7XG4gICAgRXZlbnRUeXBlW0V2ZW50VHlwZVtcInZpc2liaWxpdHljaGFuZ2VcIl0gPSAxMl0gPSBcInZpc2liaWxpdHljaGFuZ2VcIjtcbn0pKEV2ZW50VHlwZSB8fCAoRXZlbnRUeXBlID0ge30pKTtcbmV4cG9ydHMuRXZlbnRUeXBlID0gRXZlbnRUeXBlO1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgRGljdGlvbmFyeSA9IChmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gRGljdGlvbmFyeSgpIHtcbiAgICB9XG4gICAgRGljdGlvbmFyeS5wcm90b3R5cGUuYWRkID0gZnVuY3Rpb24gKGtleSwgdmFsdWUpIHtcbiAgICAgICAgdGhpc1trZXkudG9TdHJpbmcoKV0gPSB2YWx1ZTtcbiAgICB9O1xuICAgIERpY3Rpb25hcnkucHJvdG90eXBlLnJlbW92ZSA9IGZ1bmN0aW9uIChrZXkpIHtcbiAgICAgICAgZGVsZXRlIHRoaXNba2V5LnRvU3RyaW5nKCldO1xuICAgIH07XG4gICAgRGljdGlvbmFyeS5wcm90b3R5cGUuY29udGFpbnNLZXkgPSBmdW5jdGlvbiAoa2V5KSB7XG4gICAgICAgIHJldHVybiAhIXRoaXNba2V5LnRvU3RyaW5nKCldO1xuICAgIH07XG4gICAgRGljdGlvbmFyeS5wcm90b3R5cGUudHJ5R2V0VmFsdWUgPSBmdW5jdGlvbiAoa2V5LCBlbnRyeSkge1xuICAgICAgICB2YXIgdmFsdWUgPSB0aGlzW2tleS50b1N0cmluZygpXTtcbiAgICAgICAgaWYgKHZhbHVlKSB7XG4gICAgICAgICAgICBlbnRyeS5vdXQgPSB2YWx1ZTtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9O1xuICAgIERpY3Rpb25hcnkucHJvdG90eXBlLmNsZWFyID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgICBPYmplY3Qua2V5cyh0aGlzKS5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHtcbiAgICAgICAgICAgIGRlbGV0ZSBfdGhpc1trZXldO1xuICAgICAgICB9KTtcbiAgICB9O1xuICAgIERpY3Rpb25hcnkucHJvdG90eXBlLnZhbHVlcyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcbiAgICAgICAgcmV0dXJuIE9iamVjdC5rZXlzKHRoaXMpLm1hcChmdW5jdGlvbiAoa2V5KSB7XG4gICAgICAgICAgICByZXR1cm4gX3RoaXNba2V5XTtcbiAgICAgICAgfSk7XG4gICAgfTtcbiAgICByZXR1cm4gRGljdGlvbmFyeTtcbn0oKSk7XG5leHBvcnRzLkRpY3Rpb25hcnkgPSBEaWN0aW9uYXJ5O1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgT2JqZWN0RXh0ZW5kZXJfMSA9IHJlcXVpcmUoXCIuLi9zZXJ2aWNlcy9vYmplY3RFeHRlbmRlci9PYmplY3RFeHRlbmRlclwiKTtcbnZhciB1c2VyQ29uZmlnID0gd2luZG93LkNsaWNrVGFsZU1vbml0b3JTZXR0aW5ncztcbnZhciBDb25maWd1cmF0aW9uID0ge1xuICAgIG1ldHJpY3M6IHtcbiAgICAgICAgaW5hY3Rpdml0eVRpbWU6IDIwMDAwLFxuICAgICAgICBtYXhGZXRjaEludGVydmFsOiAxMDAwMCxcbiAgICAgICAgcHJvdmlkZXJzOiBbXG4gICAgICAgICAgICBcIkJyb3dzZXJNZXRyaWNcIixcbiAgICAgICAgICAgIFwiRXZlbnRJZHNNZXRyaWNcIixcbiAgICAgICAgICAgIFwiVGltZU9uUGFnZU1ldHJpY1wiLFxuICAgICAgICAgICAgXCJTY3JvbGxSZWFjaE1ldHJpY1wiLFxuICAgICAgICAgICAgXCJJc05ld1Zpc2l0b3JNZXRyaWNcIixcbiAgICAgICAgICAgIFwiSlNFcnJvckNvdW50TWV0cmljXCIsXG4gICAgICAgICAgICBcIk51bWJlck9mQ2xpY2tzTWV0cmljXCIsXG4gICAgICAgICAgICBcIkJyb3dzZXJWZXJzaW9uTWV0cmljXCIsXG4gICAgICAgICAgICBcIlJlc29sdXRpb25XaWR0aE1ldHJpY1wiLFxuICAgICAgICAgICAgXCJSZXNvbHV0aW9uSGVpZ2h0TWV0cmljXCIsXG4gICAgICAgICAgICBcIkVuZ2FnZW1lbnRUaW1lQWdncmVnYXRvck1ldHJpY1wiXG4gICAgICAgIF1cbiAgICB9LFxuICAgIGlkZW50aWZpY2F0aW9uOiB7XG4gICAgICAgIGV4cGlyYXRpb25EYXlzOiAzNjUsXG4gICAgICAgIHZpc2l0VGltZVNwYW46IDE4MDAwMDBcbiAgICB9LFxuICAgIHRyYW5zcG9ydDoge1xuICAgICAgICB1cmw6IFwiaHR0cHM6Ly9cIixcbiAgICAgICAgbWFpbkNoYW5uZWw6IFwibWFpblwiLFxuICAgICAgICB0ZXJtaW5hbENoYW5uZWw6IFwidGVybWluYWxcIlxuICAgIH0sXG4gICAgZGlzdHJpYnV0aW9uOiB7XG4gICAgICAgIHJlbGFpYmxlTWVzc2FnZXM6IHtcbiAgICAgICAgICAgIHJldHJpZXM6IDIsXG4gICAgICAgICAgICB3YWl0SW50ZXJ2YWw6IDEwMDBcbiAgICAgICAgfVxuICAgIH1cbn07XG5leHBvcnRzLkNvbmZpZ3VyYXRpb24gPSBDb25maWd1cmF0aW9uO1xuQ29uZmlndXJhdGlvbiA9IE9iamVjdEV4dGVuZGVyXzEuT2JqZWN0RXh0ZW5kZXIuZXh0ZW5kKENvbmZpZ3VyYXRpb24sIHVzZXJDb25maWcpO1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgRXZlbnRUeXBlXzEgPSByZXF1aXJlKFwiLi4vZXZlbnRIdWJzL0V2ZW50VHlwZVwiKTtcbnZhciBEaWN0aW9uYXJ5XzEgPSByZXF1aXJlKFwiLi4vY29sbGVjdGlvbnMvRGljdGlvbmFyeVwiKTtcbnZhciBEaXN0cmlidXRpb25TZXJ2aWNlID0gKGZ1bmN0aW9uICgpIHtcbiAgICBmdW5jdGlvbiBEaXN0cmlidXRpb25TZXJ2aWNlKGFwcCwgY29uZmlnLCBodWIsIGNvbnRhaW5lciwgY2hhbm5lbEZhY3RvcnkpIHtcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcbiAgICAgICAgdGhpcy5hcHAgPSBhcHA7XG4gICAgICAgIHRoaXMuY29uZmlnID0gY29uZmlnO1xuICAgICAgICB0aGlzLmh1YiA9IGh1YjtcbiAgICAgICAgdGhpcy5jb250YWluZXIgPSBjb250YWluZXI7XG4gICAgICAgIHRoaXMuY2hhbm5lbEZhY3RvcnkgPSBjaGFubmVsRmFjdG9yeTtcbiAgICAgICAgdGhpcy5pc0Jyb3dzZXJPbmxpbmUgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5lbnZlbG9wZU1hcCA9IG5ldyBEaWN0aW9uYXJ5XzEuRGljdGlvbmFyeSgpO1xuICAgICAgICB0aGlzLnRyYW5zcG9ydFVybCA9IGNvbmZpZy50cmFuc3BvcnQudXJsO1xuICAgICAgICB0aGlzLmNoYW5uZWxTZXR0aW5ncyA9IHtcbiAgICAgICAgICAgIHNlbmRQcm9taXNlOiB7XG4gICAgICAgICAgICAgICAgcmVqZWN0OiB0aGlzLm9uVHJhbnNwb3J0RmFpbHVyZSxcbiAgICAgICAgICAgICAgICByZXNvbHZlOiB0aGlzLm9uVHJhbnNwb3J0U3VjY2VzcyxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB3YWl0SW50ZXJ2YWw6IGNvbmZpZy5kaXN0cmlidXRpb24ucmVsYWlibGVNZXNzYWdlcy53YWl0SW50ZXJ2YWxcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5pc0Jyb3dzZXJPbmxpbmUgPSBuYXZpZ2F0b3Iub25MaW5lO1xuICAgICAgICB0aGlzLmh1Yi5iaW5kKFtFdmVudFR5cGVfMS5FdmVudFR5cGUub25saW5lLCBFdmVudFR5cGVfMS5FdmVudFR5cGUub2ZmbGluZV0sIGZ1bmN0aW9uICgpIHsgcmV0dXJuIF90aGlzLmlzQnJvd3Nlck9ubGluZSA9IG5hdmlnYXRvci5vbkxpbmU7IH0pO1xuICAgIH1cbiAgICBEaXN0cmlidXRpb25TZXJ2aWNlLnByb3RvdHlwZS5wcm9jZXNzID0gZnVuY3Rpb24gKGRhdGEsIG1ldHJpY3MpIHtcbiAgICAgICAgdmFyIGVudmVsb3BlO1xuICAgICAgICB2YXIgbWVzc2FnZSA9IHsgZGF0YTogZGF0YSB9O1xuICAgICAgICB2YXIgb3V0UmVzdWx0ID0ge307XG4gICAgICAgIGlmICghbWV0cmljcy5yZWxpYWJsZSB8fCAhdGhpcy5lbnZlbG9wZU1hcC50cnlHZXRWYWx1ZShtZXRyaWNzLmlkLCBvdXRSZXN1bHQpKSB7XG4gICAgICAgICAgICBlbnZlbG9wZSA9IHtcbiAgICAgICAgICAgICAgICBtZXNzYWdlOiBtZXNzYWdlLFxuICAgICAgICAgICAgICAgIG1ldHJpY3M6IG1ldHJpY3MsXG4gICAgICAgICAgICAgICAgcmV0cmllczogdGhpcy5jb25maWcuZGlzdHJpYnV0aW9uLnJlbGFpYmxlTWVzc2FnZXMucmV0cmllc1xuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIHRoaXMuZW52ZWxvcGVNYXAuYWRkKG1ldHJpY3MuaWQsIGVudmVsb3BlKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGVudmVsb3BlID0gb3V0UmVzdWx0Lm91dDtcbiAgICAgICAgICAgIGlmICgtLWVudmVsb3BlLnJldHJpZXMgPCAwKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuYXBwLnNodXRkb3duKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5kaXN0cmlidXRlRW52ZWxvcGUoZW52ZWxvcGUpO1xuICAgIH07XG4gICAgRGlzdHJpYnV0aW9uU2VydmljZS5wcm90b3R5cGUuZGlzdHJpYnV0ZUVudmVsb3BlID0gZnVuY3Rpb24gKGVudmVsb3BlKSB7XG4gICAgICAgIGlmICh0aGlzLmlzQnJvd3Nlck9ubGluZSkge1xuICAgICAgICAgICAgdmFyIHVybCA9IHRoaXMudHJhbnNwb3J0VXJsICsgXCI/dD1cIiArIGVudmVsb3BlLm1ldHJpY3MudHlwZTtcbiAgICAgICAgICAgIHZhciBjaGFubmVsID0gdGhpcy5jaGFubmVsRmFjdG9yeS5nZXRDaGFubmVsKHRoaXMuY2hhbm5lbFNldHRpbmdzKTtcbiAgICAgICAgICAgIGNoYW5uZWwuc2VuZCh1cmwsIGVudmVsb3BlKTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgRGlzdHJpYnV0aW9uU2VydmljZS5wcm90b3R5cGUub25UcmFuc3BvcnRTdWNjZXNzID0gZnVuY3Rpb24gKGVudmVsb3BlKSB7XG4gICAgICAgIGVudmVsb3BlLm1ldHJpY3MucHJvbWlzZS5yZXNvbHZlKGVudmVsb3BlLm1ldHJpY3MpO1xuICAgIH07XG4gICAgRGlzdHJpYnV0aW9uU2VydmljZS5wcm90b3R5cGUub25UcmFuc3BvcnRGYWlsdXJlID0gZnVuY3Rpb24gKGVudmVsb3BlKSB7XG4gICAgICAgIGVudmVsb3BlLm1ldHJpY3MucHJvbWlzZS5yZWplY3QoZW52ZWxvcGUubWV0cmljcyk7XG4gICAgfTtcbiAgICByZXR1cm4gRGlzdHJpYnV0aW9uU2VydmljZTtcbn0oKSk7XG5leHBvcnRzLkRpc3RyaWJ1dGlvblNlcnZpY2UgPSBEaXN0cmlidXRpb25TZXJ2aWNlO1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgRXZlbnRUeXBlXzEgPSByZXF1aXJlKFwiLi4vZXZlbnRIdWJzL0V2ZW50VHlwZVwiKTtcbnZhciBEaWN0aW9uYXJ5XzEgPSByZXF1aXJlKFwiLi4vY29sbGVjdGlvbnMvRGljdGlvbmFyeVwiKTtcbnZhciBIdWIgPSAoZnVuY3Rpb24gKCkge1xuICAgIGZ1bmN0aW9uIEh1Yih1c2VyQWdlbnRTZXJ2aWNlKSB7XG4gICAgICAgIHRoaXMudXNlckFnZW50U2VydmljZSA9IHVzZXJBZ2VudFNlcnZpY2U7XG4gICAgICAgIHRoaXMuYmluZGVkUHVibGlzaCA9IHRoaXMucHVibGlzaC5iaW5kKHRoaXMpO1xuICAgICAgICB0aGlzLnN1YnNjcmliZXJzID0gbmV3IERpY3Rpb25hcnlfMS5EaWN0aW9uYXJ5KCk7XG4gICAgICAgIHRoaXMuZG9jdW1lbnRFdmVudHMgPSBbRXZlbnRUeXBlXzEuRXZlbnRUeXBlLm1vdXNlZG93biwgRXZlbnRUeXBlXzEuRXZlbnRUeXBlLm1vdXNlb3ZlciwgRXZlbnRUeXBlXzEuRXZlbnRUeXBlLm1vdXNldXAsIEV2ZW50VHlwZV8xLkV2ZW50VHlwZS5rZXl1cCwgRXZlbnRUeXBlXzEuRXZlbnRUeXBlLnZpc2liaWxpdHljaGFuZ2VdO1xuICAgICAgICB0aGlzLnVzZXJFdmVudHMgPSBbRXZlbnRUeXBlXzEuRXZlbnRUeXBlLm1vdXNlb3ZlciwgRXZlbnRUeXBlXzEuRXZlbnRUeXBlLm1vdXNldXAsIEV2ZW50VHlwZV8xLkV2ZW50VHlwZS5rZXl1cCwgRXZlbnRUeXBlXzEuRXZlbnRUeXBlLnNjcm9sbCwgRXZlbnRUeXBlXzEuRXZlbnRUeXBlLnJlc2l6ZV07XG4gICAgICAgIHRoaXMud2luZG93RXZlbnRzID0gW0V2ZW50VHlwZV8xLkV2ZW50VHlwZS5zY3JvbGwsIEV2ZW50VHlwZV8xLkV2ZW50VHlwZS5yZXNpemUsIEV2ZW50VHlwZV8xLkV2ZW50VHlwZS5vbmxpbmUsIEV2ZW50VHlwZV8xLkV2ZW50VHlwZS5vZmZsaW5lLCBFdmVudFR5cGVfMS5FdmVudFR5cGUuZXJyb3IsIEV2ZW50VHlwZV8xLkV2ZW50VHlwZS5iZWZvcmV1bmxvYWQsIEV2ZW50VHlwZV8xLkV2ZW50VHlwZS51bmxvYWRdO1xuICAgICAgICB0aGlzLmluaXQoKTtcbiAgICB9XG4gICAgSHViLnByb3RvdHlwZS5pbml0ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgICBpZiAodGhpcy51c2VyQWdlbnRTZXJ2aWNlLnVzZXJBZ2VudC5pcy5tb2JpbGUpIHtcbiAgICAgICAgICAgIHRoaXMudXNlckV2ZW50cy5wdXNoKEV2ZW50VHlwZV8xLkV2ZW50VHlwZS50b3VjaHN0YXJ0KTtcbiAgICAgICAgICAgIHRoaXMuZG9jdW1lbnRFdmVudHMucHVzaChFdmVudFR5cGVfMS5FdmVudFR5cGUudG91Y2hzdGFydCk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5kb2N1bWVudEV2ZW50cy5jb25jYXQodGhpcy53aW5kb3dFdmVudHMpLmZvckVhY2goZnVuY3Rpb24gKGV2ZW50VHlwZSkge1xuICAgICAgICAgICAgX3RoaXMuc3Vic2NyaWJlcnNbZXZlbnRUeXBlXSA9IG5ldyBBcnJheSgpO1xuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5iaW5kQnJvd3NlckV2ZW50cygpO1xuICAgIH07XG4gICAgSHViLnByb3RvdHlwZS5iaW5kID0gZnVuY3Rpb24gKGV2ZW50VHlwZXMsIGNhbGxiYWNrKSB7XG4gICAgICAgIHRoaXMuYmluZEludGVybmFsKGV2ZW50VHlwZXMsIGNhbGxiYWNrKTtcbiAgICB9O1xuICAgIEh1Yi5wcm90b3R5cGUudW5iaW5kID0gZnVuY3Rpb24gKGV2ZW50VHlwZXMsIGNhbGxiYWNrKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgIGV2ZW50VHlwZXMuZm9yRWFjaChmdW5jdGlvbiAoZXZlbnRUeXBlKSB7XG4gICAgICAgICAgICBpZiAoX3RoaXMuc3Vic2NyaWJlcnMpIHtcbiAgICAgICAgICAgICAgICB2YXIgbGlzdGVuZXJzID0gX3RoaXMuc3Vic2NyaWJlcnNbZXZlbnRUeXBlXTtcbiAgICAgICAgICAgICAgICB2YXIgaW5kZXggPSBsaXN0ZW5lcnMuaW5kZXhPZihjYWxsYmFjayk7XG4gICAgICAgICAgICAgICAgaWYgKGluZGV4ID4gLTEpIHtcbiAgICAgICAgICAgICAgICAgICAgbGlzdGVuZXJzLnNwbGljZShpbmRleCwgMSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9O1xuICAgIEh1Yi5wcm90b3R5cGUuYmluZFRvcCA9IGZ1bmN0aW9uIChldmVudFR5cGVzLCBjYWxsYmFjaykge1xuICAgICAgICB0aGlzLmJpbmRJbnRlcm5hbChldmVudFR5cGVzLCBjYWxsYmFjaywgdHJ1ZSk7XG4gICAgfTtcbiAgICBIdWIucHJvdG90eXBlLmJpbmRJbnRlcm5hbCA9IGZ1bmN0aW9uIChldmVudFR5cGVzLCBjYWxsYmFjaywgdG9wKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgIGlmICh0b3AgPT09IHZvaWQgMCkgeyB0b3AgPSBmYWxzZTsgfVxuICAgICAgICB2YXIgaW5zZXJ0Rm4gPSB0b3AgPyBmdW5jdGlvbiAoc3VicykgeyByZXR1cm4gc3Vicy5zcGxpY2UoMCwgMCwgY2FsbGJhY2spOyB9IDogZnVuY3Rpb24gKHN1YnMpIHsgcmV0dXJuIHN1YnMucHVzaChjYWxsYmFjayk7IH07XG4gICAgICAgIGV2ZW50VHlwZXMuZm9yRWFjaChmdW5jdGlvbiAoZXZlbnRUeXBlKSB7IHJldHVybiBpbnNlcnRGbihfdGhpcy5zdWJzY3JpYmVyc1tldmVudFR5cGVdKTsgfSk7XG4gICAgfTtcbiAgICBIdWIucHJvdG90eXBlLnVuYmluZEFsbCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5zdWJzY3JpYmVycyA9IG51bGw7XG4gICAgfTtcbiAgICBIdWIucHJvdG90eXBlLnB1Ymxpc2ggPSBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICAgICAgdmFyIGV2ZW50VHlwZSA9IEV2ZW50VHlwZV8xLkV2ZW50VHlwZVtldmVudC50eXBlXTtcbiAgICAgICAgdGhpcy5zdWJzY3JpYmVyc1tldmVudFR5cGVdLmZvckVhY2goZnVuY3Rpb24gKGNhbGxiYWNrKSB7IHJldHVybiBjYWxsYmFjayhldmVudCk7IH0pO1xuICAgIH07XG4gICAgSHViLnByb3RvdHlwZS5kaXNwb3NlID0gZnVuY3Rpb24gKHNodXRkb3duKSB7XG4gICAgICAgIHRoaXMudW5iaW5kQWxsKCk7XG4gICAgICAgIHRoaXMudW5iaW5kQnJvd3NlckV2ZW50cygpO1xuICAgIH07XG4gICAgSHViLnByb3RvdHlwZS5iaW5kQnJvd3NlckV2ZW50cyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIGFkZEV2ZW50TGlzdGVuZXJGYWN0b3J5ID0gZnVuY3Rpb24gKGV2ZW50TGlzdGVuZXJSZWdpc3RyYXRvcikge1xuICAgICAgICAgICAgcmV0dXJuIGV2ZW50TGlzdGVuZXJSZWdpc3RyYXRvci5hZGRFdmVudExpc3RlbmVyO1xuICAgICAgICB9O1xuICAgICAgICB0aGlzLmJpbmRVbmJpbmRCcm93c2VyRXZlbnQoYWRkRXZlbnRMaXN0ZW5lckZhY3RvcnksIHdpbmRvdywgdGhpcy53aW5kb3dFdmVudHMsIHRoaXMuYmluZGVkUHVibGlzaCk7XG4gICAgICAgIHRoaXMuYmluZFVuYmluZEJyb3dzZXJFdmVudChhZGRFdmVudExpc3RlbmVyRmFjdG9yeSwgZG9jdW1lbnQsIHRoaXMuZG9jdW1lbnRFdmVudHMsIHRoaXMuYmluZGVkUHVibGlzaCk7XG4gICAgfTtcbiAgICBIdWIucHJvdG90eXBlLnVuYmluZEJyb3dzZXJFdmVudHMgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciByZW1vdmVFdmVudExpc3RlbmVyRmFjdG9yeSA9IGZ1bmN0aW9uIChldmVudExpc3RlbmVyUmVnaXN0cmF0b3IpIHtcbiAgICAgICAgICAgIHJldHVybiBldmVudExpc3RlbmVyUmVnaXN0cmF0b3IucmVtb3ZlRXZlbnRMaXN0ZW5lcjtcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5iaW5kVW5iaW5kQnJvd3NlckV2ZW50KHJlbW92ZUV2ZW50TGlzdGVuZXJGYWN0b3J5LCB3aW5kb3csIHRoaXMud2luZG93RXZlbnRzLCB0aGlzLmJpbmRlZFB1Ymxpc2gpO1xuICAgICAgICB0aGlzLmJpbmRVbmJpbmRCcm93c2VyRXZlbnQocmVtb3ZlRXZlbnRMaXN0ZW5lckZhY3RvcnksIGRvY3VtZW50LCB0aGlzLmRvY3VtZW50RXZlbnRzLCB0aGlzLmJpbmRlZFB1Ymxpc2gpO1xuICAgIH07XG4gICAgSHViLnByb3RvdHlwZS5iaW5kVW5iaW5kQnJvd3NlckV2ZW50ID0gZnVuY3Rpb24gKGZhY3RvcnksIHJlZ2lzdHJhdG9yLCBldmVudFR5cGVzLCBldmVudExpc3RlbmVyKSB7XG4gICAgICAgIGV2ZW50VHlwZXMuZm9yRWFjaChmdW5jdGlvbiAoZXZlbnRUeXBlKSB7XG4gICAgICAgICAgICB2YXIgZXZlbnQgPSBFdmVudFR5cGVfMS5FdmVudFR5cGVbZXZlbnRUeXBlXTtcbiAgICAgICAgICAgIHZhciBldmVudExpc3RlbmVyRGVmaW5pdGlvbiA9IGZhY3RvcnkocmVnaXN0cmF0b3IpO1xuICAgICAgICAgICAgZXZlbnRMaXN0ZW5lckRlZmluaXRpb24uYXBwbHkocmVnaXN0cmF0b3IsIFtldmVudCwgZXZlbnRMaXN0ZW5lciwgZmFsc2VdKTtcbiAgICAgICAgfSk7XG4gICAgfTtcbiAgICByZXR1cm4gSHViO1xufSgpKTtcbmV4cG9ydHMuSHViID0gSHViO1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgU2VydmljZUtleV8xID0gcmVxdWlyZShcIi4vU2VydmljZUtleVwiKTtcbnZhciBEaWN0aW9uYXJ5XzEgPSByZXF1aXJlKFwiLi4vY29sbGVjdGlvbnMvRGljdGlvbmFyeVwiKTtcbnZhciBHZW5lcmljU2VydmljZUVudHJ5XzEgPSByZXF1aXJlKFwiLi9HZW5lcmljU2VydmljZUVudHJ5XCIpO1xudmFyIENvbnRhaW5lciA9IChmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gQ29udGFpbmVyKCkge1xuICAgICAgICB0aGlzLmRlZmF1bHRPd25lciA9IDAgLyogY29udGFpbmVyICovO1xuICAgICAgICB0aGlzLmRlZmF1bHRSZXVzZSA9IDAgLyogY29udGFpbmVyICovO1xuICAgICAgICB0aGlzLmRpc3Bvc2FibGVzID0gbmV3IEFycmF5KCk7XG4gICAgICAgIHRoaXMuc2VydmljZXMgPSBuZXcgRGljdGlvbmFyeV8xLkRpY3Rpb25hcnkoKTtcbiAgICAgICAgdmFyIHNlcnZpY2VFbnRyeSA9IEdlbmVyaWNTZXJ2aWNlRW50cnlfMS5HZW5lcmljU2VydmljZUVudHJ5LmJ1aWxkKHtcbiAgICAgICAgICAgIGluc3RhbmNlOiB0aGlzLFxuICAgICAgICAgICAgZmFjdG9yeTogZnVuY3Rpb24gKGMpIHsgcmV0dXJuIGM7IH0sXG4gICAgICAgICAgICBjb250YWluZXI6IHRoaXMsXG4gICAgICAgICAgICBvd25lcjogMSAvKiBleHRlcm5hbCAqLyxcbiAgICAgICAgICAgIHJldXNlOiAwIC8qIGNvbnRhaW5lciAqL1xuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5zZXJ2aWNlcy5hZGQobmV3IFNlcnZpY2VLZXlfMS5TZXJ2aWNlS2V5KENvbnRhaW5lciksIHNlcnZpY2VFbnRyeSk7XG4gICAgfVxuICAgIENvbnRhaW5lci5wcm90b3R5cGUuZGlzcG9zZSA9IGZ1bmN0aW9uIChzaHV0ZG93bikge1xuICAgICAgICB3aGlsZSAodGhpcy5kaXNwb3NhYmxlcy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICB2YXIgZGlzcG9zYWJsZSA9IHRoaXMuZGlzcG9zYWJsZXMuc2hpZnQoKTtcbiAgICAgICAgICAgIGRpc3Bvc2FibGUuZGlzcG9zZShzaHV0ZG93bik7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIENvbnRhaW5lci5wcm90b3R5cGUucmVnaXN0ZXIgPSBmdW5jdGlvbiAoY3RvciwgZmFjdG9yeSkge1xuICAgICAgICByZXR1cm4gdGhpcy5yZWdpc3Rlck5hbWVkKGN0b3IsIG51bGwsIGZhY3RvcnkpO1xuICAgIH07XG4gICAgQ29udGFpbmVyLnByb3RvdHlwZS5yZWdpc3Rlckluc3RhbmNlID0gZnVuY3Rpb24gKGluc3RhbmNlKSB7XG4gICAgICAgIHRoaXMucmVnaXN0ZXJOYW1lZEluc3RhbmNlKG51bGwsIGluc3RhbmNlKTtcbiAgICB9O1xuICAgIENvbnRhaW5lci5wcm90b3R5cGUucmVnaXN0ZXJOYW1lZEluc3RhbmNlID0gZnVuY3Rpb24gKG5hbWUsIGluc3RhbmNlKSB7XG4gICAgICAgIHZhciBwcm90byA9IE9iamVjdC5nZXRQcm90b3R5cGVPZihpbnN0YW5jZSk7XG4gICAgICAgIHZhciBjdG9yID0gcHJvdG8uY29uc3RydWN0b3I7XG4gICAgICAgIHZhciBlbnRyeSA9IHRoaXMucmVnaXN0ZXJJbXBsKGN0b3IsIG5hbWUsIG51bGwpO1xuICAgICAgICBlbnRyeS5hc1NpbmdsZXRvbigpXG4gICAgICAgICAgICAub3duZWRFeHRlcm5hbGx5KCk7XG4gICAgICAgIGVudHJ5LmluaXRpYWxpemVJbnN0YW5jZShpbnN0YW5jZSk7XG4gICAgfTtcbiAgICBDb250YWluZXIucHJvdG90eXBlLnJlZ2lzdGVyTmFtZWQgPSBmdW5jdGlvbiAoY3RvciwgbmFtZSwgZmFjdG9yeSkge1xuICAgICAgICByZXR1cm4gdGhpcy5yZWdpc3RlckltcGwoY3RvciwgbmFtZSwgZmFjdG9yeSk7XG4gICAgfTtcbiAgICBDb250YWluZXIucHJvdG90eXBlLnJlZ2lzdGVySW1wbCA9IGZ1bmN0aW9uIChjdG9yLCBuYW1lLCBmYWN0b3J5KSB7XG4gICAgICAgIHZhciBrZXkgPSBuZXcgU2VydmljZUtleV8xLlNlcnZpY2VLZXkoY3RvciwgbmFtZSk7XG4gICAgICAgIHZhciBlbnRyeSA9IEdlbmVyaWNTZXJ2aWNlRW50cnlfMS5HZW5lcmljU2VydmljZUVudHJ5LmJ1aWxkKHtcbiAgICAgICAgICAgIGNvbnRhaW5lcjogdGhpcyxcbiAgICAgICAgICAgIGZhY3Rvcnk6IGZhY3RvcnksXG4gICAgICAgICAgICByZXVzZTogdGhpcy5kZWZhdWx0UmV1c2UsXG4gICAgICAgICAgICBvd25lcjogdGhpcy5kZWZhdWx0T3duZXJcbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMuc2VydmljZXMuYWRkKGtleSwgZW50cnkpO1xuICAgICAgICByZXR1cm4gZW50cnk7XG4gICAgfTtcbiAgICBDb250YWluZXIucHJvdG90eXBlLnJlc29sdmUgPSBmdW5jdGlvbiAoY3RvciwgYXJnMSwgYXJnMiwgYXJnMywgYXJnNCkge1xuICAgICAgICB2YXIgYXJncyA9IFtjdG9yLCBudWxsLCBhcmcxLCBhcmcyLCBhcmczLCBhcmc0XTtcbiAgICAgICAgcmV0dXJuIHRoaXMucmVzb2x2ZU5hbWVkLmFwcGx5KHRoaXMsIGFyZ3MpO1xuICAgIH07XG4gICAgQ29udGFpbmVyLnByb3RvdHlwZS5yZXNvbHZlTmFtZWQgPSBmdW5jdGlvbiAoY3RvciwgbmFtZSwgYXJnMSwgYXJnLCBhcmczLCBhcmc0KSB7XG4gICAgICAgIHZhciBhcmdzID0gQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzLCAyKTtcbiAgICAgICAgcmV0dXJuIHRoaXMucmVzb2x2ZUltcGwoY3RvciwgbmFtZSwgYXJncyk7XG4gICAgfTtcbiAgICBDb250YWluZXIucHJvdG90eXBlLnJlc29sdmVGYWN0b3J5ID0gZnVuY3Rpb24gKGN0b3IpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucmVzb2x2ZU5hbWVkRmFjdG9yeShjdG9yLCBudWxsKTtcbiAgICB9O1xuICAgIENvbnRhaW5lci5wcm90b3R5cGUucmVzb2x2ZU5hbWVkRmFjdG9yeSA9IGZ1bmN0aW9uIChjdG9yLCBuYW1lKSB7XG4gICAgICAgIHZhciBpbnN0YW5jZTtcbiAgICAgICAgdmFyIGVudHJ5ID0gdGhpcy5nZXRFbnRyeShjdG9yLCBuYW1lKTtcbiAgICAgICAgaWYgKCFlbnRyeSkge1xuICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uICgpIHsgcmV0dXJuIG51bGw7IH07XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIChhcmcxLCBhcmcyLCBhcmczLCBhcmc0KSB7XG4gICAgICAgICAgICB2YXIgYXJncyA9IFtlbnRyeS5jb250YWluZXIsIGFyZzEsIGFyZzIsIGFyZzMsIGFyZzRdO1xuICAgICAgICAgICAgaW5zdGFuY2UgPSBlbnRyeS5pbnN0YW5jZTtcbiAgICAgICAgICAgIGlmICghaW5zdGFuY2UpIHtcbiAgICAgICAgICAgICAgICBpbnN0YW5jZSA9IGVudHJ5LmZhY3RvcnkuYXBwbHkobnVsbCwgYXJncyk7XG4gICAgICAgICAgICAgICAgZW50cnkuaW5pdGlhbGl6ZUluc3RhbmNlKGluc3RhbmNlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBpbnN0YW5jZTtcbiAgICAgICAgfTtcbiAgICB9O1xuICAgIENvbnRhaW5lci5wcm90b3R5cGUucmVzb2x2ZUltcGwgPSBmdW5jdGlvbiAoY3RvciwgbmFtZSwgYXJncykge1xuICAgICAgICB2YXIgaW5zdGFuY2U7XG4gICAgICAgIHZhciBlbnRyeSA9IHRoaXMuZ2V0RW50cnkoY3RvciwgbmFtZSk7XG4gICAgICAgIGlmICghZW50cnkpIHtcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9XG4gICAgICAgIGluc3RhbmNlID0gZW50cnkuaW5zdGFuY2U7XG4gICAgICAgIGlmICghaW5zdGFuY2UpIHtcbiAgICAgICAgICAgIGFyZ3MgPSBhcmdzIHx8IFtdO1xuICAgICAgICAgICAgYXJncy5zcGxpY2UoMCwgMCwgZW50cnkuY29udGFpbmVyKTtcbiAgICAgICAgICAgIGluc3RhbmNlID0gZW50cnkuZmFjdG9yeS5hcHBseShudWxsLCBhcmdzKTtcbiAgICAgICAgICAgIGVudHJ5LmluaXRpYWxpemVJbnN0YW5jZShpbnN0YW5jZSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGluc3RhbmNlO1xuICAgIH07XG4gICAgQ29udGFpbmVyLnByb3RvdHlwZS5nZXRFbnRyeSA9IGZ1bmN0aW9uIChjdG9yLCBzZXJ2aWNlTmFtZSkge1xuICAgICAgICB2YXIgY29udGFpbmVyID0gdGhpcztcbiAgICAgICAgdmFyIGVudHJ5O1xuICAgICAgICB2YXIga2V5ID0gbmV3IFNlcnZpY2VLZXlfMS5TZXJ2aWNlS2V5KGN0b3IsIHNlcnZpY2VOYW1lKTtcbiAgICAgICAgdmFyIG91dFJlc3VsdCA9IHt9O1xuICAgICAgICBpZiAodGhpcy5zZXJ2aWNlcy50cnlHZXRWYWx1ZShrZXksIG91dFJlc3VsdCkpIHtcbiAgICAgICAgICAgIGVudHJ5ID0gb3V0UmVzdWx0Lm91dDtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZW50cnk7XG4gICAgfTtcbiAgICBDb250YWluZXIucHJvdG90eXBlLnRyYWNrRGlzcG9zYWJsZSA9IGZ1bmN0aW9uIChpbnN0YW5jZSkge1xuICAgICAgICB0aGlzLmRpc3Bvc2FibGVzLnB1c2goaW5zdGFuY2UpO1xuICAgIH07XG4gICAgcmV0dXJuIENvbnRhaW5lcjtcbn0oKSk7XG5leHBvcnRzLkNvbnRhaW5lciA9IENvbnRhaW5lcjtcbiIsIlwidXNlIHN0cmljdFwiO1xudmFyIF9fZXh0ZW5kcyA9ICh0aGlzICYmIHRoaXMuX19leHRlbmRzKSB8fCBmdW5jdGlvbiAoZCwgYikge1xuICAgIGZvciAodmFyIHAgaW4gYikgaWYgKGIuaGFzT3duUHJvcGVydHkocCkpIGRbcF0gPSBiW3BdO1xuICAgIGZ1bmN0aW9uIF9fKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gZDsgfVxuICAgIGQucHJvdG90eXBlID0gYiA9PT0gbnVsbCA/IE9iamVjdC5jcmVhdGUoYikgOiAoX18ucHJvdG90eXBlID0gYi5wcm90b3R5cGUsIG5ldyBfXygpKTtcbn07XG52YXIgU2VydmljZUVudHJ5XzEgPSByZXF1aXJlKFwiLi9TZXJ2aWNlRW50cnlcIik7XG52YXIgR2VuZXJpY1NlcnZpY2VFbnRyeSA9IChmdW5jdGlvbiAoX3N1cGVyKSB7XG4gICAgX19leHRlbmRzKEdlbmVyaWNTZXJ2aWNlRW50cnksIF9zdXBlcik7XG4gICAgZnVuY3Rpb24gR2VuZXJpY1NlcnZpY2VFbnRyeShmYWN0b3J5KSB7XG4gICAgICAgIF9zdXBlci5jYWxsKHRoaXMpO1xuICAgICAgICB0aGlzLmZhY3RvcnkgPSBmYWN0b3J5O1xuICAgIH1cbiAgICBHZW5lcmljU2VydmljZUVudHJ5LnByb3RvdHlwZS5pbml0aWFsaXplSW5zdGFuY2UgPSBmdW5jdGlvbiAoaW5zdGFuY2UpIHtcbiAgICAgICAgdmFyIGR5bmFtaWNJbnN0YW5jZSA9IGluc3RhbmNlO1xuICAgICAgICBpZiAodGhpcy5yZXVzZSAhPT0gMSAvKiBub25lICovKSB7XG4gICAgICAgICAgICB0aGlzLmluc3RhbmNlID0gaW5zdGFuY2U7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMub3duZXIgPT09IDAgLyogY29udGFpbmVyICovICYmIGR5bmFtaWNJbnN0YW5jZS5kaXNwb3NlKSB7XG4gICAgICAgICAgICB0aGlzLmNvbnRhaW5lci50cmFja0Rpc3Bvc2FibGUoZHluYW1pY0luc3RhbmNlKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5pbml0aWFsaXplcikge1xuICAgICAgICAgICAgdGhpcy5pbml0aWFsaXplcih0aGlzLmNvbnRhaW5lciwgaW5zdGFuY2UpO1xuICAgICAgICB9XG4gICAgfTtcbiAgICBHZW5lcmljU2VydmljZUVudHJ5LnByb3RvdHlwZS5pbml0aWFsaXplZEJ5ID0gZnVuY3Rpb24gKGluaXRpYWxpemVyKSB7XG4gICAgICAgIHRoaXMuaW5pdGlhbGl6ZXIgPSBpbml0aWFsaXplcjtcbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfTtcbiAgICBHZW5lcmljU2VydmljZUVudHJ5LnByb3RvdHlwZS5jbG9uZUZvciA9IGZ1bmN0aW9uIChuZXdDb250YWluZXIpIHtcbiAgICAgICAgcmV0dXJuIEdlbmVyaWNTZXJ2aWNlRW50cnkuYnVpbGQoe1xuICAgICAgICAgICAgcmV1c2U6IHRoaXMucmV1c2UsXG4gICAgICAgICAgICBvd25lcjogdGhpcy5vd25lcixcbiAgICAgICAgICAgIGZhY3Rvcnk6IHRoaXMuZmFjdG9yeSxcbiAgICAgICAgICAgIGNvbnRhaW5lcjogbmV3Q29udGFpbmVyLFxuICAgICAgICAgICAgaW5pdGlhbGl6ZXI6IHRoaXMuaW5pdGlhbGl6ZXJcbiAgICAgICAgfSk7XG4gICAgfTtcbiAgICBHZW5lcmljU2VydmljZUVudHJ5LmJ1aWxkID0gZnVuY3Rpb24gKGJhZykge1xuICAgICAgICB2YXIgc2VydmljZUVudHJ5ID0gbmV3IEdlbmVyaWNTZXJ2aWNlRW50cnkoYmFnLmZhY3RvcnkpO1xuICAgICAgICBzZXJ2aWNlRW50cnkub3duZXIgPSBiYWcub3duZXI7XG4gICAgICAgIHNlcnZpY2VFbnRyeS5yZXVzZSA9IGJhZy5yZXVzZTtcbiAgICAgICAgc2VydmljZUVudHJ5Lmluc3RhbmNlID0gYmFnLmluc3RhbmNlO1xuICAgICAgICBzZXJ2aWNlRW50cnkuY29udGFpbmVyID0gYmFnLmNvbnRhaW5lcjtcbiAgICAgICAgc2VydmljZUVudHJ5LmluaXRpYWxpemVyID0gYmFnLmluaXRpYWxpemVyO1xuICAgICAgICByZXR1cm4gc2VydmljZUVudHJ5O1xuICAgIH07XG4gICAgcmV0dXJuIEdlbmVyaWNTZXJ2aWNlRW50cnk7XG59KFNlcnZpY2VFbnRyeV8xLlNlcnZpY2VFbnRyeSkpO1xuZXhwb3J0cy5HZW5lcmljU2VydmljZUVudHJ5ID0gR2VuZXJpY1NlcnZpY2VFbnRyeTtcbiIsIlwidXNlIHN0cmljdFwiO1xudmFyIE5hbWVSZXNvbHZlciA9IChmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gTmFtZVJlc29sdmVyKCkge1xuICAgIH1cbiAgICBOYW1lUmVzb2x2ZXIucmVzb2x2ZSA9IGZ1bmN0aW9uIChjdG9yKSB7XG4gICAgICAgIHZhciBmdW5jID0gY3RvcjtcbiAgICAgICAgaWYgKHR5cGVvZiBjdG9yID09PSBcInN0cmluZ1wiKSB7XG4gICAgICAgICAgICByZXR1cm4gY3RvcjtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZnVuYy5uYW1lIHx8IE5hbWVSZXNvbHZlci5yZXNvbHZlQnlDb2RlKGZ1bmMpO1xuICAgIH07XG4gICAgTmFtZVJlc29sdmVyLnJlc29sdmVCeUNvZGUgPSBmdW5jdGlvbiAoY3Rvcikge1xuICAgICAgICB2YXIgbWF0Y2ggPSBjdG9yLnRvU3RyaW5nKCkubWF0Y2goTmFtZVJlc29sdmVyLm5hbWVSZWdleCk7XG4gICAgICAgIHJldHVybiAobWF0Y2ggJiYgbWF0Y2gubGVuZ3RoID4gMCAmJiBtYXRjaFsxXSkgfHwgTmFtZVJlc29sdmVyLnJlc29sdmVCeVByb3RvdHlwZShjdG9yKTtcbiAgICB9O1xuICAgIE5hbWVSZXNvbHZlci5yZXNvbHZlQnlQcm90b3R5cGUgPSBmdW5jdGlvbiAoY3Rvcikge1xuICAgICAgICB2YXIgYnVmZmVyID0gbmV3IEFycmF5KCk7XG4gICAgICAgIHZhciBwcm90b3R5cGUgPSBjdG9yLnByb3RvdHlwZTtcbiAgICAgICAgZm9yICh2YXIgaXRlbSBpbiBwcm90b3R5cGUpIHtcbiAgICAgICAgICAgIGJ1ZmZlci5wdXNoKGl0ZW0pO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBidWZmZXIuam9pbihcIlwiKTtcbiAgICB9O1xuICAgIE5hbWVSZXNvbHZlci5uYW1lUmVnZXggPSAvZnVuY3Rpb24gKFteXFwoXSspLztcbiAgICByZXR1cm4gTmFtZVJlc29sdmVyO1xufSgpKTtcbmV4cG9ydHMuTmFtZVJlc29sdmVyID0gTmFtZVJlc29sdmVyO1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgU2VydmljZUVudHJ5ID0gKGZ1bmN0aW9uICgpIHtcbiAgICBmdW5jdGlvbiBTZXJ2aWNlRW50cnkoKSB7XG4gICAgfVxuICAgIFNlcnZpY2VFbnRyeS5wcm90b3R5cGUub3duZWRCeUNvbnRhaW5lciA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5vd25lciA9IDAgLyogY29udGFpbmVyICovO1xuICAgIH07XG4gICAgU2VydmljZUVudHJ5LnByb3RvdHlwZS5vd25lZEV4dGVybmFsbHkgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMub3duZXIgPSAxIC8qIGV4dGVybmFsICovO1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9O1xuICAgIFNlcnZpY2VFbnRyeS5wcm90b3R5cGUuYXNTaW5nbGV0b24gPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMucmV1c2UgPSAwIC8qIGNvbnRhaW5lciAqLztcbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfTtcbiAgICBTZXJ2aWNlRW50cnkucHJvdG90eXBlLmFzVHJhbnNpZW50ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLnJldXNlID0gMSAvKiBub25lICovO1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9O1xuICAgIHJldHVybiBTZXJ2aWNlRW50cnk7XG59KCkpO1xuZXhwb3J0cy5TZXJ2aWNlRW50cnkgPSBTZXJ2aWNlRW50cnk7XG4iLCJcInVzZSBzdHJpY3RcIjtcbnZhciBOYW1lUmVzb2x2ZXJfMSA9IHJlcXVpcmUoXCIuL05hbWVSZXNvbHZlclwiKTtcbnZhciBTZXJ2aWNlS2V5ID0gKGZ1bmN0aW9uICgpIHtcbiAgICBmdW5jdGlvbiBTZXJ2aWNlS2V5KGN0b3IsIHNlcnZpY2VOYW1lKSB7XG4gICAgICAgIHRoaXMuY3RvciA9IGN0b3I7XG4gICAgICAgIHRoaXMuc2VydmljZU5hbWUgPSBzZXJ2aWNlTmFtZTtcbiAgICAgICAgdGhpcy5rZXkgPSBzZXJ2aWNlTmFtZSB8fCBOYW1lUmVzb2x2ZXJfMS5OYW1lUmVzb2x2ZXIucmVzb2x2ZShjdG9yKTtcbiAgICB9XG4gICAgU2VydmljZUtleS5wcm90b3R5cGUudG9TdHJpbmcgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmtleTtcbiAgICB9O1xuICAgIHJldHVybiBTZXJ2aWNlS2V5O1xufSgpKTtcbmV4cG9ydHMuU2VydmljZUtleSA9IFNlcnZpY2VLZXk7XG4iLCJcInVzZSBzdHJpY3RcIjtcbnZhciBNZXRyaWNUeXBlXzEgPSByZXF1aXJlKFwiLi4vbWV0cmljcy9NZXRyaWNUeXBlXCIpO1xudmFyIEpTT05TZXJpYWxpemVyID0gKGZ1bmN0aW9uICgpIHtcbiAgICBmdW5jdGlvbiBKU09OU2VyaWFsaXplcigpIHtcbiAgICB9XG4gICAgSlNPTlNlcmlhbGl6ZXIucHJvdG90eXBlLnNlcmlhbGl6ZSA9IGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgICAgICB2YXIgcmVzdWx0ID0ge307XG4gICAgICAgIHZhbHVlLmZvckVhY2goZnVuY3Rpb24gKG1ldHJpYykgeyByZXR1cm4gcmVzdWx0W01ldHJpY1R5cGVfMS5NZXRyaWNUeXBlW21ldHJpYy50eXBlXV0gPSBtZXRyaWMudmFsdWU7IH0pO1xuICAgICAgICByZXR1cm4gSlNPTi5zdHJpbmdpZnkocmVzdWx0KTtcbiAgICB9O1xuICAgIHJldHVybiBKU09OU2VyaWFsaXplcjtcbn0oKSk7XG5leHBvcnRzLkpTT05TZXJpYWxpemVyID0gSlNPTlNlcmlhbGl6ZXI7XG4iLCJcInVzZSBzdHJpY3RcIjtcbnZhciBRdWVyeVN0cmluZ1NlcmlhbGl6ZXIgPSAoZnVuY3Rpb24gKCkge1xuICAgIGZ1bmN0aW9uIFF1ZXJ5U3RyaW5nU2VyaWFsaXplcigpIHtcbiAgICB9XG4gICAgUXVlcnlTdHJpbmdTZXJpYWxpemVyLnByb3RvdHlwZS5zZXJpYWxpemUgPSBmdW5jdGlvbiAodmFsdWUpIHtcbiAgICAgICAgdmFyIGJ1aWxkZXIgPSBbXTtcbiAgICAgICAgdmFsdWUuZm9yRWFjaChmdW5jdGlvbiAoaXRlbSkge1xuICAgICAgICAgICAgYnVpbGRlci5wdXNoKGl0ZW0udHlwZSArIFwiPVwiICsgZW5jb2RlVVJJQ29tcG9uZW50KGl0ZW0udmFsdWUpKTtcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiBidWlsZGVyLmpvaW4oXCImXCIpO1xuICAgIH07XG4gICAgcmV0dXJuIFF1ZXJ5U3RyaW5nU2VyaWFsaXplcjtcbn0oKSk7XG5leHBvcnRzLlF1ZXJ5U3RyaW5nU2VyaWFsaXplciA9IFF1ZXJ5U3RyaW5nU2VyaWFsaXplcjtcbiIsIlwidXNlIHN0cmljdFwiO1xudmFyIEFic3RyYWN0QWN0aXZpdHlNZXRyaWMgPSAoZnVuY3Rpb24gKCkge1xuICAgIGZ1bmN0aW9uIEFic3RyYWN0QWN0aXZpdHlNZXRyaWModGltaW5nKSB7XG4gICAgICAgIHRoaXMuaXNMYXN0ID0gZmFsc2U7XG4gICAgICAgIHRoaXMub25lVGltZSA9IGZhbHNlO1xuICAgICAgICB0aGlzLmluYWN0aXZpdHlEZXRlY3RlZFRpbWUgPSAwO1xuICAgICAgICB0aGlzLmluYWN0aXZpdHlEZXRlY3RlZCA9IGZhbHNlO1xuICAgICAgICB0aGlzLmluYWN0aXZpdHlBZ2dyZWdhdGVkVGltZSA9IDA7XG4gICAgICAgIHRoaXMubmF2aWdhdGlvblN0YXJ0ID0gdGltaW5nLm5hdmlnYXRpb25TdGFydDtcbiAgICB9XG4gICAgLyoqXG4gICAgKiAgSW4gY2FzZSB0aGVyZSBhcmUgcHJlY2VkaW5nIGNhbGxzIHRvIGdldE1ldHJpYygpIGR1cmluZyB0aGUgaW5hY3Rpdml0eSBwZXJpb2QsXG4gICAgKiAgdGhpcyBmdW5jdGlvbiB3aWxsIGJlIGNhbGxlZCBhbmQgdGhlIGluYWN0aXZpdHlEZXRlY3RlZCBmbGFnIHdpbGwgcmVtYWluIHRydWUuXG4gICAgKiAgSW4gb3JkZXIgdG8gYXZvaWQgb3ZlcmxhcHBpbmcgdGltZSBhY2N1bXVsYXRpb25zIHdlIGhhdmUgdG8gdGFrZSB0aGUgdGltZSBkaWZmZXJlbmNlXG4gICAgKiAgYmV0d2VlbiB0aGUgY3VycmVudCBjYWxsIGFuZCB0aGUgcHJldmlvdXMgb25lLCBieSBzZXR0aW5nIHRoZSBpbmFjdGl2aXR5RGV0ZWN0ZWRUaW1lXG4gICAgKiAgdG8gY3VycmVudCB0aW1lLlxuICAgICovXG4gICAgQWJzdHJhY3RBY3Rpdml0eU1ldHJpYy5wcm90b3R5cGUudHJ5QWNjdW11bGF0ZUluYWN0aXZpdHlUaW1lID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgbm93ID0gRGF0ZS5ub3coKTtcbiAgICAgICAgaWYgKHRoaXMuaW5hY3Rpdml0eURldGVjdGVkKSB7XG4gICAgICAgICAgICB0aGlzLmluYWN0aXZpdHlBZ2dyZWdhdGVkVGltZSArPSBub3cgLSB0aGlzLmluYWN0aXZpdHlEZXRlY3RlZFRpbWU7XG4gICAgICAgICAgICB0aGlzLmluYWN0aXZpdHlEZXRlY3RlZFRpbWUgPSBub3c7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIEFic3RyYWN0QWN0aXZpdHlNZXRyaWMucHJvdG90eXBlLm1hcmtBY3Rpdml0eSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy50cnlBY2N1bXVsYXRlSW5hY3Rpdml0eVRpbWUoKTtcbiAgICAgICAgdGhpcy5pbmFjdGl2aXR5RGV0ZWN0ZWQgPSBmYWxzZTtcbiAgICB9O1xuICAgIEFic3RyYWN0QWN0aXZpdHlNZXRyaWMucHJvdG90eXBlLm1hcmtJbmFjdGl2aXR5ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLmluYWN0aXZpdHlEZXRlY3RlZCA9IHRydWU7XG4gICAgICAgIHRoaXMuaW5hY3Rpdml0eURldGVjdGVkVGltZSA9IERhdGUubm93KCk7XG4gICAgfTtcbiAgICBBYnN0cmFjdEFjdGl2aXR5TWV0cmljLnByb3RvdHlwZS5nZXRNZXRyaWMgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMudHJ5QWNjdW11bGF0ZUluYWN0aXZpdHlUaW1lKCk7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICB0eXBlOiB0aGlzLmdldE1ldHJpY1R5cGUoKSxcbiAgICAgICAgICAgIHZhbHVlOiBEYXRlLm5vdygpIC0gdGhpcy5uYXZpZ2F0aW9uU3RhcnQgLSB0aGlzLmluYWN0aXZpdHlBZ2dyZWdhdGVkVGltZVxuICAgICAgICB9O1xuICAgIH07XG4gICAgcmV0dXJuIEFic3RyYWN0QWN0aXZpdHlNZXRyaWM7XG59KCkpO1xuZXhwb3J0cy5BYnN0cmFjdEFjdGl2aXR5TWV0cmljID0gQWJzdHJhY3RBY3Rpdml0eU1ldHJpYztcbiIsIlwidXNlIHN0cmljdFwiO1xudmFyIEFic3RyYWN0RXZlbnRSdWxlID0gKGZ1bmN0aW9uICgpIHtcbiAgICBmdW5jdGlvbiBBYnN0cmFjdEV2ZW50UnVsZSgpIHtcbiAgICB9XG4gICAgQWJzdHJhY3RFdmVudFJ1bGUucHJvdG90eXBlLnJlZ2lzdGVyTm90aWZpY2F0aW9uID0gZnVuY3Rpb24gKGNhbGxiYWNrKSB7XG4gICAgICAgIHRoaXMuY2FsbGJhY2sgPSBjYWxsYmFjaztcbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfTtcbiAgICBBYnN0cmFjdEV2ZW50UnVsZS5wcm90b3R5cGUubm90aWZ5ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLmNhbGxiYWNrKCk7XG4gICAgfTtcbiAgICByZXR1cm4gQWJzdHJhY3RFdmVudFJ1bGU7XG59KCkpO1xuZXhwb3J0cy5BYnN0cmFjdEV2ZW50UnVsZSA9IEFic3RyYWN0RXZlbnRSdWxlO1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgX19leHRlbmRzID0gKHRoaXMgJiYgdGhpcy5fX2V4dGVuZHMpIHx8IGZ1bmN0aW9uIChkLCBiKSB7XG4gICAgZm9yICh2YXIgcCBpbiBiKSBpZiAoYi5oYXNPd25Qcm9wZXJ0eShwKSkgZFtwXSA9IGJbcF07XG4gICAgZnVuY3Rpb24gX18oKSB7IHRoaXMuY29uc3RydWN0b3IgPSBkOyB9XG4gICAgZC5wcm90b3R5cGUgPSBiID09PSBudWxsID8gT2JqZWN0LmNyZWF0ZShiKSA6IChfXy5wcm90b3R5cGUgPSBiLnByb3RvdHlwZSwgbmV3IF9fKCkpO1xufTtcbnZhciBBYnN0cmFjdE1ldHJpY18xID0gcmVxdWlyZShcIi4vQWJzdHJhY3RNZXRyaWNcIik7XG52YXIgQWJzdHJhY3RJZGVudGlmaWNhdGlvbk1ldHJpYyA9IChmdW5jdGlvbiAoX3N1cGVyKSB7XG4gICAgX19leHRlbmRzKEFic3RyYWN0SWRlbnRpZmljYXRpb25NZXRyaWMsIF9zdXBlcik7XG4gICAgZnVuY3Rpb24gQWJzdHJhY3RJZGVudGlmaWNhdGlvbk1ldHJpYyhpZGVudGlmaWNhdGlvblNlcnZpY2UpIHtcbiAgICAgICAgX3N1cGVyLmNhbGwodGhpcywgdHJ1ZSwgZmFsc2UpO1xuICAgICAgICB0aGlzLmlkZW50aWZpY2F0aW9uID0gaWRlbnRpZmljYXRpb25TZXJ2aWNlLmdldElkZW50aWZpY2F0aW9uKCk7XG4gICAgfVxuICAgIHJldHVybiBBYnN0cmFjdElkZW50aWZpY2F0aW9uTWV0cmljO1xufShBYnN0cmFjdE1ldHJpY18xLkFic3RyYWN0TWV0cmljKSk7XG5leHBvcnRzLkFic3RyYWN0SWRlbnRpZmljYXRpb25NZXRyaWMgPSBBYnN0cmFjdElkZW50aWZpY2F0aW9uTWV0cmljO1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgQWJzdHJhY3RJbmFjdGl2aXR5TWV0cmljID0gKGZ1bmN0aW9uICgpIHtcbiAgICBmdW5jdGlvbiBBYnN0cmFjdEluYWN0aXZpdHlNZXRyaWModGltaW5nKSB7XG4gICAgICAgIHRoaXMuaXNMYXN0ID0gZmFsc2U7XG4gICAgICAgIHRoaXMub25lVGltZSA9IGZhbHNlO1xuICAgICAgICB0aGlzLm1pbkluYWN0aXZpdHlWYWx1ZSA9IE1hdGgucG93KDIsIDUzKSAtIDE7IC8vIE1heCBqcyBudW1iZXIgKG5lZWRlZCBmb3IgdGhlIGZpcnN0IGluYWN0aXZpdHkgb2NjdXJhbmNlKVxuICAgICAgICB0aGlzLm5hdmlnYXRpb25TdGFydCA9IHRpbWluZy5uYXZpZ2F0aW9uU3RhcnQ7XG4gICAgICAgIHRoaXMuaW5hY3Rpdml0eUNvdW50ZXIgPSB0aGlzLmluYWN0aXZpdHlTdW0gPSB0aGlzLm1pbkluYWN0aXZpdHlWYWx1ZSA9IHRoaXMubWF4SW5hY3Rpdml0eVZhbHVlID0gMDtcbiAgICB9XG4gICAgQWJzdHJhY3RJbmFjdGl2aXR5TWV0cmljLnByb3RvdHlwZS5jYWxjdWxhdGVJbmFjdGl2aXR5ID0gZnVuY3Rpb24gKGN1cnJlbnRUaW1lKSB7XG4gICAgICAgIGlmICgoRGF0ZS5ub3coKSAtIHRoaXMubmF2aWdhdGlvblN0YXJ0KSA8IDUwMCkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuaW5hY3Rpdml0eUNvdW50ZXIrKztcbiAgICAgICAgdGhpcy5sYXN0QWN0aXZpdHlUaW1lID0gY3VycmVudFRpbWU7XG4gICAgICAgIHRoaXMuaW5hY3Rpdml0eVN1bSA9IHRoaXMuaW5hY3Rpdml0eVN1bSArIHRoaXMubGFzdEFjdGl2aXR5VGltZTtcbiAgICAgICAgdGhpcy5taW5JbmFjdGl2aXR5VmFsdWUgPSBNYXRoLm1pbih0aGlzLmxhc3RBY3Rpdml0eVRpbWUsIHRoaXMubWluSW5hY3Rpdml0eVZhbHVlKTtcbiAgICAgICAgdGhpcy5tYXhJbmFjdGl2aXR5VmFsdWUgPSBNYXRoLm1heCh0aGlzLmxhc3RBY3Rpdml0eVRpbWUsIHRoaXMubWF4SW5hY3Rpdml0eVZhbHVlKTtcbiAgICB9O1xuICAgIEFic3RyYWN0SW5hY3Rpdml0eU1ldHJpYy5wcm90b3R5cGUuZ2V0TWV0cmljID0gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgdHlwZTogdGhpcy5nZXRNZXRyaWNUeXBlKCksXG4gICAgICAgICAgICB2YWx1ZToge1xuICAgICAgICAgICAgICAgIHN1bTogdGhpcy5pbmFjdGl2aXR5U3VtLFxuICAgICAgICAgICAgICAgIG1heDogdGhpcy5tYXhJbmFjdGl2aXR5VmFsdWUsXG4gICAgICAgICAgICAgICAgbWluOiB0aGlzLm1pbkluYWN0aXZpdHlWYWx1ZSxcbiAgICAgICAgICAgICAgICBjb3VudDogdGhpcy5pbmFjdGl2aXR5Q291bnRlclxuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgIH07XG4gICAgcmV0dXJuIEFic3RyYWN0SW5hY3Rpdml0eU1ldHJpYztcbn0oKSk7XG5leHBvcnRzLkFic3RyYWN0SW5hY3Rpdml0eU1ldHJpYyA9IEFic3RyYWN0SW5hY3Rpdml0eU1ldHJpYztcbiIsIlwidXNlIHN0cmljdFwiO1xudmFyIEFic3RyYWN0TWV0cmljID0gKGZ1bmN0aW9uICgpIHtcbiAgICBmdW5jdGlvbiBBYnN0cmFjdE1ldHJpYyhpc0xhc3QsIG9uZVRpbWUpIHtcbiAgICAgICAgaWYgKGlzTGFzdCA9PT0gdm9pZCAwKSB7IGlzTGFzdCA9IGZhbHNlOyB9XG4gICAgICAgIGlmIChvbmVUaW1lID09PSB2b2lkIDApIHsgb25lVGltZSA9IHRydWU7IH1cbiAgICAgICAgdGhpcy5pc0xhc3QgPSBpc0xhc3Q7XG4gICAgICAgIHRoaXMub25lVGltZSA9IG9uZVRpbWU7XG4gICAgfVxuICAgIEFic3RyYWN0TWV0cmljLnByb3RvdHlwZS5nZXRNZXRyaWMgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICB0eXBlOiB0aGlzLnR5cGUsXG4gICAgICAgICAgICB2YWx1ZTogdGhpcy5nZXRNZXRyaWNWYWx1ZSgpXG4gICAgICAgIH07XG4gICAgfTtcbiAgICByZXR1cm4gQWJzdHJhY3RNZXRyaWM7XG59KCkpO1xuZXhwb3J0cy5BYnN0cmFjdE1ldHJpYyA9IEFic3RyYWN0TWV0cmljO1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgX19leHRlbmRzID0gKHRoaXMgJiYgdGhpcy5fX2V4dGVuZHMpIHx8IGZ1bmN0aW9uIChkLCBiKSB7XG4gICAgZm9yICh2YXIgcCBpbiBiKSBpZiAoYi5oYXNPd25Qcm9wZXJ0eShwKSkgZFtwXSA9IGJbcF07XG4gICAgZnVuY3Rpb24gX18oKSB7IHRoaXMuY29uc3RydWN0b3IgPSBkOyB9XG4gICAgZC5wcm90b3R5cGUgPSBiID09PSBudWxsID8gT2JqZWN0LmNyZWF0ZShiKSA6IChfXy5wcm90b3R5cGUgPSBiLnByb3RvdHlwZSwgbmV3IF9fKCkpO1xufTtcbnZhciBNZXRyaWNUeXBlXzEgPSByZXF1aXJlKFwiLi9NZXRyaWNUeXBlXCIpO1xudmFyIEFic3RyYWN0SW5hY3Rpdml0eU1ldHJpY18xID0gcmVxdWlyZShcIi4vQWJzdHJhY3RJbmFjdGl2aXR5TWV0cmljXCIpO1xudmFyIEF0dGVudGlvbk1ldHJpYyA9IChmdW5jdGlvbiAoX3N1cGVyKSB7XG4gICAgX19leHRlbmRzKEF0dGVudGlvbk1ldHJpYywgX3N1cGVyKTtcbiAgICBmdW5jdGlvbiBBdHRlbnRpb25NZXRyaWModGltaW5nKSB7XG4gICAgICAgIF9zdXBlci5jYWxsKHRoaXMsIHRpbWluZyk7XG4gICAgfVxuICAgIEF0dGVudGlvbk1ldHJpYy5wcm90b3R5cGUuZ2V0TWV0cmljVHlwZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIE1ldHJpY1R5cGVfMS5NZXRyaWNUeXBlLmF0dGVudGlvbjtcbiAgICB9O1xuICAgIHJldHVybiBBdHRlbnRpb25NZXRyaWM7XG59KEFic3RyYWN0SW5hY3Rpdml0eU1ldHJpY18xLkFic3RyYWN0SW5hY3Rpdml0eU1ldHJpYykpO1xuZXhwb3J0cy5BdHRlbnRpb25NZXRyaWMgPSBBdHRlbnRpb25NZXRyaWM7XG4iLCJcInVzZSBzdHJpY3RcIjtcbnZhciBfX2V4dGVuZHMgPSAodGhpcyAmJiB0aGlzLl9fZXh0ZW5kcykgfHwgZnVuY3Rpb24gKGQsIGIpIHtcbiAgICBmb3IgKHZhciBwIGluIGIpIGlmIChiLmhhc093blByb3BlcnR5KHApKSBkW3BdID0gYltwXTtcbiAgICBmdW5jdGlvbiBfXygpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IGQ7IH1cbiAgICBkLnByb3RvdHlwZSA9IGIgPT09IG51bGwgPyBPYmplY3QuY3JlYXRlKGIpIDogKF9fLnByb3RvdHlwZSA9IGIucHJvdG90eXBlLCBuZXcgX18oKSk7XG59O1xudmFyIE1ldHJpY1R5cGVfMSA9IHJlcXVpcmUoXCIuL01ldHJpY1R5cGVcIik7XG52YXIgQWJzdHJhY3RNZXRyaWNfMSA9IHJlcXVpcmUoXCIuL0Fic3RyYWN0TWV0cmljXCIpO1xudmFyIEJyb3dzZXJNZXRyaWMgPSAoZnVuY3Rpb24gKF9zdXBlcikge1xuICAgIF9fZXh0ZW5kcyhCcm93c2VyTWV0cmljLCBfc3VwZXIpO1xuICAgIGZ1bmN0aW9uIEJyb3dzZXJNZXRyaWModXNlckFnZW50U2VydmljZSkge1xuICAgICAgICBfc3VwZXIuY2FsbCh0aGlzKTtcbiAgICAgICAgdGhpcy50eXBlID0gTWV0cmljVHlwZV8xLk1ldHJpY1R5cGUuYnJvd3NlcjtcbiAgICAgICAgdGhpcy51c2VyQWdlbnQgPSB1c2VyQWdlbnRTZXJ2aWNlLnVzZXJBZ2VudDtcbiAgICB9XG4gICAgQnJvd3Nlck1ldHJpYy5wcm90b3R5cGUuZ2V0TWV0cmljVmFsdWUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnVzZXJBZ2VudC5icm93c2VyLm5hbWU7XG4gICAgfTtcbiAgICByZXR1cm4gQnJvd3Nlck1ldHJpYztcbn0oQWJzdHJhY3RNZXRyaWNfMS5BYnN0cmFjdE1ldHJpYykpO1xuZXhwb3J0cy5Ccm93c2VyTWV0cmljID0gQnJvd3Nlck1ldHJpYztcbiIsIlwidXNlIHN0cmljdFwiO1xudmFyIF9fZXh0ZW5kcyA9ICh0aGlzICYmIHRoaXMuX19leHRlbmRzKSB8fCBmdW5jdGlvbiAoZCwgYikge1xuICAgIGZvciAodmFyIHAgaW4gYikgaWYgKGIuaGFzT3duUHJvcGVydHkocCkpIGRbcF0gPSBiW3BdO1xuICAgIGZ1bmN0aW9uIF9fKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gZDsgfVxuICAgIGQucHJvdG90eXBlID0gYiA9PT0gbnVsbCA/IE9iamVjdC5jcmVhdGUoYikgOiAoX18ucHJvdG90eXBlID0gYi5wcm90b3R5cGUsIG5ldyBfXygpKTtcbn07XG52YXIgTWV0cmljVHlwZV8xID0gcmVxdWlyZShcIi4vTWV0cmljVHlwZVwiKTtcbnZhciBBYnN0cmFjdE1ldHJpY18xID0gcmVxdWlyZShcIi4vQWJzdHJhY3RNZXRyaWNcIik7XG52YXIgQnJvd3NlclZlcnNpb25NZXRyaWMgPSAoZnVuY3Rpb24gKF9zdXBlcikge1xuICAgIF9fZXh0ZW5kcyhCcm93c2VyVmVyc2lvbk1ldHJpYywgX3N1cGVyKTtcbiAgICBmdW5jdGlvbiBCcm93c2VyVmVyc2lvbk1ldHJpYyh1c2VyQWdlbnRTZXJ2aWNlKSB7XG4gICAgICAgIF9zdXBlci5jYWxsKHRoaXMpO1xuICAgICAgICB0aGlzLnR5cGUgPSBNZXRyaWNUeXBlXzEuTWV0cmljVHlwZS5icm93c2VyVmVyc2lvbjtcbiAgICAgICAgdGhpcy51c2VyQWdlbnQgPSB1c2VyQWdlbnRTZXJ2aWNlLnVzZXJBZ2VudDtcbiAgICB9XG4gICAgQnJvd3NlclZlcnNpb25NZXRyaWMucHJvdG90eXBlLmdldE1ldHJpY1ZhbHVlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gdGhpcy51c2VyQWdlbnQuYnJvd3Nlci52ZXJzaW9uO1xuICAgIH07XG4gICAgcmV0dXJuIEJyb3dzZXJWZXJzaW9uTWV0cmljO1xufShBYnN0cmFjdE1ldHJpY18xLkFic3RyYWN0TWV0cmljKSk7XG5leHBvcnRzLkJyb3dzZXJWZXJzaW9uTWV0cmljID0gQnJvd3NlclZlcnNpb25NZXRyaWM7XG4iLCJcInVzZSBzdHJpY3RcIjtcbnZhciBDb21wb3NpdGVJbmFjdGl2aXR5ID0gKGZ1bmN0aW9uICgpIHtcbiAgICBmdW5jdGlvbiBDb21wb3NpdGVJbmFjdGl2aXR5KGh1YiwgbGFja09mSW50ZXJlc3RNZXRyaWMsIGF0dGVudGlvbk1ldHJpYykge1xuICAgICAgICB0aGlzLmh1YiA9IGh1YjtcbiAgICAgICAgdGhpcy5sYWNrT2ZJbnRlcmVzdE1ldHJpYyA9IGxhY2tPZkludGVyZXN0TWV0cmljO1xuICAgICAgICB0aGlzLmF0dGVudGlvbk1ldHJpYyA9IGF0dGVudGlvbk1ldHJpYztcbiAgICAgICAgdGhpcy5sYXN0QWN0aXZpdHlEZXRlY3RlZFRpbWUgPSBEYXRlLm5vdygpO1xuICAgICAgICB0aGlzLmh1Yi5iaW5kKGh1Yi51c2VyRXZlbnRzLCB0aGlzLm9uRXZlbnRSYWlzZWQuYmluZCh0aGlzKSk7XG4gICAgfVxuICAgIENvbXBvc2l0ZUluYWN0aXZpdHkucHJvdG90eXBlLm9uRXZlbnRSYWlzZWQgPSBmdW5jdGlvbiAoZXYpIHtcbiAgICAgICAgdGhpcy51cGRhdGVNZXRyaWMoKTtcbiAgICB9O1xuICAgIENvbXBvc2l0ZUluYWN0aXZpdHkucHJvdG90eXBlLnVwZGF0ZU1ldHJpYyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIG5vdyA9IERhdGUubm93KCk7XG4gICAgICAgIHZhciBhY3Rpdml0eURldGVjdGVkVGltZURpZmYgPSBub3cgLSB0aGlzLmxhc3RBY3Rpdml0eURldGVjdGVkVGltZTtcbiAgICAgICAgaWYgKGFjdGl2aXR5RGV0ZWN0ZWRUaW1lRGlmZiA8PSAxMDAwKSB7XG4gICAgICAgICAgICB0aGlzLmxhY2tPZkludGVyZXN0TWV0cmljLmNhbGN1bGF0ZUluYWN0aXZpdHkoYWN0aXZpdHlEZXRlY3RlZFRpbWVEaWZmKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChhY3Rpdml0eURldGVjdGVkVGltZURpZmYgPiAxMDAwICYmIGFjdGl2aXR5RGV0ZWN0ZWRUaW1lRGlmZiA8IDUwMDApIHtcbiAgICAgICAgICAgIHRoaXMuYXR0ZW50aW9uTWV0cmljLmNhbGN1bGF0ZUluYWN0aXZpdHkoYWN0aXZpdHlEZXRlY3RlZFRpbWVEaWZmKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmxhc3RBY3Rpdml0eURldGVjdGVkVGltZSA9IG5vdztcbiAgICB9O1xuICAgIHJldHVybiBDb21wb3NpdGVJbmFjdGl2aXR5O1xufSgpKTtcbmV4cG9ydHMuQ29tcG9zaXRlSW5hY3Rpdml0eSA9IENvbXBvc2l0ZUluYWN0aXZpdHk7XG4iLCJcInVzZSBzdHJpY3RcIjtcbnZhciBfX2V4dGVuZHMgPSAodGhpcyAmJiB0aGlzLl9fZXh0ZW5kcykgfHwgZnVuY3Rpb24gKGQsIGIpIHtcbiAgICBmb3IgKHZhciBwIGluIGIpIGlmIChiLmhhc093blByb3BlcnR5KHApKSBkW3BdID0gYltwXTtcbiAgICBmdW5jdGlvbiBfXygpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IGQ7IH1cbiAgICBkLnByb3RvdHlwZSA9IGIgPT09IG51bGwgPyBPYmplY3QuY3JlYXRlKGIpIDogKF9fLnByb3RvdHlwZSA9IGIucHJvdG90eXBlLCBuZXcgX18oKSk7XG59O1xudmFyIE1ldHJpY1R5cGVfMSA9IHJlcXVpcmUoXCIuL01ldHJpY1R5cGVcIik7XG52YXIgQWJzdHJhY3RNZXRyaWNfMSA9IHJlcXVpcmUoXCIuL0Fic3RyYWN0TWV0cmljXCIpO1xudmFyIERPTUxDb250ZW50TG9hZGVkVGltZU1ldHJpYyA9IChmdW5jdGlvbiAoX3N1cGVyKSB7XG4gICAgX19leHRlbmRzKERPTUxDb250ZW50TG9hZGVkVGltZU1ldHJpYywgX3N1cGVyKTtcbiAgICBmdW5jdGlvbiBET01MQ29udGVudExvYWRlZFRpbWVNZXRyaWModGltaW5nKSB7XG4gICAgICAgIF9zdXBlci5jYWxsKHRoaXMpO1xuICAgICAgICB0aGlzLnRpbWluZyA9IHRpbWluZztcbiAgICAgICAgdGhpcy5pc0xhc3QgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5vbmVUaW1lID0gdHJ1ZTtcbiAgICAgICAgdGhpcy50eXBlID0gTWV0cmljVHlwZV8xLk1ldHJpY1R5cGUuZG9tQ29udGVudExvYWRlZDtcbiAgICB9XG4gICAgRE9NTENvbnRlbnRMb2FkZWRUaW1lTWV0cmljLnByb3RvdHlwZS5nZXRNZXRyaWNWYWx1ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMudGltaW5nLmRvbUNvbnRlbnRMb2FkZWRFdmVudEVuZCAtIHRoaXMudGltaW5nLm5hdmlnYXRpb25TdGFydDtcbiAgICB9O1xuICAgIHJldHVybiBET01MQ29udGVudExvYWRlZFRpbWVNZXRyaWM7XG59KEFic3RyYWN0TWV0cmljXzEuQWJzdHJhY3RNZXRyaWMpKTtcbmV4cG9ydHMuRE9NTENvbnRlbnRMb2FkZWRUaW1lTWV0cmljID0gRE9NTENvbnRlbnRMb2FkZWRUaW1lTWV0cmljO1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgX19leHRlbmRzID0gKHRoaXMgJiYgdGhpcy5fX2V4dGVuZHMpIHx8IGZ1bmN0aW9uIChkLCBiKSB7XG4gICAgZm9yICh2YXIgcCBpbiBiKSBpZiAoYi5oYXNPd25Qcm9wZXJ0eShwKSkgZFtwXSA9IGJbcF07XG4gICAgZnVuY3Rpb24gX18oKSB7IHRoaXMuY29uc3RydWN0b3IgPSBkOyB9XG4gICAgZC5wcm90b3R5cGUgPSBiID09PSBudWxsID8gT2JqZWN0LmNyZWF0ZShiKSA6IChfXy5wcm90b3R5cGUgPSBiLnByb3RvdHlwZSwgbmV3IF9fKCkpO1xufTtcbnZhciBNZXRyaWNUeXBlXzEgPSByZXF1aXJlKFwiLi9NZXRyaWNUeXBlXCIpO1xudmFyIEFic3RyYWN0TWV0cmljXzEgPSByZXF1aXJlKFwiLi9BYnN0cmFjdE1ldHJpY1wiKTtcbnZhciBEb2N1bWVudFJlZmVycmVyTWV0cmljID0gKGZ1bmN0aW9uIChfc3VwZXIpIHtcbiAgICBfX2V4dGVuZHMoRG9jdW1lbnRSZWZlcnJlck1ldHJpYywgX3N1cGVyKTtcbiAgICBmdW5jdGlvbiBEb2N1bWVudFJlZmVycmVyTWV0cmljKCkge1xuICAgICAgICBfc3VwZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgICAgICAgdGhpcy50eXBlID0gTWV0cmljVHlwZV8xLk1ldHJpY1R5cGUuZG9jdW1lbnRSZWZlcnJlcjtcbiAgICB9XG4gICAgRG9jdW1lbnRSZWZlcnJlck1ldHJpYy5wcm90b3R5cGUuZ2V0TWV0cmljVmFsdWUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiBkb2N1bWVudC5yZWZlcnJlcjtcbiAgICB9O1xuICAgIHJldHVybiBEb2N1bWVudFJlZmVycmVyTWV0cmljO1xufShBYnN0cmFjdE1ldHJpY18xLkFic3RyYWN0TWV0cmljKSk7XG5leHBvcnRzLkRvY3VtZW50UmVmZXJyZXJNZXRyaWMgPSBEb2N1bWVudFJlZmVycmVyTWV0cmljO1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgX19leHRlbmRzID0gKHRoaXMgJiYgdGhpcy5fX2V4dGVuZHMpIHx8IGZ1bmN0aW9uIChkLCBiKSB7XG4gICAgZm9yICh2YXIgcCBpbiBiKSBpZiAoYi5oYXNPd25Qcm9wZXJ0eShwKSkgZFtwXSA9IGJbcF07XG4gICAgZnVuY3Rpb24gX18oKSB7IHRoaXMuY29uc3RydWN0b3IgPSBkOyB9XG4gICAgZC5wcm90b3R5cGUgPSBiID09PSBudWxsID8gT2JqZWN0LmNyZWF0ZShiKSA6IChfXy5wcm90b3R5cGUgPSBiLnByb3RvdHlwZSwgbmV3IF9fKCkpO1xufTtcbnZhciBNZXRyaWNUeXBlXzEgPSByZXF1aXJlKFwiLi9NZXRyaWNUeXBlXCIpO1xudmFyIEFic3RyYWN0QWN0aXZpdHlNZXRyaWNfMSA9IHJlcXVpcmUoXCIuL0Fic3RyYWN0QWN0aXZpdHlNZXRyaWNcIik7XG52YXIgRW5nYWdlbWVudFRpbWVBZ2dyZWdhdG9yTWV0cmljID0gKGZ1bmN0aW9uIChfc3VwZXIpIHtcbiAgICBfX2V4dGVuZHMoRW5nYWdlbWVudFRpbWVBZ2dyZWdhdG9yTWV0cmljLCBfc3VwZXIpO1xuICAgIGZ1bmN0aW9uIEVuZ2FnZW1lbnRUaW1lQWdncmVnYXRvck1ldHJpYyhodWIsIGNvbmZpZywgdGltaW5nKSB7XG4gICAgICAgIF9zdXBlci5jYWxsKHRoaXMsIHRpbWluZyk7XG4gICAgICAgIHRoaXMuaHViID0gaHViO1xuICAgICAgICB0aGlzLmNvbmZpZyA9IGNvbmZpZztcbiAgICAgICAgdGhpcy5pbnRlcnZhbElkID0gMDtcbiAgICAgICAgdGhpcy5odWIuYmluZChodWIudXNlckV2ZW50cywgdGhpcy5vbkV2ZW50UmFpc2VkLmJpbmQodGhpcykpO1xuICAgICAgICB0aGlzLmd1YXJkSW5hY3Rpdml0eVRpbWUoKTtcbiAgICB9XG4gICAgRW5nYWdlbWVudFRpbWVBZ2dyZWdhdG9yTWV0cmljLnByb3RvdHlwZS5nZXRNZXRyaWNUeXBlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gTWV0cmljVHlwZV8xLk1ldHJpY1R5cGUuZW5nYWdlbWVudFRpbWU7XG4gICAgfTtcbiAgICBFbmdhZ2VtZW50VGltZUFnZ3JlZ2F0b3JNZXRyaWMucHJvdG90eXBlLmd1YXJkSW5hY3Rpdml0eVRpbWUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgIGNsZWFyVGltZW91dCh0aGlzLmludGVydmFsSWQpO1xuICAgICAgICB0aGlzLmludGVydmFsSWQgPSBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIF90aGlzLm1hcmtJbmFjdGl2aXR5KCk7XG4gICAgICAgIH0sIHRoaXMuY29uZmlnLm1ldHJpY3MuaW5hY3Rpdml0eVRpbWUpO1xuICAgIH07XG4gICAgRW5nYWdlbWVudFRpbWVBZ2dyZWdhdG9yTWV0cmljLnByb3RvdHlwZS5vbkV2ZW50UmFpc2VkID0gZnVuY3Rpb24gKGV2KSB7XG4gICAgICAgIHRoaXMubWFya0FjdGl2aXR5KCk7XG4gICAgICAgIHRoaXMuZ3VhcmRJbmFjdGl2aXR5VGltZSgpO1xuICAgIH07XG4gICAgRW5nYWdlbWVudFRpbWVBZ2dyZWdhdG9yTWV0cmljLnByb3RvdHlwZS5kaXNwb3NlID0gZnVuY3Rpb24gKHNodXRkb3duKSB7XG4gICAgICAgIGNsZWFyVGltZW91dCh0aGlzLmludGVydmFsSWQpO1xuICAgIH07XG4gICAgcmV0dXJuIEVuZ2FnZW1lbnRUaW1lQWdncmVnYXRvck1ldHJpYztcbn0oQWJzdHJhY3RBY3Rpdml0eU1ldHJpY18xLkFic3RyYWN0QWN0aXZpdHlNZXRyaWMpKTtcbmV4cG9ydHMuRW5nYWdlbWVudFRpbWVBZ2dyZWdhdG9yTWV0cmljID0gRW5nYWdlbWVudFRpbWVBZ2dyZWdhdG9yTWV0cmljO1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgTWV0cmljVHlwZV8xID0gcmVxdWlyZShcIi4vTWV0cmljVHlwZVwiKTtcbnZhciBFdmVudElkc01ldHJpYyA9IChmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gRXZlbnRJZHNNZXRyaWMoKSB7XG4gICAgICAgIHRoaXMuaXNMYXN0ID0gZmFsc2U7XG4gICAgICAgIHRoaXMub25lVGltZSA9IGZhbHNlO1xuICAgICAgICB0aGlzLmV2ZW50c0FycmF5ID0gW107XG4gICAgfVxuICAgIEV2ZW50SWRzTWV0cmljLnByb3RvdHlwZS5hZGRFdmVudCA9IGZ1bmN0aW9uIChldmVudElkKSB7XG4gICAgICAgIGlmICh0aGlzLmV2ZW50c0FycmF5LmluZGV4T2YoZXZlbnRJZCkgPT09IC0xKSB7XG4gICAgICAgICAgICB0aGlzLmV2ZW50c0FycmF5LnB1c2goZXZlbnRJZCk7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIEV2ZW50SWRzTWV0cmljLnByb3RvdHlwZS5nZXRNZXRyaWMgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICB2YWx1ZTogdGhpcy5ldmVudHNBcnJheSxcbiAgICAgICAgICAgIHR5cGU6IE1ldHJpY1R5cGVfMS5NZXRyaWNUeXBlLmV2ZW50SWRzXG4gICAgICAgIH07XG4gICAgfTtcbiAgICByZXR1cm4gRXZlbnRJZHNNZXRyaWM7XG59KCkpO1xuZXhwb3J0cy5FdmVudElkc01ldHJpYyA9IEV2ZW50SWRzTWV0cmljO1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgTWV0cmljVHlwZV8xID0gcmVxdWlyZShcIi4vTWV0cmljVHlwZVwiKTtcbnZhciBJZE1ldHJpYyA9IChmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gSWRNZXRyaWMoaWQpIHtcbiAgICAgICAgdGhpcy5pZCA9IGlkO1xuICAgICAgICB0aGlzLmlzTGFzdCA9IHRydWU7XG4gICAgICAgIHRoaXMub25lVGltZSA9IGZhbHNlO1xuICAgIH1cbiAgICBJZE1ldHJpYy5wcm90b3R5cGUuZ2V0TWV0cmljID0gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgdmFsdWU6IHRoaXMuaWQsXG4gICAgICAgICAgICB0eXBlOiBNZXRyaWNUeXBlXzEuTWV0cmljVHlwZS5tZXNzYWdlSWRcbiAgICAgICAgfTtcbiAgICB9O1xuICAgIHJldHVybiBJZE1ldHJpYztcbn0oKSk7XG5leHBvcnRzLklkTWV0cmljID0gSWRNZXRyaWM7XG4iLCJcInVzZSBzdHJpY3RcIjtcbnZhciBfX2V4dGVuZHMgPSAodGhpcyAmJiB0aGlzLl9fZXh0ZW5kcykgfHwgZnVuY3Rpb24gKGQsIGIpIHtcbiAgICBmb3IgKHZhciBwIGluIGIpIGlmIChiLmhhc093blByb3BlcnR5KHApKSBkW3BdID0gYltwXTtcbiAgICBmdW5jdGlvbiBfXygpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IGQ7IH1cbiAgICBkLnByb3RvdHlwZSA9IGIgPT09IG51bGwgPyBPYmplY3QuY3JlYXRlKGIpIDogKF9fLnByb3RvdHlwZSA9IGIucHJvdG90eXBlLCBuZXcgX18oKSk7XG59O1xudmFyIE1ldHJpY1R5cGVfMSA9IHJlcXVpcmUoXCIuL01ldHJpY1R5cGVcIik7XG52YXIgQWJzdHJhY3RNZXRyaWNfMSA9IHJlcXVpcmUoXCIuL0Fic3RyYWN0TWV0cmljXCIpO1xudmFyIElzTmV3VmlzaXRvck1ldHJpYyA9IChmdW5jdGlvbiAoX3N1cGVyKSB7XG4gICAgX19leHRlbmRzKElzTmV3VmlzaXRvck1ldHJpYywgX3N1cGVyKTtcbiAgICBmdW5jdGlvbiBJc05ld1Zpc2l0b3JNZXRyaWMoaWRlbnRpZmljYXRpb25TZXJ2aWNlKSB7XG4gICAgICAgIF9zdXBlci5jYWxsKHRoaXMpO1xuICAgICAgICB0aGlzLmlkZW50aWZpY2F0aW9uU2VydmljZSA9IGlkZW50aWZpY2F0aW9uU2VydmljZTtcbiAgICAgICAgdGhpcy50eXBlID0gTWV0cmljVHlwZV8xLk1ldHJpY1R5cGUuaXNOZXdWaXNpdG9yO1xuICAgIH1cbiAgICBJc05ld1Zpc2l0b3JNZXRyaWMucHJvdG90eXBlLmdldE1ldHJpY1ZhbHVlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5pZGVudGlmaWNhdGlvblNlcnZpY2UuaXNOZXdJZGVudGlmaWNhdGlvbjtcbiAgICB9O1xuICAgIHJldHVybiBJc05ld1Zpc2l0b3JNZXRyaWM7XG59KEFic3RyYWN0TWV0cmljXzEuQWJzdHJhY3RNZXRyaWMpKTtcbmV4cG9ydHMuSXNOZXdWaXNpdG9yTWV0cmljID0gSXNOZXdWaXNpdG9yTWV0cmljO1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgTWV0cmljVHlwZV8xID0gcmVxdWlyZShcIi4vTWV0cmljVHlwZVwiKTtcbnZhciBFdmVudFR5cGVfMSA9IHJlcXVpcmUoXCIuLi9ldmVudEh1YnMvRXZlbnRUeXBlXCIpO1xudmFyIEpTRXJyb3JDb3VudE1ldHJpYyA9IChmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gSlNFcnJvckNvdW50TWV0cmljKGh1Yikge1xuICAgICAgICB0aGlzLmh1YiA9IGh1YjtcbiAgICAgICAgdGhpcy5pc0xhc3QgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5vbmVUaW1lID0gZmFsc2U7XG4gICAgICAgIHRoaXMuanNFcnJvckNvdW50ZXIgPSAwO1xuICAgICAgICB0aGlzLmh1Yi5iaW5kKFtFdmVudFR5cGVfMS5FdmVudFR5cGUuZXJyb3JdLCB0aGlzLm9uRXZlbnRSYWlzZWQuYmluZCh0aGlzKSk7XG4gICAgfVxuICAgIEpTRXJyb3JDb3VudE1ldHJpYy5wcm90b3R5cGUub25FdmVudFJhaXNlZCA9IGZ1bmN0aW9uIChldikge1xuICAgICAgICB0aGlzLmpzRXJyb3JDb3VudGVyKys7XG4gICAgfTtcbiAgICBKU0Vycm9yQ291bnRNZXRyaWMucHJvdG90eXBlLmdldE1ldHJpYyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHZhbHVlOiB0aGlzLmpzRXJyb3JDb3VudGVyLFxuICAgICAgICAgICAgdHlwZTogTWV0cmljVHlwZV8xLk1ldHJpY1R5cGUuanNFcnJvckNvdW50XG4gICAgICAgIH07XG4gICAgfTtcbiAgICByZXR1cm4gSlNFcnJvckNvdW50TWV0cmljO1xufSgpKTtcbmV4cG9ydHMuSlNFcnJvckNvdW50TWV0cmljID0gSlNFcnJvckNvdW50TWV0cmljO1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgX19leHRlbmRzID0gKHRoaXMgJiYgdGhpcy5fX2V4dGVuZHMpIHx8IGZ1bmN0aW9uIChkLCBiKSB7XG4gICAgZm9yICh2YXIgcCBpbiBiKSBpZiAoYi5oYXNPd25Qcm9wZXJ0eShwKSkgZFtwXSA9IGJbcF07XG4gICAgZnVuY3Rpb24gX18oKSB7IHRoaXMuY29uc3RydWN0b3IgPSBkOyB9XG4gICAgZC5wcm90b3R5cGUgPSBiID09PSBudWxsID8gT2JqZWN0LmNyZWF0ZShiKSA6IChfXy5wcm90b3R5cGUgPSBiLnByb3RvdHlwZSwgbmV3IF9fKCkpO1xufTtcbnZhciBNZXRyaWNUeXBlXzEgPSByZXF1aXJlKFwiLi9NZXRyaWNUeXBlXCIpO1xudmFyIEFic3RyYWN0SW5hY3Rpdml0eU1ldHJpY18xID0gcmVxdWlyZShcIi4vQWJzdHJhY3RJbmFjdGl2aXR5TWV0cmljXCIpO1xudmFyIExhY2tPZkludGVyZXN0TWV0cmljID0gKGZ1bmN0aW9uIChfc3VwZXIpIHtcbiAgICBfX2V4dGVuZHMoTGFja09mSW50ZXJlc3RNZXRyaWMsIF9zdXBlcik7XG4gICAgZnVuY3Rpb24gTGFja09mSW50ZXJlc3RNZXRyaWModGltaW5nKSB7XG4gICAgICAgIF9zdXBlci5jYWxsKHRoaXMsIHRpbWluZyk7XG4gICAgfVxuICAgIExhY2tPZkludGVyZXN0TWV0cmljLnByb3RvdHlwZS5nZXRNZXRyaWNUeXBlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gTWV0cmljVHlwZV8xLk1ldHJpY1R5cGUubGFja09mSW50ZXJlc3Q7XG4gICAgfTtcbiAgICByZXR1cm4gTGFja09mSW50ZXJlc3RNZXRyaWM7XG59KEFic3RyYWN0SW5hY3Rpdml0eU1ldHJpY18xLkFic3RyYWN0SW5hY3Rpdml0eU1ldHJpYykpO1xuZXhwb3J0cy5MYWNrT2ZJbnRlcmVzdE1ldHJpYyA9IExhY2tPZkludGVyZXN0TWV0cmljO1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgX19leHRlbmRzID0gKHRoaXMgJiYgdGhpcy5fX2V4dGVuZHMpIHx8IGZ1bmN0aW9uIChkLCBiKSB7XG4gICAgZm9yICh2YXIgcCBpbiBiKSBpZiAoYi5oYXNPd25Qcm9wZXJ0eShwKSkgZFtwXSA9IGJbcF07XG4gICAgZnVuY3Rpb24gX18oKSB7IHRoaXMuY29uc3RydWN0b3IgPSBkOyB9XG4gICAgZC5wcm90b3R5cGUgPSBiID09PSBudWxsID8gT2JqZWN0LmNyZWF0ZShiKSA6IChfXy5wcm90b3R5cGUgPSBiLnByb3RvdHlwZSwgbmV3IF9fKCkpO1xufTtcbnZhciBNZXRyaWNUeXBlXzEgPSByZXF1aXJlKFwiLi9NZXRyaWNUeXBlXCIpO1xudmFyIEFic3RyYWN0TWV0cmljXzEgPSByZXF1aXJlKFwiLi9BYnN0cmFjdE1ldHJpY1wiKTtcbnZhciBMb2NhdGlvbk1ldHJpYyA9IChmdW5jdGlvbiAoX3N1cGVyKSB7XG4gICAgX19leHRlbmRzKExvY2F0aW9uTWV0cmljLCBfc3VwZXIpO1xuICAgIGZ1bmN0aW9uIExvY2F0aW9uTWV0cmljKCkge1xuICAgICAgICBfc3VwZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgICAgICAgdGhpcy50eXBlID0gTWV0cmljVHlwZV8xLk1ldHJpY1R5cGUubG9jYXRpb247XG4gICAgfVxuICAgIExvY2F0aW9uTWV0cmljLnByb3RvdHlwZS5nZXRNZXRyaWNWYWx1ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIGxvY2F0aW9uLmhyZWY7XG4gICAgfTtcbiAgICByZXR1cm4gTG9jYXRpb25NZXRyaWM7XG59KEFic3RyYWN0TWV0cmljXzEuQWJzdHJhY3RNZXRyaWMpKTtcbmV4cG9ydHMuTG9jYXRpb25NZXRyaWMgPSBMb2NhdGlvbk1ldHJpYztcbiIsIlwidXNlIHN0cmljdFwiO1xudmFyIEV2ZW50VHlwZV8xID0gcmVxdWlyZShcIi4uL2V2ZW50SHVicy9FdmVudFR5cGVcIik7XG52YXIgTWV0cmljQWdncmVnYXRvciA9IChmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gTWV0cmljQWdncmVnYXRvcihtZXRyaWNzLCBodWIsIGNvbmZpZywgaWRNZXRyaWNGYWN0b3J5LCBzZXJpYWxpemFibGVGYWN0b3J5KSB7XG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgIHRoaXMubWV0cmljcyA9IG1ldHJpY3M7XG4gICAgICAgIHRoaXMuY29uZmlnID0gY29uZmlnO1xuICAgICAgICB0aGlzLmlkTWV0cmljRmFjdG9yeSA9IGlkTWV0cmljRmFjdG9yeTtcbiAgICAgICAgdGhpcy5zZXJpYWxpemFibGVGYWN0b3J5ID0gc2VyaWFsaXphYmxlRmFjdG9yeTtcbiAgICAgICAgdGhpcy5yZWxpYWJsZSA9IHRydWU7XG4gICAgICAgIHRoaXMubWV0cmljQ291bnRlciA9IDA7XG4gICAgICAgIHRoaXMubWVzc2FnZVR5cGUgPSAwIC8qIHN0YXJ0ICovO1xuICAgICAgICB0aGlzLnNlcmlsYWl6ZXIgPSBzZXJpYWxpemFibGVGYWN0b3J5LmdldFNlcmlhbGl6ZXIoKTtcbiAgICAgICAgaHViLmJpbmRUb3AoW0V2ZW50VHlwZV8xLkV2ZW50VHlwZS5iZWZvcmV1bmxvYWQsIEV2ZW50VHlwZV8xLkV2ZW50VHlwZS51bmxvYWRdLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBfdGhpcy50ZXJtaW5hdGUoKTtcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIE1ldHJpY0FnZ3JlZ2F0b3IucHJvdG90eXBlLnRlcm1pbmF0ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5tZXNzYWdlVHlwZSA9IDIgLyogZW5kICovO1xuICAgICAgICB0aGlzLnNlcmlsYWl6ZXIgPSB0aGlzLnNlcmlhbGl6YWJsZUZhY3RvcnkuZ2V0U2VyaWFsaXplcigpO1xuICAgICAgICB0aGlzLm1ldHJpY3MgPSB0aGlzLm1ldHJpY3MuZmlsdGVyKGZ1bmN0aW9uIChtZXRyaWMpIHsgcmV0dXJuIG1ldHJpYy5pc0xhc3Q7IH0pO1xuICAgIH07XG4gICAgTWV0cmljQWdncmVnYXRvci5wcm90b3R5cGUuZ2V0TWV0cmljcyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIGlkID0gdGhpcy5nZXRNZXRyaWNJZCgpO1xuICAgICAgICB2YXIgbWV0cmljcztcbiAgICAgICAgdmFyIGlkTWV0cmljID0gdGhpcy5pZE1ldHJpY0ZhY3RvcnkoaWQpO1xuICAgICAgICBtZXRyaWNzID0gdGhpcy5tZXRyaWNzLmNvbmNhdChbaWRNZXRyaWNdKTtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIGlkOiBpZCxcbiAgICAgICAgICAgIHR5cGU6IHRoaXMubWVzc2FnZVR5cGUsXG4gICAgICAgICAgICByZWxpYWJsZTogdGhpcy5yZWxpYWJsZSxcbiAgICAgICAgICAgIG1ldHJpY3M6IHRoaXMuc2VyaWxhaXplci5zZXJpYWxpemUobWV0cmljcy5tYXAoZnVuY3Rpb24gKG1ldHJpYykgeyByZXR1cm4gbWV0cmljLmdldE1ldHJpYygpOyB9KSlcbiAgICAgICAgfTtcbiAgICB9O1xuICAgIE1ldHJpY0FnZ3JlZ2F0b3IucHJvdG90eXBlLnJlc29sdmVNZXRyaWNzID0gZnVuY3Rpb24gKG1ldHJpY3NJZGVudGlmaWVyKSB7XG4gICAgICAgIGlmIChtZXRyaWNzSWRlbnRpZmllci5yZWxpYWJsZSkge1xuICAgICAgICAgICAgdGhpcy5yZWxpYWJsZSA9IGZhbHNlO1xuICAgICAgICAgICAgdGhpcy5tZXNzYWdlVHlwZSA9IDEgLyogY2h1bmsgKi87XG4gICAgICAgICAgICB0aGlzLm1ldHJpY3MgPSB0aGlzLm1ldHJpY3MuZmlsdGVyKGZ1bmN0aW9uIChtZXRyaWMpIHsgcmV0dXJuICFtZXRyaWMub25lVGltZTsgfSk7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIE1ldHJpY0FnZ3JlZ2F0b3IucHJvdG90eXBlLmdldE1ldHJpY0lkID0gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5yZWxpYWJsZSA/IHRoaXMubWV0cmljQ291bnRlciA6ICsrdGhpcy5tZXRyaWNDb3VudGVyO1xuICAgIH07XG4gICAgcmV0dXJuIE1ldHJpY0FnZ3JlZ2F0b3I7XG59KCkpO1xuZXhwb3J0cy5NZXRyaWNBZ2dyZWdhdG9yID0gTWV0cmljQWdncmVnYXRvcjtcbiIsIlwidXNlIHN0cmljdFwiO1xudmFyIE1ldHJpY1R5cGU7XG4oZnVuY3Rpb24gKE1ldHJpY1R5cGUpIHtcbiAgICBNZXRyaWNUeXBlW01ldHJpY1R5cGVbXCJ2aXNpdElkXCJdID0gM10gPSBcInZpc2l0SWRcIjtcbiAgICBNZXRyaWNUeXBlW01ldHJpY1R5cGVbXCJ2ZXJzaW9uXCJdID0gNl0gPSBcInZlcnNpb25cIjtcbiAgICBNZXRyaWNUeXBlW01ldHJpY1R5cGVbXCJzY3JlZW5YXCJdID0gMTZdID0gXCJzY3JlZW5YXCI7XG4gICAgTWV0cmljVHlwZVtNZXRyaWNUeXBlW1wic2NyZWVuWVwiXSA9IDE3XSA9IFwic2NyZWVuWVwiO1xuICAgIE1ldHJpY1R5cGVbTWV0cmljVHlwZVtcImJyb3dzZXJcIl0gPSAxOF0gPSBcImJyb3dzZXJcIjtcbiAgICBNZXRyaWNUeXBlW01ldHJpY1R5cGVbXCJsb2NhdGlvblwiXSA9IDddID0gXCJsb2NhdGlvblwiO1xuICAgIE1ldHJpY1R5cGVbTWV0cmljVHlwZVtcInZpc2l0b3JJZFwiXSA9IDJdID0gXCJ2aXNpdG9ySWRcIjtcbiAgICBNZXRyaWNUeXBlW01ldHJpY1R5cGVbXCJwcm9qZWN0SWRcIl0gPSAxXSA9IFwicHJvamVjdElkXCI7XG4gICAgTWV0cmljVHlwZVtNZXRyaWNUeXBlW1wibWVzc2FnZUlkXCJdID0gNV0gPSBcIm1lc3NhZ2VJZFwiO1xuICAgIE1ldHJpY1R5cGVbTWV0cmljVHlwZVtcImV2ZW50SWRzXCJdID0gMjFdID0gXCJldmVudElkc1wiO1xuICAgIE1ldHJpY1R5cGVbTWV0cmljVHlwZVtcInBhZ2V2aWV3SWRcIl0gPSA0XSA9IFwicGFnZXZpZXdJZFwiO1xuICAgIE1ldHJpY1R5cGVbTWV0cmljVHlwZVtcInRpbWVzdGFtcFwiXSA9IDMxXSA9IFwidGltZXN0YW1wXCI7XG4gICAgTWV0cmljVHlwZVtNZXRyaWNUeXBlW1wiYXR0ZW50aW9uXCJdID0gMzJdID0gXCJhdHRlbnRpb25cIjtcbiAgICBNZXRyaWNUeXBlW01ldHJpY1R5cGVbXCJ0aW1lT25QYWdlXCJdID0gMTJdID0gXCJ0aW1lT25QYWdlXCI7XG4gICAgTWV0cmljVHlwZVtNZXRyaWNUeXBlW1wibnVtT2ZDbGlja3NcIl0gPSAxNF0gPSBcIm51bU9mQ2xpY2tzXCI7XG4gICAgTWV0cmljVHlwZVtNZXRyaWNUeXBlW1wic2Nyb2xsUmVhY2hcIl0gPSAxM10gPSBcInNjcm9sbFJlYWNoXCI7XG4gICAgTWV0cmljVHlwZVtNZXRyaWNUeXBlW1wianNFcnJvckNvdW50XCJdID0gMTFdID0gXCJqc0Vycm9yQ291bnRcIjtcbiAgICBNZXRyaWNUeXBlW01ldHJpY1R5cGVbXCJpc05ld1Zpc2l0b3JcIl0gPSAyMF0gPSBcImlzTmV3VmlzaXRvclwiO1xuICAgIE1ldHJpY1R5cGVbTWV0cmljVHlwZVtcImVuZ2FnZW1lbnRUaW1lXCJdID0gOV0gPSBcImVuZ2FnZW1lbnRUaW1lXCI7XG4gICAgTWV0cmljVHlwZVtNZXRyaWNUeXBlW1wibGFja09mSW50ZXJlc3RcIl0gPSAzMF0gPSBcImxhY2tPZkludGVyZXN0XCI7XG4gICAgTWV0cmljVHlwZVtNZXRyaWNUeXBlW1wiYnJvd3NlclZlcnNpb25cIl0gPSAxOV0gPSBcImJyb3dzZXJWZXJzaW9uXCI7XG4gICAgTWV0cmljVHlwZVtNZXRyaWNUeXBlW1wiZG9jdW1lbnRSZWZlcnJlclwiXSA9IDhdID0gXCJkb2N1bWVudFJlZmVycmVyXCI7XG4gICAgTWV0cmljVHlwZVtNZXRyaWNUeXBlW1wiZG9tQ29udGVudExvYWRlZFwiXSA9IDEwXSA9IFwiZG9tQ29udGVudExvYWRlZFwiO1xuICAgIE1ldHJpY1R5cGVbTWV0cmljVHlwZVtcImR1cmF0aW9uU2luY2VMYXN0VmlzaXRcIl0gPSAxNV0gPSBcImR1cmF0aW9uU2luY2VMYXN0VmlzaXRcIjtcbn0pKE1ldHJpY1R5cGUgfHwgKE1ldHJpY1R5cGUgPSB7fSkpO1xuZXhwb3J0cy5NZXRyaWNUeXBlID0gTWV0cmljVHlwZTtcbiIsIlwidXNlIHN0cmljdFwiO1xudmFyIF9fZXh0ZW5kcyA9ICh0aGlzICYmIHRoaXMuX19leHRlbmRzKSB8fCBmdW5jdGlvbiAoZCwgYikge1xuICAgIGZvciAodmFyIHAgaW4gYikgaWYgKGIuaGFzT3duUHJvcGVydHkocCkpIGRbcF0gPSBiW3BdO1xuICAgIGZ1bmN0aW9uIF9fKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gZDsgfVxuICAgIGQucHJvdG90eXBlID0gYiA9PT0gbnVsbCA/IE9iamVjdC5jcmVhdGUoYikgOiAoX18ucHJvdG90eXBlID0gYi5wcm90b3R5cGUsIG5ldyBfXygpKTtcbn07XG52YXIgQWJzdHJhY3RFdmVudFJ1bGVfMSA9IHJlcXVpcmUoXCIuL0Fic3RyYWN0RXZlbnRSdWxlXCIpO1xudmFyIE1ldHJpY3NQcm9taXNlID0gKGZ1bmN0aW9uIChfc3VwZXIpIHtcbiAgICBfX2V4dGVuZHMoTWV0cmljc1Byb21pc2UsIF9zdXBlcik7XG4gICAgZnVuY3Rpb24gTWV0cmljc1Byb21pc2UobWV0cmljc0FnZ3JlZ2F0b3IpIHtcbiAgICAgICAgX3N1cGVyLmNhbGwodGhpcyk7XG4gICAgICAgIHRoaXMubWV0cmljc0FnZ3JlZ2F0b3IgPSBtZXRyaWNzQWdncmVnYXRvcjtcbiAgICAgICAgdGhpcy5zdGFydGVkID0gZmFsc2U7XG4gICAgfVxuICAgIE1ldHJpY3NQcm9taXNlLnByb3RvdHlwZS5yZXNvbHZlID0gZnVuY3Rpb24gKG1ldHJpY3NJZGVudGlmaWVyKSB7XG4gICAgICAgIHRoaXMubWV0cmljc0FnZ3JlZ2F0b3IucmVzb2x2ZU1ldHJpY3MobWV0cmljc0lkZW50aWZpZXIpO1xuICAgIH07XG4gICAgTWV0cmljc1Byb21pc2UucHJvdG90eXBlLnJlamVjdCA9IGZ1bmN0aW9uIChtZXRyaWNzSWRlbnRpZmllcikge1xuICAgICAgICBpZiAobWV0cmljc0lkZW50aWZpZXIucmVsaWFibGUgJiYgdGhpcy5zdGFydGVkKSB7XG4gICAgICAgICAgICB0aGlzLm5vdGlmeSgpO1xuICAgICAgICB9XG4gICAgfTtcbiAgICBNZXRyaWNzUHJvbWlzZS5wcm90b3R5cGUuc3RhcnQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuc3RhcnRlZCA9IHRydWU7XG4gICAgfTtcbiAgICBNZXRyaWNzUHJvbWlzZS5wcm90b3R5cGUuc3RvcCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5zdGFydGVkID0gZmFsc2U7XG4gICAgfTtcbiAgICByZXR1cm4gTWV0cmljc1Byb21pc2U7XG59KEFic3RyYWN0RXZlbnRSdWxlXzEuQWJzdHJhY3RFdmVudFJ1bGUpKTtcbmV4cG9ydHMuTWV0cmljc1Byb21pc2UgPSBNZXRyaWNzUHJvbWlzZTtcbiIsIlwidXNlIHN0cmljdFwiO1xudmFyIEV2ZW50VHlwZV8xID0gcmVxdWlyZShcIi4uL2V2ZW50SHVicy9FdmVudFR5cGVcIik7XG52YXIgTWV0cmljc1JlYWRlciA9IChmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gTWV0cmljc1JlYWRlcihub3RpZmljYXRpb25SdWxlcywgaHViLCBtZXRyaWNzQWdncmVnYXRvciwgcHJvY2Vzc29yLCBwcm9taXNlLCBpZGVudGlmaWNhdGlvblNlcnZpY2UpIHtcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcbiAgICAgICAgdGhpcy5ub3RpZmljYXRpb25SdWxlcyA9IG5vdGlmaWNhdGlvblJ1bGVzO1xuICAgICAgICB0aGlzLmh1YiA9IGh1YjtcbiAgICAgICAgdGhpcy5tZXRyaWNzQWdncmVnYXRvciA9IG1ldHJpY3NBZ2dyZWdhdG9yO1xuICAgICAgICB0aGlzLnByb2Nlc3NvciA9IHByb2Nlc3NvcjtcbiAgICAgICAgdGhpcy5wcm9taXNlID0gcHJvbWlzZTtcbiAgICAgICAgdGhpcy5pZGVudGlmaWNhdGlvblNlcnZpY2UgPSBpZGVudGlmaWNhdGlvblNlcnZpY2U7XG4gICAgICAgIG5vdGlmaWNhdGlvblJ1bGVzLmZvckVhY2goZnVuY3Rpb24gKHJ1bGUpIHsgcmV0dXJuIHJ1bGUucmVnaXN0ZXJOb3RpZmljYXRpb24oX3RoaXMucmVhZC5iaW5kKF90aGlzKSkuc3RhcnQoKTsgfSk7XG4gICAgICAgIHRoaXMuaHViLmJpbmQoW0V2ZW50VHlwZV8xLkV2ZW50VHlwZS5vbmxpbmUsIEV2ZW50VHlwZV8xLkV2ZW50VHlwZS5vZmZsaW5lXSwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgX3RoaXMuYXBwbHlPbk5vdGlmaWNhdGlvblJ1bGVzKGZ1bmN0aW9uIChydWxlKSB7IHJldHVybiBuYXZpZ2F0b3Iub25MaW5lID8gcnVsZS5zdGFydCgpIDogcnVsZS5zdG9wKCk7IH0pO1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgTWV0cmljc1JlYWRlci5wcm90b3R5cGUucmVhZCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIG1ldHJpY3NSZXN1bHQgPSB0aGlzLm1ldHJpY3NBZ2dyZWdhdG9yLmdldE1ldHJpY3MoKTtcbiAgICAgICAgaWYgKG1ldHJpY3NSZXN1bHQuaXNFbXB0eSkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuaWRlbnRpZmljYXRpb25TZXJ2aWNlLm1vZGlmeUlkZW50aWZpY2F0aW9uKCk7XG4gICAgICAgIHRoaXMucHJvY2Vzc29yLnByb2Nlc3MobWV0cmljc1Jlc3VsdC5tZXRyaWNzLCB7XG4gICAgICAgICAgICBpZDogbWV0cmljc1Jlc3VsdC5pZCxcbiAgICAgICAgICAgIHByb21pc2U6IHRoaXMucHJvbWlzZSxcbiAgICAgICAgICAgIHR5cGU6IG1ldHJpY3NSZXN1bHQudHlwZSxcbiAgICAgICAgICAgIHJlbGlhYmxlOiBtZXRyaWNzUmVzdWx0LnJlbGlhYmxlXG4gICAgICAgIH0pO1xuICAgIH07XG4gICAgTWV0cmljc1JlYWRlci5wcm90b3R5cGUuZGlzcG9zZSA9IGZ1bmN0aW9uIChzaHV0ZG93bikge1xuICAgICAgICBpZiAoIXNodXRkb3duKSB7XG4gICAgICAgICAgICB0aGlzLnJlYWQoKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmFwcGx5T25Ob3RpZmljYXRpb25SdWxlcyhmdW5jdGlvbiAocnVsZSkgeyByZXR1cm4gcnVsZS5zdG9wKCk7IH0pO1xuICAgIH07XG4gICAgTWV0cmljc1JlYWRlci5wcm90b3R5cGUuYXBwbHlPbk5vdGlmaWNhdGlvblJ1bGVzID0gZnVuY3Rpb24gKGFwcGx5KSB7XG4gICAgICAgIHRoaXMubm90aWZpY2F0aW9uUnVsZXMuZm9yRWFjaChmdW5jdGlvbiAocnVsZSkgeyByZXR1cm4gYXBwbHkocnVsZSk7IH0pO1xuICAgIH07XG4gICAgcmV0dXJuIE1ldHJpY3NSZWFkZXI7XG59KCkpO1xuZXhwb3J0cy5NZXRyaWNzUmVhZGVyID0gTWV0cmljc1JlYWRlcjtcbiIsIlwidXNlIHN0cmljdFwiO1xudmFyIE1ldHJpY1R5cGVfMSA9IHJlcXVpcmUoXCIuL01ldHJpY1R5cGVcIik7XG52YXIgRXZlbnRUeXBlXzEgPSByZXF1aXJlKFwiLi4vRXZlbnRIdWJzL0V2ZW50VHlwZVwiKTtcbnZhciBOdW1iZXJPZkNsaWNrc01ldHJpYyA9IChmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gTnVtYmVyT2ZDbGlja3NNZXRyaWMoaHViKSB7XG4gICAgICAgIHRoaXMuaHViID0gaHViO1xuICAgICAgICB0aGlzLmlzTGFzdCA9IGZhbHNlO1xuICAgICAgICB0aGlzLm9uZVRpbWUgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5jbGlja3NDb3VudGVyID0gMDtcbiAgICAgICAgdGhpcy5odWIuYmluZChbRXZlbnRUeXBlXzEuRXZlbnRUeXBlLm1vdXNldXBdLCB0aGlzLm9uTW91c2VVcEV2ZW50UmFpc2VkLmJpbmQodGhpcykpO1xuICAgICAgICB0aGlzLmh1Yi5iaW5kKFtFdmVudFR5cGVfMS5FdmVudFR5cGUubW91c2Vkb3duXSwgdGhpcy5vbk1vdXNlRG93bkV2ZW50UmFpc2VkLmJpbmQodGhpcykpO1xuICAgIH1cbiAgICBOdW1iZXJPZkNsaWNrc01ldHJpYy5wcm90b3R5cGUub25Nb3VzZURvd25FdmVudFJhaXNlZCA9IGZ1bmN0aW9uIChldikge1xuICAgICAgICB0aGlzLm1vdXNlRG93bkV2ZW50VGFyZ2V0ID0gZXYudGFyZ2V0O1xuICAgIH07XG4gICAgTnVtYmVyT2ZDbGlja3NNZXRyaWMucHJvdG90eXBlLm9uTW91c2VVcEV2ZW50UmFpc2VkID0gZnVuY3Rpb24gKGV2KSB7XG4gICAgICAgIGlmICh0aGlzLm1vdXNlRG93bkV2ZW50VGFyZ2V0ID09PSBldi50YXJnZXQpIHtcbiAgICAgICAgICAgIHRoaXMuY2xpY2tzQ291bnRlcisrO1xuICAgICAgICB9XG4gICAgfTtcbiAgICBOdW1iZXJPZkNsaWNrc01ldHJpYy5wcm90b3R5cGUuZ2V0TWV0cmljID0gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgdmFsdWU6IHRoaXMuY2xpY2tzQ291bnRlcixcbiAgICAgICAgICAgIHR5cGU6IE1ldHJpY1R5cGVfMS5NZXRyaWNUeXBlLm51bU9mQ2xpY2tzXG4gICAgICAgIH07XG4gICAgfTtcbiAgICByZXR1cm4gTnVtYmVyT2ZDbGlja3NNZXRyaWM7XG59KCkpO1xuZXhwb3J0cy5OdW1iZXJPZkNsaWNrc01ldHJpYyA9IE51bWJlck9mQ2xpY2tzTWV0cmljO1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgX19leHRlbmRzID0gKHRoaXMgJiYgdGhpcy5fX2V4dGVuZHMpIHx8IGZ1bmN0aW9uIChkLCBiKSB7XG4gICAgZm9yICh2YXIgcCBpbiBiKSBpZiAoYi5oYXNPd25Qcm9wZXJ0eShwKSkgZFtwXSA9IGJbcF07XG4gICAgZnVuY3Rpb24gX18oKSB7IHRoaXMuY29uc3RydWN0b3IgPSBkOyB9XG4gICAgZC5wcm90b3R5cGUgPSBiID09PSBudWxsID8gT2JqZWN0LmNyZWF0ZShiKSA6IChfXy5wcm90b3R5cGUgPSBiLnByb3RvdHlwZSwgbmV3IF9fKCkpO1xufTtcbnZhciBNZXRyaWNUeXBlXzEgPSByZXF1aXJlKFwiLi9NZXRyaWNUeXBlXCIpO1xudmFyIEFic3RyYWN0SWRlbnRpZmljYXRpb25NZXRyaWNfMSA9IHJlcXVpcmUoXCIuL0Fic3RyYWN0SWRlbnRpZmljYXRpb25NZXRyaWNcIik7XG52YXIgUGFnZVZpZXdJZGVudGlmaWNhdGlvbk1ldHJpYyA9IChmdW5jdGlvbiAoX3N1cGVyKSB7XG4gICAgX19leHRlbmRzKFBhZ2VWaWV3SWRlbnRpZmljYXRpb25NZXRyaWMsIF9zdXBlcik7XG4gICAgZnVuY3Rpb24gUGFnZVZpZXdJZGVudGlmaWNhdGlvbk1ldHJpYyhpZGVudGlmaWNhdGlvblNlcnZpY2UpIHtcbiAgICAgICAgX3N1cGVyLmNhbGwodGhpcywgaWRlbnRpZmljYXRpb25TZXJ2aWNlKTtcbiAgICAgICAgdGhpcy50eXBlID0gTWV0cmljVHlwZV8xLk1ldHJpY1R5cGUucGFnZXZpZXdJZDtcbiAgICB9XG4gICAgUGFnZVZpZXdJZGVudGlmaWNhdGlvbk1ldHJpYy5wcm90b3R5cGUuZ2V0TWV0cmljVmFsdWUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmlkZW50aWZpY2F0aW9uLlBhZ2VWaWV3O1xuICAgIH07XG4gICAgcmV0dXJuIFBhZ2VWaWV3SWRlbnRpZmljYXRpb25NZXRyaWM7XG59KEFic3RyYWN0SWRlbnRpZmljYXRpb25NZXRyaWNfMS5BYnN0cmFjdElkZW50aWZpY2F0aW9uTWV0cmljKSk7XG5leHBvcnRzLlBhZ2VWaWV3SWRlbnRpZmljYXRpb25NZXRyaWMgPSBQYWdlVmlld0lkZW50aWZpY2F0aW9uTWV0cmljO1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgX19leHRlbmRzID0gKHRoaXMgJiYgdGhpcy5fX2V4dGVuZHMpIHx8IGZ1bmN0aW9uIChkLCBiKSB7XG4gICAgZm9yICh2YXIgcCBpbiBiKSBpZiAoYi5oYXNPd25Qcm9wZXJ0eShwKSkgZFtwXSA9IGJbcF07XG4gICAgZnVuY3Rpb24gX18oKSB7IHRoaXMuY29uc3RydWN0b3IgPSBkOyB9XG4gICAgZC5wcm90b3R5cGUgPSBiID09PSBudWxsID8gT2JqZWN0LmNyZWF0ZShiKSA6IChfXy5wcm90b3R5cGUgPSBiLnByb3RvdHlwZSwgbmV3IF9fKCkpO1xufTtcbnZhciBBYnN0cmFjdEV2ZW50UnVsZV8xID0gcmVxdWlyZShcIi4vQWJzdHJhY3RFdmVudFJ1bGVcIik7XG52YXIgUGVyaW9kaWNhbE5vdGlmaWVyUnVsZSA9IChmdW5jdGlvbiAoX3N1cGVyKSB7XG4gICAgX19leHRlbmRzKFBlcmlvZGljYWxOb3RpZmllclJ1bGUsIF9zdXBlcik7XG4gICAgZnVuY3Rpb24gUGVyaW9kaWNhbE5vdGlmaWVyUnVsZShjb25maWcpIHtcbiAgICAgICAgX3N1cGVyLmNhbGwodGhpcyk7XG4gICAgICAgIHRoaXMuY29uZmlnID0gY29uZmlnO1xuICAgICAgICB0aGlzLmZpcnN0RmliTnVtYmVyID0gMDtcbiAgICAgICAgdGhpcy5zZWNvbmRGaWJOdW1iZXIgPSAxO1xuICAgICAgICB0aGlzLm1heEludGVydmFsUmVhY2hlZCA9IGZhbHNlO1xuICAgICAgICB0aGlzLm1heEZldGNoSW50ZXJ2YWwgPSB0aGlzLmNvbmZpZy5tZXRyaWNzLm1heEZldGNoSW50ZXJ2YWw7XG4gICAgfVxuICAgIFBlcmlvZGljYWxOb3RpZmllclJ1bGUucHJvdG90eXBlLnN0YXJ0ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgICB2YXIgaW50ZXJ2YWwgPSB0aGlzLm1heEludGVydmFsUmVhY2hlZCA/IHRoaXMubWF4RmV0Y2hJbnRlcnZhbCA6IHRoaXMuZ2V0RmV0Y2hJbnRlcnZhbCgpO1xuICAgICAgICB0aGlzLnRpbWVvdXRJZCA9IHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgX3RoaXMubm90aWZ5KCk7XG4gICAgICAgICAgICBfdGhpcy5zdGFydCgpO1xuICAgICAgICB9LCBpbnRlcnZhbCk7XG4gICAgfTtcbiAgICBQZXJpb2RpY2FsTm90aWZpZXJSdWxlLnByb3RvdHlwZS5zdG9wID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBjbGVhckludGVydmFsKHRoaXMudGltZW91dElkKTtcbiAgICB9O1xuICAgIFBlcmlvZGljYWxOb3RpZmllclJ1bGUucHJvdG90eXBlLmRpc3Bvc2UgPSBmdW5jdGlvbiAoc2h1dGRvd24pIHtcbiAgICAgICAgdGhpcy5zdG9wKCk7XG4gICAgfTtcbiAgICBQZXJpb2RpY2FsTm90aWZpZXJSdWxlLnByb3RvdHlwZS5nZXRGZXRjaEludGVydmFsID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgZmliTnVtYmVyID0gdGhpcy5maXJzdEZpYk51bWJlciArIHRoaXMuc2Vjb25kRmliTnVtYmVyO1xuICAgICAgICB2YXIgaW50ZXJ2YWwgPSBmaWJOdW1iZXIgKiAxMDAwO1xuICAgICAgICBpZiAoaW50ZXJ2YWwgPiB0aGlzLm1heEZldGNoSW50ZXJ2YWwpIHtcbiAgICAgICAgICAgIHRoaXMubWF4SW50ZXJ2YWxSZWFjaGVkID0gdHJ1ZTtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLm1heEZldGNoSW50ZXJ2YWw7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5maXJzdEZpYk51bWJlciA9IHRoaXMuc2Vjb25kRmliTnVtYmVyO1xuICAgICAgICB0aGlzLnNlY29uZEZpYk51bWJlciA9IGZpYk51bWJlcjtcbiAgICAgICAgcmV0dXJuIGludGVydmFsO1xuICAgIH07XG4gICAgcmV0dXJuIFBlcmlvZGljYWxOb3RpZmllclJ1bGU7XG59KEFic3RyYWN0RXZlbnRSdWxlXzEuQWJzdHJhY3RFdmVudFJ1bGUpKTtcbmV4cG9ydHMuUGVyaW9kaWNhbE5vdGlmaWVyUnVsZSA9IFBlcmlvZGljYWxOb3RpZmllclJ1bGU7XG4iLCJcInVzZSBzdHJpY3RcIjtcbnZhciBfX2V4dGVuZHMgPSAodGhpcyAmJiB0aGlzLl9fZXh0ZW5kcykgfHwgZnVuY3Rpb24gKGQsIGIpIHtcbiAgICBmb3IgKHZhciBwIGluIGIpIGlmIChiLmhhc093blByb3BlcnR5KHApKSBkW3BdID0gYltwXTtcbiAgICBmdW5jdGlvbiBfXygpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IGQ7IH1cbiAgICBkLnByb3RvdHlwZSA9IGIgPT09IG51bGwgPyBPYmplY3QuY3JlYXRlKGIpIDogKF9fLnByb3RvdHlwZSA9IGIucHJvdG90eXBlLCBuZXcgX18oKSk7XG59O1xudmFyIE1ldHJpY1R5cGVfMSA9IHJlcXVpcmUoXCIuL01ldHJpY1R5cGVcIik7XG52YXIgQWJzdHJhY3RNZXRyaWNfMSA9IHJlcXVpcmUoXCIuL0Fic3RyYWN0TWV0cmljXCIpO1xudmFyIFByb2plY3RJZE1ldHJpYyA9IChmdW5jdGlvbiAoX3N1cGVyKSB7XG4gICAgX19leHRlbmRzKFByb2plY3RJZE1ldHJpYywgX3N1cGVyKTtcbiAgICBmdW5jdGlvbiBQcm9qZWN0SWRNZXRyaWMocHJvamVjdElkKSB7XG4gICAgICAgIF9zdXBlci5jYWxsKHRoaXMsIHRydWUsIGZhbHNlKTtcbiAgICAgICAgdGhpcy5wcm9qZWN0SWQgPSBwcm9qZWN0SWQ7XG4gICAgICAgIHRoaXMudHlwZSA9IE1ldHJpY1R5cGVfMS5NZXRyaWNUeXBlLnByb2plY3RJZDtcbiAgICB9XG4gICAgUHJvamVjdElkTWV0cmljLnByb3RvdHlwZS5nZXRNZXRyaWNWYWx1ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucHJvamVjdElkO1xuICAgIH07XG4gICAgcmV0dXJuIFByb2plY3RJZE1ldHJpYztcbn0oQWJzdHJhY3RNZXRyaWNfMS5BYnN0cmFjdE1ldHJpYykpO1xuZXhwb3J0cy5Qcm9qZWN0SWRNZXRyaWMgPSBQcm9qZWN0SWRNZXRyaWM7XG4iLCJcInVzZSBzdHJpY3RcIjtcbnZhciBfX2V4dGVuZHMgPSAodGhpcyAmJiB0aGlzLl9fZXh0ZW5kcykgfHwgZnVuY3Rpb24gKGQsIGIpIHtcbiAgICBmb3IgKHZhciBwIGluIGIpIGlmIChiLmhhc093blByb3BlcnR5KHApKSBkW3BdID0gYltwXTtcbiAgICBmdW5jdGlvbiBfXygpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IGQ7IH1cbiAgICBkLnByb3RvdHlwZSA9IGIgPT09IG51bGwgPyBPYmplY3QuY3JlYXRlKGIpIDogKF9fLnByb3RvdHlwZSA9IGIucHJvdG90eXBlLCBuZXcgX18oKSk7XG59O1xudmFyIE1ldHJpY1R5cGVfMSA9IHJlcXVpcmUoXCIuL01ldHJpY1R5cGVcIik7XG52YXIgQWJzdHJhY3RNZXRyaWNfMSA9IHJlcXVpcmUoXCIuL0Fic3RyYWN0TWV0cmljXCIpO1xudmFyIFJlc29sdXRpb25IZWlnaHRNZXRyaWMgPSAoZnVuY3Rpb24gKF9zdXBlcikge1xuICAgIF9fZXh0ZW5kcyhSZXNvbHV0aW9uSGVpZ2h0TWV0cmljLCBfc3VwZXIpO1xuICAgIGZ1bmN0aW9uIFJlc29sdXRpb25IZWlnaHRNZXRyaWMoKSB7XG4gICAgICAgIF9zdXBlci5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICAgICAgICB0aGlzLnR5cGUgPSBNZXRyaWNUeXBlXzEuTWV0cmljVHlwZS5zY3JlZW5ZO1xuICAgIH1cbiAgICBSZXNvbHV0aW9uSGVpZ2h0TWV0cmljLnByb3RvdHlwZS5nZXRNZXRyaWNWYWx1ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIHdpbmRvdy5pbm5lckhlaWdodDtcbiAgICB9O1xuICAgIHJldHVybiBSZXNvbHV0aW9uSGVpZ2h0TWV0cmljO1xufShBYnN0cmFjdE1ldHJpY18xLkFic3RyYWN0TWV0cmljKSk7XG5leHBvcnRzLlJlc29sdXRpb25IZWlnaHRNZXRyaWMgPSBSZXNvbHV0aW9uSGVpZ2h0TWV0cmljO1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgX19leHRlbmRzID0gKHRoaXMgJiYgdGhpcy5fX2V4dGVuZHMpIHx8IGZ1bmN0aW9uIChkLCBiKSB7XG4gICAgZm9yICh2YXIgcCBpbiBiKSBpZiAoYi5oYXNPd25Qcm9wZXJ0eShwKSkgZFtwXSA9IGJbcF07XG4gICAgZnVuY3Rpb24gX18oKSB7IHRoaXMuY29uc3RydWN0b3IgPSBkOyB9XG4gICAgZC5wcm90b3R5cGUgPSBiID09PSBudWxsID8gT2JqZWN0LmNyZWF0ZShiKSA6IChfXy5wcm90b3R5cGUgPSBiLnByb3RvdHlwZSwgbmV3IF9fKCkpO1xufTtcbnZhciBNZXRyaWNUeXBlXzEgPSByZXF1aXJlKFwiLi9NZXRyaWNUeXBlXCIpO1xudmFyIEFic3RyYWN0TWV0cmljXzEgPSByZXF1aXJlKFwiLi9BYnN0cmFjdE1ldHJpY1wiKTtcbnZhciBSZXNvbHV0aW9uV2lkdGhNZXRyaWMgPSAoZnVuY3Rpb24gKF9zdXBlcikge1xuICAgIF9fZXh0ZW5kcyhSZXNvbHV0aW9uV2lkdGhNZXRyaWMsIF9zdXBlcik7XG4gICAgZnVuY3Rpb24gUmVzb2x1dGlvbldpZHRoTWV0cmljKCkge1xuICAgICAgICBfc3VwZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgICAgICAgdGhpcy50eXBlID0gTWV0cmljVHlwZV8xLk1ldHJpY1R5cGUuc2NyZWVuWDtcbiAgICB9XG4gICAgUmVzb2x1dGlvbldpZHRoTWV0cmljLnByb3RvdHlwZS5nZXRNZXRyaWNWYWx1ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIHdpbmRvdy5pbm5lcldpZHRoO1xuICAgIH07XG4gICAgcmV0dXJuIFJlc29sdXRpb25XaWR0aE1ldHJpYztcbn0oQWJzdHJhY3RNZXRyaWNfMS5BYnN0cmFjdE1ldHJpYykpO1xuZXhwb3J0cy5SZXNvbHV0aW9uV2lkdGhNZXRyaWMgPSBSZXNvbHV0aW9uV2lkdGhNZXRyaWM7XG4iLCJcInVzZSBzdHJpY3RcIjtcbnZhciBNZXRyaWNUeXBlXzEgPSByZXF1aXJlKFwiLi9NZXRyaWNUeXBlXCIpO1xudmFyIEV2ZW50VHlwZV8xID0gcmVxdWlyZShcIi4uL2V2ZW50SHVicy9FdmVudFR5cGVcIik7XG52YXIgU2Nyb2xsUmVhY2hNZXRyaWMgPSAoZnVuY3Rpb24gKCkge1xuICAgIGZ1bmN0aW9uIFNjcm9sbFJlYWNoTWV0cmljKGh1Yikge1xuICAgICAgICB0aGlzLmh1YiA9IGh1YjtcbiAgICAgICAgdGhpcy5pc0xhc3QgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5vbmVUaW1lID0gZmFsc2U7XG4gICAgICAgIHRoaXMuYmluZGVkT25FdmVudFJhaXNlZCA9IHRoaXMub25FdmVudFJhaXNlZC5iaW5kKHRoaXMpO1xuICAgICAgICB0aGlzLm1heFNjcm9sbFJlYWNoID0gMDtcbiAgICAgICAgdGhpcy5odWIuYmluZChbRXZlbnRUeXBlXzEuRXZlbnRUeXBlLnNjcm9sbCwgRXZlbnRUeXBlXzEuRXZlbnRUeXBlLnJlc2l6ZV0sIHRoaXMuYmluZGVkT25FdmVudFJhaXNlZCk7XG4gICAgfVxuICAgIFNjcm9sbFJlYWNoTWV0cmljLnByb3RvdHlwZS5vbkV2ZW50UmFpc2VkID0gZnVuY3Rpb24gKGV2KSB7XG4gICAgICAgIHZhciBjbGllbnRIZWlnaHQgPSB3aW5kb3cuaW5uZXJIZWlnaHQgfHwgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmNsaWVudEhlaWdodCB8fCBkb2N1bWVudC5ib2R5LmNsaWVudEhlaWdodDtcbiAgICAgICAgdmFyIHNjcm9sbFRvcCA9IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5zY3JvbGxUb3AgfHwgZG9jdW1lbnQuYm9keS5zY3JvbGxUb3A7XG4gICAgICAgIHZhciBzY3JvbGxIZWlnaHQgPSBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuc2Nyb2xsSGVpZ2h0IHx8IGRvY3VtZW50LmJvZHkuc2Nyb2xsSGVpZ2h0O1xuICAgICAgICB2YXIgc2Nyb2xsUmVhY2ggPSBzY3JvbGxUb3AgLyAoc2Nyb2xsSGVpZ2h0IC0gY2xpZW50SGVpZ2h0KSAqIDEwMDtcbiAgICAgICAgc2Nyb2xsUmVhY2ggPSBNYXRoLmFicyhNYXRoLnJvdW5kKE1hdGgubWluKDEwMCwgc2Nyb2xsUmVhY2gpKSk7XG4gICAgICAgIHRoaXMubWF4U2Nyb2xsUmVhY2ggPSBNYXRoLm1heChzY3JvbGxSZWFjaCwgdGhpcy5tYXhTY3JvbGxSZWFjaCk7XG4gICAgICAgIGlmICh0aGlzLm1heFNjcm9sbFJlYWNoID09PSAxMDApIHtcbiAgICAgICAgICAgIHRoaXMuaHViLnVuYmluZChbRXZlbnRUeXBlXzEuRXZlbnRUeXBlLnNjcm9sbCwgRXZlbnRUeXBlXzEuRXZlbnRUeXBlLnJlc2l6ZV0sIHRoaXMuYmluZGVkT25FdmVudFJhaXNlZCk7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIFNjcm9sbFJlYWNoTWV0cmljLnByb3RvdHlwZS5nZXRNZXRyaWMgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICB2YWx1ZTogdGhpcy5tYXhTY3JvbGxSZWFjaCxcbiAgICAgICAgICAgIHR5cGU6IE1ldHJpY1R5cGVfMS5NZXRyaWNUeXBlLnNjcm9sbFJlYWNoXG4gICAgICAgIH07XG4gICAgfTtcbiAgICByZXR1cm4gU2Nyb2xsUmVhY2hNZXRyaWM7XG59KCkpO1xuZXhwb3J0cy5TY3JvbGxSZWFjaE1ldHJpYyA9IFNjcm9sbFJlYWNoTWV0cmljO1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgX19leHRlbmRzID0gKHRoaXMgJiYgdGhpcy5fX2V4dGVuZHMpIHx8IGZ1bmN0aW9uIChkLCBiKSB7XG4gICAgZm9yICh2YXIgcCBpbiBiKSBpZiAoYi5oYXNPd25Qcm9wZXJ0eShwKSkgZFtwXSA9IGJbcF07XG4gICAgZnVuY3Rpb24gX18oKSB7IHRoaXMuY29uc3RydWN0b3IgPSBkOyB9XG4gICAgZC5wcm90b3R5cGUgPSBiID09PSBudWxsID8gT2JqZWN0LmNyZWF0ZShiKSA6IChfXy5wcm90b3R5cGUgPSBiLnByb3RvdHlwZSwgbmV3IF9fKCkpO1xufTtcbnZhciBNZXRyaWNUeXBlXzEgPSByZXF1aXJlKFwiLi9NZXRyaWNUeXBlXCIpO1xudmFyIEV2ZW50VHlwZV8xID0gcmVxdWlyZShcIi4uL2V2ZW50SHVicy9FdmVudFR5cGVcIik7XG52YXIgQWJzdHJhY3RBY3Rpdml0eU1ldHJpY18xID0gcmVxdWlyZShcIi4vQWJzdHJhY3RBY3Rpdml0eU1ldHJpY1wiKTtcbnZhciBUaW1lT25QYWdlTWV0cmljID0gKGZ1bmN0aW9uIChfc3VwZXIpIHtcbiAgICBfX2V4dGVuZHMoVGltZU9uUGFnZU1ldHJpYywgX3N1cGVyKTtcbiAgICBmdW5jdGlvbiBUaW1lT25QYWdlTWV0cmljKGh1YiwgdGltaW5nKSB7XG4gICAgICAgIF9zdXBlci5jYWxsKHRoaXMsIHRpbWluZyk7XG4gICAgICAgIHRoaXMuaHViID0gaHViO1xuICAgICAgICB0aGlzLmh1Yi5iaW5kKFtFdmVudFR5cGVfMS5FdmVudFR5cGUudmlzaWJpbGl0eWNoYW5nZV0sIHRoaXMub25FdmVudFJhaXNlZC5iaW5kKHRoaXMpKTtcbiAgICB9XG4gICAgVGltZU9uUGFnZU1ldHJpYy5wcm90b3R5cGUuZ2V0TWV0cmljVHlwZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIE1ldHJpY1R5cGVfMS5NZXRyaWNUeXBlLnRpbWVPblBhZ2U7XG4gICAgfTtcbiAgICBUaW1lT25QYWdlTWV0cmljLnByb3RvdHlwZS5vbkV2ZW50UmFpc2VkID0gZnVuY3Rpb24gKGV2KSB7XG4gICAgICAgIGlmIChkb2N1bWVudC5oaWRkZW4pIHtcbiAgICAgICAgICAgIHRoaXMubWFya0luYWN0aXZpdHkoKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMubWFya0FjdGl2aXR5KCk7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIHJldHVybiBUaW1lT25QYWdlTWV0cmljO1xufShBYnN0cmFjdEFjdGl2aXR5TWV0cmljXzEuQWJzdHJhY3RBY3Rpdml0eU1ldHJpYykpO1xuZXhwb3J0cy5UaW1lT25QYWdlTWV0cmljID0gVGltZU9uUGFnZU1ldHJpYztcbiIsIlwidXNlIHN0cmljdFwiO1xudmFyIF9fZXh0ZW5kcyA9ICh0aGlzICYmIHRoaXMuX19leHRlbmRzKSB8fCBmdW5jdGlvbiAoZCwgYikge1xuICAgIGZvciAodmFyIHAgaW4gYikgaWYgKGIuaGFzT3duUHJvcGVydHkocCkpIGRbcF0gPSBiW3BdO1xuICAgIGZ1bmN0aW9uIF9fKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gZDsgfVxuICAgIGQucHJvdG90eXBlID0gYiA9PT0gbnVsbCA/IE9iamVjdC5jcmVhdGUoYikgOiAoX18ucHJvdG90eXBlID0gYi5wcm90b3R5cGUsIG5ldyBfXygpKTtcbn07XG52YXIgTWV0cmljVHlwZV8xID0gcmVxdWlyZShcIi4vTWV0cmljVHlwZVwiKTtcbnZhciBBYnN0cmFjdE1ldHJpY18xID0gcmVxdWlyZShcIi4vQWJzdHJhY3RNZXRyaWNcIik7XG52YXIgVmVyc2lvbk1ldHJpYyA9IChmdW5jdGlvbiAoX3N1cGVyKSB7XG4gICAgX19leHRlbmRzKFZlcnNpb25NZXRyaWMsIF9zdXBlcik7XG4gICAgZnVuY3Rpb24gVmVyc2lvbk1ldHJpYygpIHtcbiAgICAgICAgX3N1cGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gICAgICAgIHRoaXMudHlwZSA9IE1ldHJpY1R5cGVfMS5NZXRyaWNUeXBlLnZlcnNpb247XG4gICAgfVxuICAgIFZlcnNpb25NZXRyaWMucHJvdG90eXBlLmdldE1ldHJpY1ZhbHVlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gMTtcbiAgICB9O1xuICAgIHJldHVybiBWZXJzaW9uTWV0cmljO1xufShBYnN0cmFjdE1ldHJpY18xLkFic3RyYWN0TWV0cmljKSk7XG5leHBvcnRzLlZlcnNpb25NZXRyaWMgPSBWZXJzaW9uTWV0cmljO1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgX19leHRlbmRzID0gKHRoaXMgJiYgdGhpcy5fX2V4dGVuZHMpIHx8IGZ1bmN0aW9uIChkLCBiKSB7XG4gICAgZm9yICh2YXIgcCBpbiBiKSBpZiAoYi5oYXNPd25Qcm9wZXJ0eShwKSkgZFtwXSA9IGJbcF07XG4gICAgZnVuY3Rpb24gX18oKSB7IHRoaXMuY29uc3RydWN0b3IgPSBkOyB9XG4gICAgZC5wcm90b3R5cGUgPSBiID09PSBudWxsID8gT2JqZWN0LmNyZWF0ZShiKSA6IChfXy5wcm90b3R5cGUgPSBiLnByb3RvdHlwZSwgbmV3IF9fKCkpO1xufTtcbnZhciBNZXRyaWNUeXBlXzEgPSByZXF1aXJlKFwiLi9NZXRyaWNUeXBlXCIpO1xudmFyIEFic3RyYWN0SWRlbnRpZmljYXRpb25NZXRyaWNfMSA9IHJlcXVpcmUoXCIuL0Fic3RyYWN0SWRlbnRpZmljYXRpb25NZXRyaWNcIik7XG52YXIgVmlzaXRJZGVudGlmaWNhdGlvbk1ldHJpYyA9IChmdW5jdGlvbiAoX3N1cGVyKSB7XG4gICAgX19leHRlbmRzKFZpc2l0SWRlbnRpZmljYXRpb25NZXRyaWMsIF9zdXBlcik7XG4gICAgZnVuY3Rpb24gVmlzaXRJZGVudGlmaWNhdGlvbk1ldHJpYyhpZGVudGlmaWNhdGlvblNlcnZpY2UpIHtcbiAgICAgICAgX3N1cGVyLmNhbGwodGhpcywgaWRlbnRpZmljYXRpb25TZXJ2aWNlKTtcbiAgICAgICAgdGhpcy50eXBlID0gTWV0cmljVHlwZV8xLk1ldHJpY1R5cGUudmlzaXRJZDtcbiAgICB9XG4gICAgVmlzaXRJZGVudGlmaWNhdGlvbk1ldHJpYy5wcm90b3R5cGUuZ2V0TWV0cmljVmFsdWUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmlkZW50aWZpY2F0aW9uLlZpc2l0O1xuICAgIH07XG4gICAgcmV0dXJuIFZpc2l0SWRlbnRpZmljYXRpb25NZXRyaWM7XG59KEFic3RyYWN0SWRlbnRpZmljYXRpb25NZXRyaWNfMS5BYnN0cmFjdElkZW50aWZpY2F0aW9uTWV0cmljKSk7XG5leHBvcnRzLlZpc2l0SWRlbnRpZmljYXRpb25NZXRyaWMgPSBWaXNpdElkZW50aWZpY2F0aW9uTWV0cmljO1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgX19leHRlbmRzID0gKHRoaXMgJiYgdGhpcy5fX2V4dGVuZHMpIHx8IGZ1bmN0aW9uIChkLCBiKSB7XG4gICAgZm9yICh2YXIgcCBpbiBiKSBpZiAoYi5oYXNPd25Qcm9wZXJ0eShwKSkgZFtwXSA9IGJbcF07XG4gICAgZnVuY3Rpb24gX18oKSB7IHRoaXMuY29uc3RydWN0b3IgPSBkOyB9XG4gICAgZC5wcm90b3R5cGUgPSBiID09PSBudWxsID8gT2JqZWN0LmNyZWF0ZShiKSA6IChfXy5wcm90b3R5cGUgPSBiLnByb3RvdHlwZSwgbmV3IF9fKCkpO1xufTtcbnZhciBNZXRyaWNUeXBlXzEgPSByZXF1aXJlKFwiLi9NZXRyaWNUeXBlXCIpO1xudmFyIEFic3RyYWN0SWRlbnRpZmljYXRpb25NZXRyaWNfMSA9IHJlcXVpcmUoXCIuL0Fic3RyYWN0SWRlbnRpZmljYXRpb25NZXRyaWNcIik7XG52YXIgVmlzaXRvcklkZW50aWZpY2F0aW9uTWV0cmljID0gKGZ1bmN0aW9uIChfc3VwZXIpIHtcbiAgICBfX2V4dGVuZHMoVmlzaXRvcklkZW50aWZpY2F0aW9uTWV0cmljLCBfc3VwZXIpO1xuICAgIGZ1bmN0aW9uIFZpc2l0b3JJZGVudGlmaWNhdGlvbk1ldHJpYyhpZGVudGlmaWNhdGlvblNlcnZpY2UpIHtcbiAgICAgICAgX3N1cGVyLmNhbGwodGhpcywgaWRlbnRpZmljYXRpb25TZXJ2aWNlKTtcbiAgICAgICAgdGhpcy50eXBlID0gTWV0cmljVHlwZV8xLk1ldHJpY1R5cGUudmlzaXRvcklkO1xuICAgIH1cbiAgICBWaXNpdG9ySWRlbnRpZmljYXRpb25NZXRyaWMucHJvdG90eXBlLmdldE1ldHJpY1ZhbHVlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5pZGVudGlmaWNhdGlvbi5WaXNpdG9yO1xuICAgIH07XG4gICAgcmV0dXJuIFZpc2l0b3JJZGVudGlmaWNhdGlvbk1ldHJpYztcbn0oQWJzdHJhY3RJZGVudGlmaWNhdGlvbk1ldHJpY18xLkFic3RyYWN0SWRlbnRpZmljYXRpb25NZXRyaWMpKTtcbmV4cG9ydHMuVmlzaXRvcklkZW50aWZpY2F0aW9uTWV0cmljID0gVmlzaXRvcklkZW50aWZpY2F0aW9uTWV0cmljO1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgQ29va2llc1NlcnZpY2UgPSAoZnVuY3Rpb24gKCkge1xuICAgIGZ1bmN0aW9uIENvb2tpZXNTZXJ2aWNlKCkge1xuICAgIH1cbiAgICBDb29raWVzU2VydmljZS5wcm90b3R5cGUuZGVsZXRlID0gZnVuY3Rpb24gKGNvb2tpZSkge1xuICAgICAgICB0aGlzLndyaXRlKGNvb2tpZSwgXCJcIiwgLTEpO1xuICAgIH07XG4gICAgQ29va2llc1NlcnZpY2UucHJvdG90eXBlLnJlYWQgPSBmdW5jdGlvbiAoY29va2llKSB7XG4gICAgICAgIHZhciB0byA9IDA7XG4gICAgICAgIHZhciBmcm9tID0gMDtcbiAgICAgICAgdmFyIHR1cGxlcyA9IGRvY3VtZW50LmNvb2tpZS5zcGxpdChcIjtcIik7XG4gICAgICAgIGNvb2tpZSArPSBcIj1cIjtcbiAgICAgICAgZm9yICh2YXIgX2kgPSAwLCB0dXBsZXNfMSA9IHR1cGxlczsgX2kgPCB0dXBsZXNfMS5sZW5ndGg7IF9pKyspIHtcbiAgICAgICAgICAgIHZhciBrZXlWYWx1ZSA9IHR1cGxlc18xW19pXTtcbiAgICAgICAgICAgIGlmIChrZXlWYWx1ZS50cmltKCkuaW5kZXhPZihjb29raWUpID09PSAwKSB7XG4gICAgICAgICAgICAgICAgdG8gPSBmcm9tICsga2V5VmFsdWUubGVuZ3RoO1xuICAgICAgICAgICAgICAgIGZyb20gPSBmcm9tICsga2V5VmFsdWUuc3BsaXQoXCI9XCIpWzBdLmxlbmd0aCArIDE7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGRvY3VtZW50LmNvb2tpZS5zdWJzdHJpbmcoZnJvbSwgdG8pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZnJvbSArPSBrZXlWYWx1ZS5sZW5ndGggKyAxO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgIH07XG4gICAgQ29va2llc1NlcnZpY2UucHJvdG90eXBlLndyaXRlID0gZnVuY3Rpb24gKGNvb2tpZSwgdmFsdWUsIGRheXMpIHtcbiAgICAgICAgdmFyIGV4cGlyZXMgPSBcIlwiO1xuICAgICAgICBpZiAoZGF5cykge1xuICAgICAgICAgICAgdmFyIGRhdGUgPSBuZXcgRGF0ZSgpO1xuICAgICAgICAgICAgZGF0ZS5zZXRUaW1lKGRhdGUuZ2V0VGltZSgpICsgKGRheXMgKiA4NjQwMDAwMCkpO1xuICAgICAgICAgICAgZXhwaXJlcyA9IFwiOyBleHBpcmVzPVwiICsgZGF0ZS50b1VUQ1N0cmluZygpO1xuICAgICAgICB9XG4gICAgICAgIGRvY3VtZW50LmNvb2tpZSA9IGNvb2tpZSArIFwiPVwiICsgdmFsdWUgKyBleHBpcmVzICsgXCI7IHBhdGg9LztcIjtcbiAgICB9O1xuICAgIHJldHVybiBDb29raWVzU2VydmljZTtcbn0oKSk7XG5leHBvcnRzLkNvb2tpZXNTZXJ2aWNlID0gQ29va2llc1NlcnZpY2U7XG4iLCJcInVzZSBzdHJpY3RcIjtcbnZhciBFdmVudFR5cGVfMSA9IHJlcXVpcmUoXCIuLi8uLi9ldmVudEh1YnMvRXZlbnRUeXBlXCIpO1xudmFyIERpc3Bvc2VyID0gKGZ1bmN0aW9uICgpIHtcbiAgICBmdW5jdGlvbiBEaXNwb3NlcihodWIsIGNvbnRhaW5lciwgY29uZmlnLCBhcHApIHtcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcbiAgICAgICAgdGhpcy5jb250YWluZXIgPSBjb250YWluZXI7XG4gICAgICAgIHRoaXMuY29uZmlnID0gY29uZmlnO1xuICAgICAgICB0aGlzLmFwcCA9IGFwcDtcbiAgICAgICAgdmFyIGJpbmRlZERpc3Bvc2UgPSB0aGlzLmRpc3Bvc2UuYmluZCh0aGlzKTtcbiAgICAgICAgdGhpcy50cmFuc3BvcnRDaGFubmVsID0gY29uZmlnLnRyYW5zcG9ydC5tYWluQ2hhbm5lbDtcbiAgICAgICAgc2V0VGltZW91dChiaW5kZWREaXNwb3NlLCBjb25maWcuaWRlbnRpZmljYXRpb24udmlzaXRUaW1lU3Bhbik7XG4gICAgICAgIGh1Yi5iaW5kKFtFdmVudFR5cGVfMS5FdmVudFR5cGUudW5sb2FkLCBFdmVudFR5cGVfMS5FdmVudFR5cGUuYmVmb3JldW5sb2FkXSwgZnVuY3Rpb24gKCkgeyByZXR1cm4gX3RoaXMuZGlzcG9zZSgpOyB9KTtcbiAgICAgICAgdGhpcy5jaGFubmVsRmFjdG9yeSA9IHRoaXMucmVzb2x2ZUNoYW5uZWwodGhpcy50cmFuc3BvcnRDaGFubmVsKTtcbiAgICB9XG4gICAgRGlzcG9zZXIucHJvdG90eXBlLnJlc29sdmVDaGFubmVsID0gZnVuY3Rpb24gKGNoYW5uZWxUeXBlKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmNvbnRhaW5lci5yZXNvbHZlRmFjdG9yeShjaGFubmVsVHlwZSArIFwiIGNoYW5uZWxcIik7XG4gICAgfTtcbiAgICBEaXNwb3Nlci5wcm90b3R5cGUuZ2V0U2VyaWFsaXplciA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuY29udGFpbmVyLnJlc29sdmUodGhpcy50cmFuc3BvcnRDaGFubmVsICsgXCIgc2VyaWFsaXplclwiKTtcbiAgICB9O1xuICAgIERpc3Bvc2VyLnByb3RvdHlwZS5nZXRDaGFubmVsID0gZnVuY3Rpb24gKGNoYW5uZWxTZXR0aW5ncykge1xuICAgICAgICByZXR1cm4gdGhpcy5jaGFubmVsRmFjdG9yeShjaGFubmVsU2V0dGluZ3MpO1xuICAgIH07XG4gICAgRGlzcG9zZXIucHJvdG90eXBlLmRpc3Bvc2UgPSBmdW5jdGlvbiAoc2h1dGRvd24pIHtcbiAgICAgICAgdGhpcy50cmFuc3BvcnRDaGFubmVsID0gdGhpcy5jb25maWcudHJhbnNwb3J0LnRlcm1pbmFsQ2hhbm5lbDtcbiAgICAgICAgdGhpcy5tZXRyaWNBZ2dyZWdhdG9yLnRlcm1pbmF0ZSgpO1xuICAgICAgICB0aGlzLmNoYW5uZWxGYWN0b3J5ID0gdGhpcy5yZXNvbHZlQ2hhbm5lbCh0aGlzLnRyYW5zcG9ydENoYW5uZWwpO1xuICAgICAgICB0aGlzLmNvbnRhaW5lci5kaXNwb3NlKHNodXRkb3duKTtcbiAgICAgICAgdGhpcy5hcHAuc3RvcCgpO1xuICAgIH07XG4gICAgRGlzcG9zZXIucHJvdG90eXBlLnNodXRkb3duID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLmRpc3Bvc2UodHJ1ZSk7XG4gICAgfTtcbiAgICByZXR1cm4gRGlzcG9zZXI7XG59KCkpO1xuZXhwb3J0cy5EaXNwb3NlciA9IERpc3Bvc2VyO1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgSWRHZW5lcmF0b3IgPSAoZnVuY3Rpb24gKCkge1xuICAgIGZ1bmN0aW9uIElkR2VuZXJhdG9yKCkge1xuICAgIH1cbiAgICBJZEdlbmVyYXRvci5wcm90b3R5cGUuZ2VuZXJhdGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiBJZEdlbmVyYXRvci5tYXhOdW1iZXIpO1xuICAgIH07XG4gICAgSWRHZW5lcmF0b3IubWF4TnVtYmVyID0gTWF0aC5wb3coMiwgNTMpIC0gMTtcbiAgICByZXR1cm4gSWRHZW5lcmF0b3I7XG59KCkpO1xuZXhwb3J0cy5JZEdlbmVyYXRvciA9IElkR2VuZXJhdG9yO1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgT2JqZWN0RXh0ZW5kZXJfMSA9IHJlcXVpcmUoXCIuLi9vYmplY3RFeHRlbmRlci9PYmplY3RFeHRlbmRlclwiKTtcbnZhciBJZGVudGlmaWNhdGlvblNlcnZpY2UgPSAoZnVuY3Rpb24gKCkge1xuICAgIGZ1bmN0aW9uIElkZW50aWZpY2F0aW9uU2VydmljZShpZEdlbmVyYXRvciwgY29va2llc1NlcnZpY2UsIGNvbmZpZykge1xuICAgICAgICB0aGlzLmlkR2VuZXJhdG9yID0gaWRHZW5lcmF0b3I7XG4gICAgICAgIHRoaXMuY29va2llc1NlcnZpY2UgPSBjb29raWVzU2VydmljZTtcbiAgICAgICAgdGhpcy5jb25maWcgPSBjb25maWc7XG4gICAgICAgIHRoaXMuY29va2llID0gXCJjdG1cIjtcbiAgICAgICAgdGhpcy5pc05ld0lkZW50aWZpY2F0aW9uID0gZmFsc2U7XG4gICAgICAgIHRoaXMuc2V0T3JBZGRJZGVudGlmaWNhdGlvbigpO1xuICAgIH1cbiAgICBJZGVudGlmaWNhdGlvblNlcnZpY2UucHJvdG90eXBlLnNldE9yQWRkSWRlbnRpZmljYXRpb24gPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgIHZhciBpc0lkZW50aWZpZWQgPSBmYWxzZTtcbiAgICAgICAgdmFyIHN1YmplY3QgPSB0aGlzLnBhcnNlSWRlbnRpZmljYXRpb24oKTtcbiAgICAgICAgaWYgKHN1YmplY3QpIHtcbiAgICAgICAgICAgIGlzSWRlbnRpZmllZCA9IHRoaXMucGVyc2lzdElkZW50aWZpY2F0aW9uKHN1YmplY3QsIGZ1bmN0aW9uIChzKSB7XG4gICAgICAgICAgICAgICAgaWYgKCFfdGhpcy5pc0luVmlzaXRSYW5nZShzdWJqZWN0KSkge1xuICAgICAgICAgICAgICAgICAgICBzdWJqZWN0LnZzdCA9IF90aGlzLmlkR2VuZXJhdG9yLmdlbmVyYXRlKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHN1YmplY3QucGd2ID0gX3RoaXMuaWRHZW5lcmF0b3IuZ2VuZXJhdGUoKTtcbiAgICAgICAgICAgICAgICBzdWJqZWN0LmludHIgPSBEYXRlLnBhcnNlKG5ldyBEYXRlKCkudG9VVENTdHJpbmcoKSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHN1YmplY3Q7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoIWlzSWRlbnRpZmllZCkge1xuICAgICAgICAgICAgdGhpcy5jcmVhdGVJZGVudGlmaWNhdGlvbigpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuc2V0SWRlbnRpZmljYXRpb25Gcm9tU3RvcmVkKCk7XG4gICAgfTtcbiAgICBJZGVudGlmaWNhdGlvblNlcnZpY2UucHJvdG90eXBlLnBhcnNlSWRlbnRpZmljYXRpb24gPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBjdG0gPSB0aGlzLmNvb2tpZXNTZXJ2aWNlLnJlYWQoXCJjdG1cIik7XG4gICAgICAgIGlmIChjdG0pIHtcbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIEpTT04ucGFyc2UoY3RtKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNhdGNoIChlKSB7IH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICB9O1xuICAgIElkZW50aWZpY2F0aW9uU2VydmljZS5wcm90b3R5cGUuc2V0SWRlbnRpZmljYXRpb25Gcm9tU3RvcmVkID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLmlkZW50aWZpY2F0aW9uID0ge1xuICAgICAgICAgICAgVmlzaXQ6IHRoaXMuc3RvcmVkSWRlbnRpZmljYXRpb24udnN0LFxuICAgICAgICAgICAgVmlzaXRvcjogdGhpcy5zdG9yZWRJZGVudGlmaWNhdGlvbi52c3RyLFxuICAgICAgICAgICAgUGFnZVZpZXc6IHRoaXMuc3RvcmVkSWRlbnRpZmljYXRpb24ucGd2LFxuICAgICAgICAgICAgTGFzdE1vZGlmaWVkOiB0aGlzLnN0b3JlZElkZW50aWZpY2F0aW9uLmludHJcbiAgICAgICAgfTtcbiAgICB9O1xuICAgIElkZW50aWZpY2F0aW9uU2VydmljZS5wcm90b3R5cGUuZ2V0SWRlbnRpZmljYXRpb24gPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmlkZW50aWZpY2F0aW9uO1xuICAgIH07XG4gICAgSWRlbnRpZmljYXRpb25TZXJ2aWNlLnByb3RvdHlwZS5wZXJzaXN0SWRlbnRpZmljYXRpb24gPSBmdW5jdGlvbiAoc3ViamVjdCwgc3ViamVjdFRyYW5zZm9ybSkge1xuICAgICAgICBpZiAodGhpcy52YWxpZGF0ZShzdWJqZWN0KSkge1xuICAgICAgICAgICAgc3ViamVjdCA9IHN1YmplY3RUcmFuc2Zvcm0gPyBzdWJqZWN0VHJhbnNmb3JtKHN1YmplY3QpIDogc3ViamVjdDtcbiAgICAgICAgICAgIHRoaXMudXBkYXRlQ29va2llKHN1YmplY3QpO1xuICAgICAgICAgICAgdGhpcy5zdG9yZWRJZGVudGlmaWNhdGlvbiA9IHN1YmplY3Q7XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfTtcbiAgICBJZGVudGlmaWNhdGlvblNlcnZpY2UucHJvdG90eXBlLmlzSW5WaXNpdFJhbmdlID0gZnVuY3Rpb24gKGlkZW50aWZpY2F0aW9uKSB7XG4gICAgICAgIHJldHVybiBEYXRlLnBhcnNlKG5ldyBEYXRlKCkudG9VVENTdHJpbmcoKSkgLSBpZGVudGlmaWNhdGlvbi5pbnRyIDwgdGhpcy5jb25maWcuaWRlbnRpZmljYXRpb24udmlzaXRUaW1lU3BhbjtcbiAgICB9O1xuICAgIElkZW50aWZpY2F0aW9uU2VydmljZS5wcm90b3R5cGUuY3JlYXRlSWRlbnRpZmljYXRpb24gPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMudXBkYXRlQ29va2llKHRoaXMuc3RvcmVkSWRlbnRpZmljYXRpb24gPSB7XG4gICAgICAgICAgICBwZ3Y6IHRoaXMuaWRHZW5lcmF0b3IuZ2VuZXJhdGUoKSxcbiAgICAgICAgICAgIHZzdDogdGhpcy5pZEdlbmVyYXRvci5nZW5lcmF0ZSgpLFxuICAgICAgICAgICAgdnN0cjogdGhpcy5pZEdlbmVyYXRvci5nZW5lcmF0ZSgpLFxuICAgICAgICAgICAgaW50cjogRGF0ZS5wYXJzZShuZXcgRGF0ZSgpLnRvVVRDU3RyaW5nKCkpXG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLmlzTmV3SWRlbnRpZmljYXRpb24gPSB0cnVlO1xuICAgIH07XG4gICAgSWRlbnRpZmljYXRpb25TZXJ2aWNlLnByb3RvdHlwZS52YWxpZGF0ZSA9IGZ1bmN0aW9uIChpZGVudGlmaWNhdGlvbikge1xuICAgICAgICByZXR1cm4gW1widnN0XCIsIFwicGd2XCIsIFwidnN0clwiLCBcImludHJcIl0uZXZlcnkoZnVuY3Rpb24gKGtleSkge1xuICAgICAgICAgICAgdmFyIHZhbHVlO1xuICAgICAgICAgICAgaWYgKHZhbHVlID0gaWRlbnRpZmljYXRpb25ba2V5XSkge1xuICAgICAgICAgICAgICAgIHJldHVybiAhaXNOYU4odmFsdWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9KTtcbiAgICB9O1xuICAgIElkZW50aWZpY2F0aW9uU2VydmljZS5wcm90b3R5cGUubW9kaWZ5SWRlbnRpZmljYXRpb24gPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBub3cgPSBEYXRlLnBhcnNlKG5ldyBEYXRlKCkudG9VVENTdHJpbmcoKSk7XG4gICAgICAgIHRoaXMuc3RvcmVkSWRlbnRpZmljYXRpb24uaW50ciA9IHRoaXMuaWRlbnRpZmljYXRpb24uTGFzdE1vZGlmaWVkID0gbm93O1xuICAgICAgICB0aGlzLnVwZGF0ZUNvb2tpZSh0aGlzLnN0b3JlZElkZW50aWZpY2F0aW9uKTtcbiAgICB9O1xuICAgIElkZW50aWZpY2F0aW9uU2VydmljZS5wcm90b3R5cGUuc2V0SWRlbnRpZmljYXRpb24gPSBmdW5jdGlvbiAoaWRlbnRpZmljYXRpb24pIHtcbiAgICAgICAgdmFyIHN1YmplY3QgPSB0aGlzLnBhcnNlSWRlbnRpZmljYXRpb24oKSB8fCB7fTtcbiAgICAgICAgc3ViamVjdCA9IE9iamVjdEV4dGVuZGVyXzEuT2JqZWN0RXh0ZW5kZXIuZXh0ZW5kKHN1YmplY3QsIGlkZW50aWZpY2F0aW9uKTtcbiAgICAgICAgaWYgKHRoaXMucGVyc2lzdElkZW50aWZpY2F0aW9uKHN1YmplY3QpKSB7XG4gICAgICAgICAgICB0aGlzLnNldElkZW50aWZpY2F0aW9uRnJvbVN0b3JlZCgpO1xuICAgICAgICB9XG4gICAgfTtcbiAgICBJZGVudGlmaWNhdGlvblNlcnZpY2UucHJvdG90eXBlLnVwZGF0ZUNvb2tpZSA9IGZ1bmN0aW9uIChpZGVudGlmaWNhdGlvbikge1xuICAgICAgICB2YXIgdmFsdWUgPSBKU09OLnN0cmluZ2lmeShpZGVudGlmaWNhdGlvbik7XG4gICAgICAgIHRoaXMuY29va2llc1NlcnZpY2Uud3JpdGUodGhpcy5jb29raWUsIHZhbHVlLCB0aGlzLmNvbmZpZy5pZGVudGlmaWNhdGlvbi5leHBpcmF0aW9uRGF5cyk7XG4gICAgfTtcbiAgICByZXR1cm4gSWRlbnRpZmljYXRpb25TZXJ2aWNlO1xufSgpKTtcbmV4cG9ydHMuSWRlbnRpZmljYXRpb25TZXJ2aWNlID0gSWRlbnRpZmljYXRpb25TZXJ2aWNlO1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgT2JqZWN0RXh0ZW5kZXIgPSAoZnVuY3Rpb24gKCkge1xuICAgIGZ1bmN0aW9uIE9iamVjdEV4dGVuZGVyKCkge1xuICAgIH1cbiAgICBPYmplY3RFeHRlbmRlci5leHRlbmQgPSBmdW5jdGlvbiAodGFyZ2V0KSB7XG4gICAgICAgIHZhciBsZW5ndGggPSBhcmd1bWVudHMubGVuZ3RoLCBvcHRpb25zLCBuYW1lLCBzcmMsIGNvcHksIGNvcHlJc0FycmF5LCBjbG9uZTtcbiAgICAgICAgZm9yICh2YXIgaSA9IDE7IGkgPCBsZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgaWYgKG9wdGlvbnMgPSBhcmd1bWVudHNbaV0pIHtcbiAgICAgICAgICAgICAgICBmb3IgKG5hbWUgaW4gb3B0aW9ucykge1xuICAgICAgICAgICAgICAgICAgICBzcmMgPSB0YXJnZXRbbmFtZV07XG4gICAgICAgICAgICAgICAgICAgIGNvcHkgPSBvcHRpb25zW25hbWVdO1xuICAgICAgICAgICAgICAgICAgICBpZiAodGFyZ2V0ID09PSBjb3B5KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBpZiAoY29weSAmJiAoT2JqZWN0RXh0ZW5kZXIuaXNQbGFpbk9iamVjdChjb3B5KSB8fCAoY29weUlzQXJyYXkgPSBBcnJheS5pc0FycmF5KGNvcHkpKSkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjb3B5SXNBcnJheSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvcHlJc0FycmF5ID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFyZ2V0W25hbWVdID0gY29weS5zbGljZSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xvbmUgPSBzcmMgJiYgT2JqZWN0RXh0ZW5kZXIuaXNQbGFpbk9iamVjdChzcmMpID8gc3JjIDoge307XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFyZ2V0W25hbWVdID0gT2JqZWN0RXh0ZW5kZXIuZXh0ZW5kKGNsb25lLCBjb3B5KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChjb3B5ICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRhcmdldFtuYW1lXSA9IGNvcHk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRhcmdldDtcbiAgICB9O1xuICAgIE9iamVjdEV4dGVuZGVyLmlzUGxhaW5PYmplY3QgPSBmdW5jdGlvbiAob2JqKSB7XG4gICAgICAgIGlmIChPYmplY3RFeHRlbmRlci50eXBlKG9iaikgIT09IFwib2JqZWN0XCIgfHwgb2JqLm5vZGVUeXBlIHx8IG9iaiA9PT0gd2luZG93KSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKG9iai5jb25zdHJ1Y3RvciAmJiAhT2JqZWN0RXh0ZW5kZXIuaGFzT3duLmNhbGwob2JqLmNvbnN0cnVjdG9yLnByb3RvdHlwZSwgXCJpc1Byb3RvdHlwZU9mXCIpKSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgLy8gSWYgdGhlIGZ1bmN0aW9uIGhhc24ndCByZXR1cm5lZCBhbHJlYWR5LCB3ZSdyZSBjb25maWRlbnQgdGhhdFxuICAgICAgICAvLyB8b2JqfCBpcyBhIHBsYWluIG9iamVjdCwgY3JlYXRlZCBieSB7fSBvciBjb25zdHJ1Y3RlZCB3aXRoIG5ldyBPYmplY3RcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfTtcbiAgICBPYmplY3RFeHRlbmRlci50eXBlID0gZnVuY3Rpb24gKG9iaikge1xuICAgICAgICBpZiAob2JqID09IG51bGwpIHtcbiAgICAgICAgICAgIHJldHVybiBvYmogKyBcIlwiO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0eXBlb2Ygb2JqID09PSBcIm9iamVjdFwiIHx8IHR5cGVvZiBvYmogPT09IFwiZnVuY3Rpb25cIiA/XG4gICAgICAgICAgICBPYmplY3RFeHRlbmRlci5jbGFzczJ0eXBlW09iamVjdEV4dGVuZGVyLnRvU3RyaW5nLmNhbGwob2JqKV0gfHwgXCJvYmplY3RcIiA6XG4gICAgICAgICAgICB0eXBlb2Ygb2JqO1xuICAgIH07XG4gICAgT2JqZWN0RXh0ZW5kZXIuY2xhc3MydHlwZSA9IHt9O1xuICAgIE9iamVjdEV4dGVuZGVyLnRvU3RyaW5nID0gT2JqZWN0RXh0ZW5kZXIuY2xhc3MydHlwZS50b1N0cmluZztcbiAgICBPYmplY3RFeHRlbmRlci5oYXNPd24gPSBPYmplY3RFeHRlbmRlci5jbGFzczJ0eXBlLmhhc093blByb3BlcnR5O1xuICAgIHJldHVybiBPYmplY3RFeHRlbmRlcjtcbn0oKSk7XG5leHBvcnRzLk9iamVjdEV4dGVuZGVyID0gT2JqZWN0RXh0ZW5kZXI7XG4iLCJcInVzZSBzdHJpY3RcIjtcbnZhciBVc2VyQWdlbnRTZXJ2aWNlID0gKGZ1bmN0aW9uICgpIHtcbiAgICBmdW5jdGlvbiBVc2VyQWdlbnRTZXJ2aWNlKHVzZXJBZ2VudCkge1xuICAgICAgICB0aGlzLnRva2VuaXplciA9IC8gKFxcdyspKD86XFwvKFtcXHdcXC5dKykpPyAoPzooXFwoW15cXCldK1xcKSkgKT8vaW1nO1xuICAgICAgICB0aGlzLnVzZXJBZ2VudCA9IHRoaXMuZGV0ZWN0KFwiIFwiICsgKHVzZXJBZ2VudCB8fCBuYXZpZ2F0b3IudXNlckFnZW50KSArIFwiIFwiKTtcbiAgICAgICAgdGhpcy5pc0Jyb3dzZXJTdXBwb3J0ZWQgPSB0aGlzLmNoZWNrQnJvd3NlclN1cHBvcnQodGhpcy51c2VyQWdlbnQuYnJvd3NlciwgdGhpcy51c2VyQWdlbnQuaXMpO1xuICAgIH1cbiAgICBVc2VyQWdlbnRTZXJ2aWNlLnByb3RvdHlwZS5kZXRlY3QgPSBmdW5jdGlvbiAodXNlckFnZW50KSB7XG4gICAgICAgIHZhciB4aHIgPSB3aW5kb3cuWE1MSHR0cFJlcXVlc3Q7XG4gICAgICAgIHZhciB0b2tlbnMgPSB0aGlzLnRva2VuaXplKHVzZXJBZ2VudCk7XG4gICAgICAgIHZhciByZXN1bHQgPSB7IGlzOiB7IG1vYmlsZTogZmFsc2UgfSwgYnJvd3NlcjogeyB2ZXJzaW9uOiA2IC8qIE5vdFN1cHBvcnRlZCAqLyB9IH07XG4gICAgICAgIHZhciBicm93c2VyID0gcmVzdWx0LmJyb3dzZXI7XG4gICAgICAgIHZhciBtb3pFeHRyYSA9IHRva2Vuc1tcIk1vemlsbGFcIl0gJiYgdG9rZW5zW1wiTW96aWxsYVwiXVtcImV4dHJhXCJdID8gdG9rZW5zW1wiTW96aWxsYVwiXVtcImV4dHJhXCJdIDogbnVsbDtcbiAgICAgICAgdmFyIHN1cHBvcnRzID0gcmVzdWx0LnN1cHBvcnRzID0ge1xuICAgICAgICAgICAgc2VuZEJlYWNvbjogISFuYXZpZ2F0b3Iuc2VuZEJlYWNvbixcbiAgICAgICAgICAgIGJpbmFyeVRyYW5zcG9ydDogeGhyICYmIFwid2l0aENyZWRlbnRpYWxzXCIgaW4gbmV3IFhNTEh0dHBSZXF1ZXN0XG4gICAgICAgIH07XG4gICAgICAgIGlmICh0b2tlbnNbXCJPcGVyYVwiXSkge1xuICAgICAgICAgICAgYnJvd3Nlci52ZXJzaW9uID0gMDtcbiAgICAgICAgICAgIGJyb3dzZXIubmFtZSA9IFwiT3BlcmFcIjtcbiAgICAgICAgICAgIGJyb3dzZXIudHlwZSA9IDEgLyogT3BlcmEgKi87XG4gICAgICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgICAgICB9XG4gICAgICAgIGlmICh0b2tlbnNbXCJFZGdlXCJdKSB7XG4gICAgICAgICAgICBicm93c2VyLnR5cGUgPSAwIC8qIEVkZ2UgKi87XG4gICAgICAgICAgICBicm93c2VyLm5hbWUgPSBcIkVkZ2VcIjtcbiAgICAgICAgICAgIGJyb3dzZXIudmVyc2lvbiA9IHBhcnNlSW50KHRva2Vuc1tcIkVkZ2VcIl1bXCJ2YWx1ZVwiXSk7XG4gICAgICAgICAgICByZXN1bHQuaXMubW9iaWxlID0gdXNlckFnZW50LmluZGV4T2YoXCJXaW5kb3dzIFBob25lOyBcIikgIT09IC0xO1xuICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICAgICAgfVxuICAgICAgICBpZiAobW96RXh0cmEpIHtcbiAgICAgICAgICAgIHZhciBpbmRleCA9IHZvaWQgMDtcbiAgICAgICAgICAgIHZhciBtc2llSW5kZXggPSBtb3pFeHRyYS5pbmRleE9mKFwiTVNJRSBcIik7XG4gICAgICAgICAgICB2YXIgdHJpZGVudEluZGV4ID0gbW96RXh0cmEuaW5kZXhPZihcIjsgVHJpZGVudC9cIik7XG4gICAgICAgICAgICB2YXIgaXNJRSA9IG1zaWVJbmRleCArIHRyaWRlbnRJbmRleCA+IC0xO1xuICAgICAgICAgICAgaWYgKGlzSUUpIHtcbiAgICAgICAgICAgICAgICBpbmRleCA9IG1zaWVJbmRleCAhPT0gLTEgPyBtc2llSW5kZXggOiBtb3pFeHRyYS5pbmRleE9mKFwiOyBydjpcIik7XG4gICAgICAgICAgICAgICAgaWYgKGluZGV4ICE9PSAtMSkge1xuICAgICAgICAgICAgICAgICAgICBicm93c2VyLnR5cGUgPSA3IC8qIEludGVybmV0RXhwbG9yZXIgKi87XG4gICAgICAgICAgICAgICAgICAgIGJyb3dzZXIubmFtZSA9IFwiSW50ZXJuZXQgRXhwbG9yZXJcIjtcbiAgICAgICAgICAgICAgICAgICAgYnJvd3Nlci52ZXJzaW9uID0gcGFyc2VGbG9hdChtb3pFeHRyYS5zdWJzdHIoaW5kZXggKyA1LCAzKSk7XG4gICAgICAgICAgICAgICAgICAgIHJlc3VsdC5pcy5tb2JpbGUgPSBtb3pFeHRyYS5pbmRleE9mKFwiOyBUb3VjaFwiKSAhPT0gLTEgfHwgbW96RXh0cmEuaW5kZXhPZihcIjsgSUVNb2JpbGUvXCIpICE9PSAtMTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRva2Vuc1tcIkZpcmVmb3hcIl0gJiYgdG9rZW5zW1wiRmlyZWZveFwiXVtcInZhbHVlXCJdKSB7XG4gICAgICAgICAgICBicm93c2VyLnR5cGUgPSA1IC8qIEZpcmVGb3ggKi87XG4gICAgICAgICAgICBicm93c2VyLm5hbWUgPSBcIkZpcmVmb3hcIjtcbiAgICAgICAgICAgIGJyb3dzZXIudmVyc2lvbiA9IHBhcnNlRmxvYXQodG9rZW5zW1wiRmlyZWZveFwiXVtcInZhbHVlXCJdKTtcbiAgICAgICAgICAgIHJlc3VsdC5pcy5tb2JpbGUgPSBtb3pFeHRyYSAmJiBtb3pFeHRyYS5pbmRleE9mKFwiQW5kcm9pZDsgXCIpICE9PSAtMTtcbiAgICAgICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCh0b2tlbnNbXCJDaHJvbWVcIl0gJiYgdG9rZW5zW1wiQ2hyb21lXCJdW1widmFsdWVcIl0gfHwgdG9rZW5zW1wiQ3JpT1NcIl0gJiYgdG9rZW5zW1wiQ3JpT1NcIl1bXCJ2YWx1ZVwiXSkgJiYgIXRva2Vuc1tcIlZlcnNpb25cIl0pIHtcbiAgICAgICAgICAgIGJyb3dzZXIudHlwZSA9IDMgLyogQ2hyb21lICovO1xuICAgICAgICAgICAgYnJvd3Nlci5uYW1lID0gXCJDaHJvbWVcIjtcbiAgICAgICAgICAgIGJyb3dzZXIudmVyc2lvbiA9IHBhcnNlRmxvYXQodG9rZW5zW1wiQ2hyb21lXCJdID8gdG9rZW5zW1wiQ2hyb21lXCJdW1widmFsdWVcIl0gOiB0b2tlbnNbXCJDcmlPU1wiXVtcInZhbHVlXCJdKTtcbiAgICAgICAgICAgIHJlc3VsdC5pcy5tb2JpbGUgPSB0b2tlbnNbXCJDcmlPU1wiXSB8fCBtb3pFeHRyYSAmJiBtb3pFeHRyYS5pbmRleE9mKFwiOyBBbmRyb2lkIFwiKSAhPT0gLTE7XG4gICAgICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgICAgICB9XG4gICAgICAgIGlmICh0b2tlbnNbXCJTYWZhcmlcIl0pIHtcbiAgICAgICAgICAgIGJyb3dzZXIubmFtZSA9IFwiU2FmYXJpXCI7XG4gICAgICAgICAgICBpZiAobW96RXh0cmEgJiYgbW96RXh0cmEuaW5kZXhPZihcIjsgQW5kcm9pZCBcIikgIT09IC0xICYmIHRva2Vuc1tcIkFwcGxlV2ViS2l0XCJdICYmIHRva2Vuc1tcIkFwcGxlV2ViS2l0XCJdW1widmFsdWVcIl0pIHtcbiAgICAgICAgICAgICAgICBicm93c2VyLnR5cGUgPSAyIC8qIFdlYktpdCAqLztcbiAgICAgICAgICAgICAgICBicm93c2VyLnZlcnNpb24gPSBwYXJzZUZsb2F0KHRva2Vuc1tcIkFwcGxlV2ViS2l0XCJdW1widmFsdWVcIl0pO1xuICAgICAgICAgICAgICAgIHJlc3VsdC5pcy5tb2JpbGUgPSB0cnVlO1xuICAgICAgICAgICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAobW96RXh0cmEgJiYgbW96RXh0cmEuaW5kZXhPZihcIldpbmRvd3NcIikgPT09IC0xICYmIHRva2Vuc1tcIlZlcnNpb25cIl0gJiYgdG9rZW5zW1wiVmVyc2lvblwiXVtcInZhbHVlXCJdKSB7XG4gICAgICAgICAgICAgICAgYnJvd3Nlci50eXBlID0gNCAvKiBTYWZhcmkgKi87XG4gICAgICAgICAgICAgICAgYnJvd3Nlci52ZXJzaW9uID0gcGFyc2VGbG9hdCh0b2tlbnNbXCJWZXJzaW9uXCJdW1widmFsdWVcIl0pO1xuICAgICAgICAgICAgICAgIHJlc3VsdC5pcy5tb2JpbGUgPSAhIXRva2Vuc1tcIk1vYmlsZVwiXTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgIH07XG4gICAgVXNlckFnZW50U2VydmljZS5wcm90b3R5cGUuY2hlY2tCcm93c2VyU3VwcG9ydCA9IGZ1bmN0aW9uIChicm93c2VyLCBkZXZpY2UpIHtcbiAgICAgICAgcmV0dXJuIGJyb3dzZXIudHlwZSA9PT0gMCAvKiBFZGdlICovICYmICFkZXZpY2UubW9iaWxlIHx8XG4gICAgICAgICAgICBicm93c2VyLnR5cGUgPT09IDMgLyogQ2hyb21lICovICYmIGJyb3dzZXIudmVyc2lvbiA+PSA5IHx8XG4gICAgICAgICAgICBicm93c2VyLnR5cGUgPT09IDIgLyogV2ViS2l0ICovICYmIGJyb3dzZXIudmVyc2lvbiA+PSA1MzQgfHxcbiAgICAgICAgICAgIGJyb3dzZXIudHlwZSA9PT0gNSAvKiBGaXJlRm94ICovICYmIGJyb3dzZXIudmVyc2lvbiA+PSAyNSAmJiAhZGV2aWNlLm1vYmlsZSB8fFxuICAgICAgICAgICAgYnJvd3Nlci50eXBlID09PSA0IC8qIFNhZmFyaSAqLyAmJiBicm93c2VyLnZlcnNpb24gPj0gNS4xICYmIGJyb3dzZXIudmVyc2lvbiA8PSAxMCB8fFxuICAgICAgICAgICAgYnJvd3Nlci50eXBlID09PSA3IC8qIEludGVybmV0RXhwbG9yZXIgKi8gJiYgYnJvd3Nlci52ZXJzaW9uID4gOSAmJiAhZGV2aWNlLm1vYmlsZTtcbiAgICB9O1xuICAgIFVzZXJBZ2VudFNlcnZpY2UucHJvdG90eXBlLnRva2VuaXplID0gZnVuY3Rpb24gKHVzZXJBZ2VudCkge1xuICAgICAgICB2YXIgdG9rZW5zID0ge307XG4gICAgICAgIHZhciB0b2tlbjtcbiAgICAgICAgd2hpbGUgKHRva2VuID0gdGhpcy50b2tlbml6ZXIuZXhlYyh1c2VyQWdlbnQpKSB7XG4gICAgICAgICAgICB0b2tlbnNbdG9rZW5bMV1dID0ge1xuICAgICAgICAgICAgICAgIHZhbHVlOiB0b2tlblsyXSxcbiAgICAgICAgICAgICAgICBleHRyYTogdG9rZW5bM11cbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICB0aGlzLnRva2VuaXplci5sYXN0SW5kZXgtLTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdG9rZW5zO1xuICAgIH07XG4gICAgcmV0dXJuIFVzZXJBZ2VudFNlcnZpY2U7XG59KCkpO1xuZXhwb3J0cy5Vc2VyQWdlbnRTZXJ2aWNlID0gVXNlckFnZW50U2VydmljZTtcbiIsIlwidXNlIHN0cmljdFwiO1xudmFyIEFic3RyYWN0VHJhbnNwb3J0Q2hhbm5lbCA9IChmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gQWJzdHJhY3RUcmFuc3BvcnRDaGFubmVsKHNldHRpbmdzKSB7XG4gICAgICAgIHRoaXMuc2V0dGluZ3MgPSBzZXR0aW5ncztcbiAgICB9XG4gICAgQWJzdHJhY3RUcmFuc3BvcnRDaGFubmVsLnByb3RvdHlwZS5vblJlcXVlc3RTdWNjZXNzID0gZnVuY3Rpb24gKGVudmVsb3BlKSB7XG4gICAgICAgIHRoaXMucmVzZXQoKTtcbiAgICAgICAgdGhpcy5zZXR0aW5ncy5zZW5kUHJvbWlzZS5yZXNvbHZlKGVudmVsb3BlKTtcbiAgICB9O1xuICAgIEFic3RyYWN0VHJhbnNwb3J0Q2hhbm5lbC5wcm90b3R5cGUub25SZXF1ZXN0RmFpbHVyZSA9IGZ1bmN0aW9uIChlbnZlbG9wZSkge1xuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgICB0aGlzLnJlc2V0KCk7XG4gICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgX3RoaXMuc2V0dGluZ3Muc2VuZFByb21pc2UucmVqZWN0KGVudmVsb3BlKTtcbiAgICAgICAgfSwgdGhpcy5zZXR0aW5ncy53YWl0SW50ZXJ2YWwpO1xuICAgIH07XG4gICAgcmV0dXJuIEFic3RyYWN0VHJhbnNwb3J0Q2hhbm5lbDtcbn0oKSk7XG5leHBvcnRzLkFic3RyYWN0VHJhbnNwb3J0Q2hhbm5lbCA9IEFic3RyYWN0VHJhbnNwb3J0Q2hhbm5lbDtcbiIsIlwidXNlIHN0cmljdFwiO1xudmFyIEJlYWNvblRyYW5zcG9ydENoYW5uZWwgPSAoZnVuY3Rpb24gKCkge1xuICAgIGZ1bmN0aW9uIEJlYWNvblRyYW5zcG9ydENoYW5uZWwoc2V0dGluZ3MpIHtcbiAgICAgICAgdGhpcy5zZXR0aW5ncyA9IHNldHRpbmdzO1xuICAgIH1cbiAgICBCZWFjb25UcmFuc3BvcnRDaGFubmVsLnByb3RvdHlwZS5zZW5kID0gZnVuY3Rpb24gKHVybCwgZW52ZWxvcGUpIHtcbiAgICAgICAgdmFyIGRhdGEgPSBlbnZlbG9wZS5tZXNzYWdlLmRhdGE7XG4gICAgICAgIGlmIChuYXZpZ2F0b3Iuc2VuZEJlYWNvbih1cmwgKyBcIiZcIiArIGRhdGEpKSB7XG4gICAgICAgICAgICB0aGlzLnNldHRpbmdzLnNlbmRQcm9taXNlLnJlc29sdmUoZW52ZWxvcGUpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5zZXR0aW5ncy5zZW5kUHJvbWlzZS5yZWplY3QoZW52ZWxvcGUpO1xuICAgICAgICB9XG4gICAgfTtcbiAgICByZXR1cm4gQmVhY29uVHJhbnNwb3J0Q2hhbm5lbDtcbn0oKSk7XG5leHBvcnRzLkJlYWNvblRyYW5zcG9ydENoYW5uZWwgPSBCZWFjb25UcmFuc3BvcnRDaGFubmVsO1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgX19leHRlbmRzID0gKHRoaXMgJiYgdGhpcy5fX2V4dGVuZHMpIHx8IGZ1bmN0aW9uIChkLCBiKSB7XG4gICAgZm9yICh2YXIgcCBpbiBiKSBpZiAoYi5oYXNPd25Qcm9wZXJ0eShwKSkgZFtwXSA9IGJbcF07XG4gICAgZnVuY3Rpb24gX18oKSB7IHRoaXMuY29uc3RydWN0b3IgPSBkOyB9XG4gICAgZC5wcm90b3R5cGUgPSBiID09PSBudWxsID8gT2JqZWN0LmNyZWF0ZShiKSA6IChfXy5wcm90b3R5cGUgPSBiLnByb3RvdHlwZSwgbmV3IF9fKCkpO1xufTtcbnZhciBBYnN0cmFjdFRyYW5zcG9ydENoYW5uZWxfMSA9IHJlcXVpcmUoXCIuL0Fic3RyYWN0VHJhbnNwb3J0Q2hhbm5lbFwiKTtcbnZhciBJbWFnZVRyYW5zcG9ydENoYW5uZWwgPSAoZnVuY3Rpb24gKF9zdXBlcikge1xuICAgIF9fZXh0ZW5kcyhJbWFnZVRyYW5zcG9ydENoYW5uZWwsIF9zdXBlcik7XG4gICAgZnVuY3Rpb24gSW1hZ2VUcmFuc3BvcnRDaGFubmVsKHNldHRpbmdzKSB7XG4gICAgICAgIF9zdXBlci5jYWxsKHRoaXMsIHNldHRpbmdzKTtcbiAgICAgICAgdGhpcy5pbWFnZSA9IG5ldyBJbWFnZSgpO1xuICAgIH1cbiAgICBJbWFnZVRyYW5zcG9ydENoYW5uZWwucHJvdG90eXBlLnNlbmQgPSBmdW5jdGlvbiAodXJsLCBlbnZlbG9wZSkge1xuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgICB2YXIgZGF0YSA9IGVudmVsb3BlLm1lc3NhZ2UuZGF0YTtcbiAgICAgICAgdGhpcy5pbWFnZS5vbmxvYWQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBfdGhpcy5vblJlcXVlc3RTdWNjZXNzKGVudmVsb3BlKTtcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5pbWFnZS5vbmVycm9yID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgX3RoaXMub25SZXF1ZXN0RmFpbHVyZShlbnZlbG9wZSk7XG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuaW1hZ2Uuc3JjICs9IHVybCArIFwiJlwiICsgZGF0YSArIFwiJnI9XCIgKyBEYXRlLm5vdygpO1xuICAgIH07XG4gICAgSW1hZ2VUcmFuc3BvcnRDaGFubmVsLnByb3RvdHlwZS5yZXNldCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5pbWFnZSA9IHRoaXMuaW1hZ2Uub25lcnJvciA9IHRoaXMuaW1hZ2Uub25sb2FkID0gbnVsbDtcbiAgICB9O1xuICAgIHJldHVybiBJbWFnZVRyYW5zcG9ydENoYW5uZWw7XG59KEFic3RyYWN0VHJhbnNwb3J0Q2hhbm5lbF8xLkFic3RyYWN0VHJhbnNwb3J0Q2hhbm5lbCkpO1xuZXhwb3J0cy5JbWFnZVRyYW5zcG9ydENoYW5uZWwgPSBJbWFnZVRyYW5zcG9ydENoYW5uZWw7XG4iLCJcInVzZSBzdHJpY3RcIjtcbnZhciBfX2V4dGVuZHMgPSAodGhpcyAmJiB0aGlzLl9fZXh0ZW5kcykgfHwgZnVuY3Rpb24gKGQsIGIpIHtcbiAgICBmb3IgKHZhciBwIGluIGIpIGlmIChiLmhhc093blByb3BlcnR5KHApKSBkW3BdID0gYltwXTtcbiAgICBmdW5jdGlvbiBfXygpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IGQ7IH1cbiAgICBkLnByb3RvdHlwZSA9IGIgPT09IG51bGwgPyBPYmplY3QuY3JlYXRlKGIpIDogKF9fLnByb3RvdHlwZSA9IGIucHJvdG90eXBlLCBuZXcgX18oKSk7XG59O1xudmFyIEFic3RyYWN0VHJhbnNwb3J0Q2hhbm5lbF8xID0gcmVxdWlyZShcIi4vQWJzdHJhY3RUcmFuc3BvcnRDaGFubmVsXCIpO1xudmFyIFRyYW5zcG9ydENoYW5uZWxYaHIgPSAoZnVuY3Rpb24gKF9zdXBlcikge1xuICAgIF9fZXh0ZW5kcyhUcmFuc3BvcnRDaGFubmVsWGhyLCBfc3VwZXIpO1xuICAgIGZ1bmN0aW9uIFRyYW5zcG9ydENoYW5uZWxYaHIoc2V0dGluZ3MpIHtcbiAgICAgICAgX3N1cGVyLmNhbGwodGhpcywgc2V0dGluZ3MpO1xuICAgICAgICB0aGlzLnhociA9IG5ldyBYTUxIdHRwUmVxdWVzdCgpO1xuICAgIH1cbiAgICBUcmFuc3BvcnRDaGFubmVsWGhyLnByb3RvdHlwZS5zZW5kID0gZnVuY3Rpb24gKHVybCwgZW52ZWxvcGUpIHtcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcbiAgICAgICAgdmFyIHhociA9IHRoaXMueGhyO1xuICAgICAgICB2YXIgZGF0YSA9IGVudmVsb3BlLm1lc3NhZ2UuZGF0YTtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIHhoci5vcGVuKFwiUE9TVFwiLCB1cmwpO1xuICAgICAgICAgICAgeGhyLnRpbWVvdXQgPSAzMDAwMDtcbiAgICAgICAgICAgIHhoci5zZXRSZXF1ZXN0SGVhZGVyKFwiQ29udGVudC1UeXBlXCIsIFwidGV4dC9wbGFpblwiKTtcbiAgICAgICAgICAgIHRoaXMueGhyLm9ucmVhZHlzdGF0ZWNoYW5nZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICBpZiAoeGhyLnJlYWR5U3RhdGUgPT09IDQpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHhoci5zdGF0dXMgPT09IDIwMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMub25SZXF1ZXN0U3VjY2VzcyhlbnZlbG9wZSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBfdGhpcy5vblJlcXVlc3RGYWlsdXJlKGVudmVsb3BlKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICB4aHIub25sb2FkID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIF90aGlzLm9uUmVxdWVzdFN1Y2Nlc3MoZW52ZWxvcGUpO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIHhoci5vbmVycm9yID0geGhyLm9udGltZW91dCA9IHhoci5vbmFib3J0ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIF90aGlzLm9uUmVxdWVzdEZhaWx1cmUoZW52ZWxvcGUpO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIHhoci5zZW5kKGRhdGEpO1xuICAgICAgICB9XG4gICAgICAgIGNhdGNoIChleCkge1xuICAgICAgICAgICAgdGhpcy5vblJlcXVlc3RGYWlsdXJlKGVudmVsb3BlKTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgVHJhbnNwb3J0Q2hhbm5lbFhoci5wcm90b3R5cGUucmVzZXQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMueGhyID0gdGhpcy54aHIub25hYm9ydCA9IHRoaXMueGhyLm9udGltZW91dCA9IHRoaXMueGhyLm9uZXJyb3IgPSB0aGlzLnhoci5vbmxvYWQgPSB0aGlzLnhoci5vbnJlYWR5c3RhdGVjaGFuZ2UgPSBudWxsO1xuICAgIH07XG4gICAgcmV0dXJuIFRyYW5zcG9ydENoYW5uZWxYaHI7XG59KEFic3RyYWN0VHJhbnNwb3J0Q2hhbm5lbF8xLkFic3RyYWN0VHJhbnNwb3J0Q2hhbm5lbCkpO1xuZXhwb3J0cy5UcmFuc3BvcnRDaGFubmVsWGhyID0gVHJhbnNwb3J0Q2hhbm5lbFhocjtcbiJdfQ==
if (typeof window.ClickTaleMonitorOnReady === "function"){ ClickTaleMonitorOnReady(); } }();